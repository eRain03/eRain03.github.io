[{"content":" SW2 配置 DHCPv4 和 DHCPv6,分别为 Vlan11、Vlan21、Vlan130、 Vlan140、Vlan150 分配地址。DHCPv4 地址池名称分别为 PC1、PC2、 AP1、POOLv4-VLAN11、POOLv4-VLAN21、POOLv4-VLAN130、POOLv4- VLAN140 、POOLv4-VLAN150 ,排 除 网关, DNS 为 10.4.210.101 和 10.4.220.101。DHCPv6 地址池名称分别为 POOLv6-VLAN11、POOLv6- VLAN21、 POOLv6-VLAN130、 POOLv6-VLAN140、 POOLv6-VLAN150, DHCPv6 地址池用网络前缀表示,排除网关, DNS 为 2400:3200::1。 PC1 保留地 址 10.4.11.9(DHCPv4 地址池名称为 PC1)和 2001:10:4:11::9,PC2 保留地址 10.4.21.9 ( DHCPv4 地址池名称为 PC2)和 2001:10:4:21::9, AP1 保 留 地 址 10.4.130.9 ( DHCPv4 地 址 池 名 称 为 AP1 ) 和 2001:10:4:130::9。SW1、AC1 中继地址为 SW2 Loopback1 地址。SW1 启用 DHCPv4 和 DHCPv6 snooping 功能,如果 E1/0/1 连接 DHCPv4 服 务器,则关闭端口,恢复时间为 10 分钟。\n首先配置地址池 进入到SW3\nSW3 ! service dhcp ! ip dhcp excluded-address 10.4.130.1 ip dhcp excluded-address 10.4.11.1 ip dhcp excluded-address 10.4.21.1 ip dhcp excluded-address 10.4.140.1 ip dhcp excluded-address 10.4.150.1 ! ip dhcp pool POOLv4-VLAN11 network-address 10.4.11.0 255.255.255.0 default-router 10.4.11.1 dns-server 10.4.210.101 10.4.220.101 ! ip dhcp pool POOLv4-VLAN21 network-address 10.4.21.0 255.255.255.0 default-router 10.4.21.1 dns-server 10.4.210.101 10.4.220.101 ! ip dhcp pool POOLv4-VLAN130 network-address 10.4.130.0 255.255.255.0 default-router 10.4.130.1 ! ip dhcp pool POOLv4-VLAN140 network-address 10.4.140.0 255.255.255.0 default-router 10.4.140.1 dns-server 10.4.210.101 10.4.220.101 ! ip dhcp pool POOLv4-VLAN150 network-address 10.4.150.0 255.255.255.0 default-router 10.4.150.1 dns-server 10.4.210.101 10.4.220.101 ! ip dhcp pool AP1 host 10.4.130.9 255.0.0.0 hardware-address 00-03-0F-D9-C8-20 default-router 10.4.130.1 ! ip dhcp pool PC1 host 10.4.11.9 255.0.0.0 hardware-address 00-03-0F-D9-C8-C9 default-router 10.4.11.1 dns-server 10.4.210.101 10.4.220.101 ! ip dhcp pool PC2 host 10.4.21.9 255.0.0.0 hardware-address 00-03-0F-D9-C8-C1 default-router 10.4.21.1 dns-server 10.4.220.101 10.4.210.101 ! IPV6_POOL\n! ipv6 dhcp pool POOLv6-VLAN150 network-address 2001:10:4:150:: 64 static-binding 2001:10:4:150::9 0a-03-af-a9-c8-c3 excluded-address 2001:10:4:150::1 dns-server 2400:3200::1 ! ipv6 dhcp pool POOLv6-VLAN140 network-address 2001:10:4:140:: 64 static-binding 2001:10:4:140::9 0a-03-0f-a9-c8-c3 excluded-address 2001:10:4:140::1 dns-server 2400:3200::1 ! ipv6 dhcp pool POOLv6-VLAN130 network-address 2001:10:4:130:: 64 static-binding 2001:10:4:130::9 00-03-0f-a9-a8-c3 excluded-address 2001:10:4:130::1 ! ipv6 dhcp pool POOLv6-VLAN21 network-address 2001:10:4:21:: 64 static-binding 2001:10:4:21::9 00-03-0f-a9-c8-c3 excluded-address 2001:10:4:21::1 dns-server 2400:3200::1 ! ipv6 dhcp pool POOLv6-VLAN11 network-address 2001:10:4:11:: 64 static-binding 2001:10:4:11::9 00-03-0f-d9-c8-c3 excluded-address 2001:10:4:11::1 dns-server 2400:3200::1 ! LOOPBACK1配置\ninterface Loopback1 ipv6 dhcp server POOLv6-VLAN11 ipv6 dhcp server POOLv6-VLAN130 ipv6 dhcp server POOLv6-VLAN140 ipv6 dhcp server POOLv6-VLAN150 ! 进入到VLAN21\n! interface Vlan21 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag ! SW1 VLAN11\ninterface Vlan11 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag !forward protocol udp 67(active)! ip helper-address 10.4.2.1 ipv6 dhcp relay destination 2001:10:4:2::1 ! E1/0/1设置 ip dhcp snooping action shutdown recovery 600\nAC1 ! interface Vlan130 no ipv6 nd suppress-ra ipv6 nd managed-config-flag. ipv6 nd other-config-flag !forward protocol udp 67(active)! ip helper-address 10.4.2.1 ipv6 dhcp relay destination 2001:10:4:2::1 ! interface Vlan140 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag !forward protocol udp 67(active)! ip helper-address 10.4.2.1 ipv6 dhcp relay destination 2001:10:4:2::1 ! interface Vlan150 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag !forward protocol udp 67(active)! ip helper-address 10.4.2.1 ipv6 dhcp relay destination 2001:10:4:2::1 均有 service dhcp ip forward-protocol udp bootps ip dhcp snooping enable service dhcpv6 savi enable savi ipv6 dhcp-only enable\n","permalink":"https://erain.fun/posts/tech/dhcp%E7%AC%94%E8%AE%B0-2023/","summary":"SW2 配置 DHCPv4 和 DHCPv6,分别为 Vlan11、Vlan21、Vlan130、 Vlan140、Vlan150 分配地址。DHCPv4 地址池名称分别","title":"DHCP笔记-2023"},{"content":" 要求FW1 与 RT2 之间用 Internet 互联地址建立 GRE Over IPSec VPN, 实现 Loopback4 之间的加密访问。RT2 的 ACL 名称为 ACL-VPN, transform-set 名称为 SET-1,crypto map 名称为 MAP-1。FW1 的 isakmp proposal 名称为 P-1,isakmp peer 名称为 PEER-1,ipsec proposal 名称为 P-2,tunnel ipsec 名称为 IPSEC-1,tunnel gre 名 称为 GRE-1。\n网络拓扑如下\nInternet交换机 200.200.200.1；200.200.200.5 RT2 连接Internet交换机 IP 地址为200.200.200.2 FW2 连接Internet交换机 自身IP为200.200.200.6 测试RT2是否能通过Internet Ping通 FW1 Ping 200.200.200.6 -i 200.200.200.2\nRT2配置\ninterface Tunnel4 ip address 10.4.255.50 255.255.255.252 tunnel source 200.200.200.6 tunnel destination 200.200.200.2 tunnel speed-up --- crypto isakmp key 0 Key-1122 address 200.200.200.2 255.255.255.255 crypto isakmp policy 1 authentication pre-share encryption 3des group 2 hash md5 ! crypto ipsec transform-set SET-1 esp-3des esp-md5-hmac ! crypto map MAP-1 1 ipsec-isakmp match address ACL-VPN set peer 200.200.200.2 set transform-set SET-1 --- ip access-list extended ACL-VPN permit gre 200.200.200.6 255.255.255.255 200.200.200.2 255.255.255.255 不要忘记了设置静态路由\nip route default 200.200.200.5 ip route 10.4.7.4 255.255.255.255 Tunnel4 ###还有 G0/2口要设置crypto map crypto map MAP-1 FW2配置\ntunnel gre \u0026quot;GRE-1\u0026quot; source 200.200.200.2 destination 200.200.200.6 interface ethernet0/3 next-tunnel ipsec IPSEC-1 --- interface tunnel4 zone \u0026quot;VPNHub\u0026quot; ip address 10.4.255.49 255.255.255.252 manage ping tunnel gre \u0026quot;GRE-1\u0026quot; Web端部分: 策略设置 Any - Any\n设置IPSEC VPN\n配置对端 共享秘钥设置与RT2一致 配置P1\n配置P2\n全部配置完后在高级设置中选择 自动连接 点击开启 查看IPSECVPN监控,状态为Active 测试路由和防火墙Loopback4是否正常互相访问\n","permalink":"https://erain.fun/posts/tech/gre-over-ipsec-%E7%AC%94%E8%AE%B0/","summary":"要求FW1 与 RT2 之间用 Internet 互联地址建立 GRE Over IPSec VPN, 实现 Loopback4 之间的加密访问。RT2 的 ACL 名称为 ACL-VPN, transform-set 名称为 SET-1,crypto map 名称为 MAP-1。FW1 的 isakmp proposal 名称为 P-1,isakmp peer 名称为","title":"GRE Over IPSec 短记"},{"content":"先前条件 Node1 Node2 Node3 192.168.1.39 192.168.1.9 192.168.1.40 关闭防火墙 停止防火墙进程 systemctl stop firewalld.service 禁用防火墙开机启动 systemctl disable firewalld.service 对三个节点分别修改主机名 hostnamectl set-hostname Node{1,2,3} 安装必要软件环境 yum install -y java-1.8.0-openjdk vim #安装jdk8和vim等必备软件 修改Hosts文件定向主机IP vim /etc/hosts node1 192.168.1.39 node2 192.168.1.9 node3 192.168.1.40 ping node1 ping node2 ping node3 测试连通性 给Node123添加hadoop用户并赋予sudo权限 Node123全部要做 [root@node2 ~]# useradd hadoop [root@node2 ~]# # 设置密码需要手动输入两次密码，笔者这里也暂时设定密码为hadoop [root@node2 ~]# passwd hadoop 更改用户 hadoop 的密码 。 新的 密码： 重新输入新的 密码： passwd：所有的身份验证令牌已经成功更新。 [root@node2 ~]# mkdir -p /data/hadoop [root@node2 ~]# chown hadoop:hadoop /data/hadoop chmod u+w /etc/sudoers vim /etc/sudoers # 在sudoers文件的root用户一行后面添加下面内容并且保存 hadoop ALL=(ALL) NOPASSWD:ALL chmod u-w /etc/sudoers sudo chmod -R a+w /data/hadoop 生成RSA密钥SSH免密登录 Node123全部要做 su hadoop ssh-keygen -t rsa ##按几次回车 cd /home/hadoop/.ssh/ cat id_rsa.pub \u0026gt;\u0026gt; authorized_keys vim authorized_keys ##把其他主机的添加进去 最后每个节点的authorized_keys内容都应该是这样的： ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTwzdM+cmFy1lO4bNpD1T5+EO0FNvBBymf3B/Pdd92/Dq3Z3cTr+XHL9HWrIZPxDoWCm7OQY9Ek3oCJgjhlnxowQbtHp8GUKmmJma19NStBNHrO8T3wpbypOgUB7xJQZclpPpxrkkiMbGEU5MV3wJxFPEA2Sd3b7sdYx2YW/hMU94UabbzV4aJjtsG9GHHx4yq9e9/P31jnidhf013F7t9lIBdCPlgHj7+feliVhjSM1jbUt3CFDsskkFXMKuzVHP6B/ipviFtLt6SA3AgDIvFFD3CYV2KgiCd7JKqR/a+8765ML9auSubf7JegDUBvVXDt+fPOVc1Lm37nCyhGLjX hadoop@node1 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD3arpeN86cemzQPdz86oQV+gKk3A9MTpNAvFNl8QLfiYft8Hscsp3oQkdyWd+vnu/VxUa7URx6iOAfaTluYOlyY18A41wnAkE9xP3861Mak8SmvPPxsj8wsC8KugBk2uGVeOHjHyMQW0Qcd/Qe/2jnqsbDJsuK7ZyxOzEHbMaIb3IRIo6x1WVUv6x4oX9mJkgZw066Wzu0nNAanDDKDmP+Ncz1OcnGoYd+B+YUqeXtPJ7acQtBoNO/2Hp35G5CK5j5VH0Yj5HKUyy1t3jv+PuSc2HVMlHLidx+CxuDYWZd2O/4GRqjnT7xLo88aBE8fAVSr876FyfJDBdYLSC66nyZ hadoop@node2 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7I19R6/js2tvicWcATaNzXlY+BVELMqDx2vhqfnlJAdlfOtyAgsaCduu8hu4El6WZymTckjX1YumeIHr8oGdajNtYugAcOcELijCFCnGUc4xcuVqVWw/Xf4TlT9wg3S9L33+Zj1EYvXp3lq04dyWO2VvZN2Iqq+bhk4tPZdGLttYqo24oXTr+kvyzYy7zeBTQmovVWaDT43ZpYSSzq5M8chjOvR0kPt/ygb/cuV2ZnTAXfNpTF/SHZIWeWqbAIexcdEnczATR/0f5Z/wFrAiG+Awppi1zNVLn1oRoC5sVQ61jqAuvZxAEp5AdgzRdTp3DFtynxVWqsgDmMFTOKNkX hadoop@node3 全部完事了记着赋予目录权限 chmod 700 /home/hadoop/.ssh/ \u0026amp;\u0026amp; chmod 700 /home/hadoop/ \u0026amp;\u0026amp; chmod 600 /home/hadoop/.ssh/authorized_keys\nssh hadoop@192.168.1.9 应该是免密码的 开始安装hadoop 下载并解压 cd /data/hadoop 把hadoop安装包复制到各个节点 [hadoop@node1 hadoop]$ scp hadoop-3.3.5.tar.gz hadoop@node2:/data/hadoop/ hadoop-3.3.5.tar.gz 100% 674MB 61.2MB/s 00:11 [hadoop@node1 hadoop]$ scp hadoop-3.3.5.tar.gz hadoop@node3:/data/hadoop/ The authenticity of host 'node3 (192.168.1.40)' can't be established. ECDSA key fingerprint is SHA256:tVUngomohqjvUulSZAx83tsqN6qn+8cMap1QbYjsFZc. ECDSA key fingerprint is MD5:33:0e:00:28:c6:55:e7:97:85:a9:10:bc:ad:19:6c:b9. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added 'node3,192.168.1.40' (ECDSA) to the list of known hosts. hadoop-3.3.5.tar.gz 100% 674MB 61.2MB/s 00:11 [hadoop@node1 hadoop]$ 解压 tar -zxvf hadoop-3.3.5.tar.gz 使用mv命令重命名为app方便记录 mv hadoop-3.3.5 app 配置环境变量 vim ~/.bashrc 写入 export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.402.b06-1.el7_9.x86_64/jre export PATH=$JAVA_HOME/bin:$PATH export HADOOP_HOME=/data/hadoop/app export PATH=$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH 保存 source ~/.bashrc hadoop安装成功 [hadoop@node1 ~]$ hadoop version Hadoop 3.3.5 Source code repository https://github.com/apache/hadoop.git -r 706d88266abcee09ed78fbaa0ad5f74d818ab0e9 Compiled by stevel on 2023-03-15T15:56Z Compiled with protoc 3.7.1 From source with checksum 6bbd9afcf4838a0eb12a5f189e9bd7 This command was run using /data/hadoop/app/share/hadoop/common/hadoop-common-3.3.5.jar ### 4、Hadoop配置 配置core-site.xml（具体是/data/hadoop/app/etc/hadoop/core-site.xml）：\n\u0026lt;configuration\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;fs.defaultFS\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;hdfs://node1:9000\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.tmp.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/data/hadoop/temp\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; fs.defaultFS：nameNode的HDFS协议的文件系统通信地址 hadoop.tmp.dir：Hadoop集群在工作的时候存储的一些临时文件的目录 配置hdfs-site.xml（具体是/data/hadoop/app/etc/hadoop/hdfs-site.xml）：\n\u0026lt;configuration\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.namenode.name.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/data/hadoop/dfs/name\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.datanode.data.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/data/hadoop/dfs/data\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.replication\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;3\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.secondary.http.address\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;node3:50090\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.http.address\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;192.168.56.200:50070\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; dfs.namenode.name.dir：NameNode的数据存放目录 dfs.datanode.data.dir：DataNode的数据存放目录 dfs.replication：HDFS的副本数 dfs.secondary.http.address：SecondaryNameNode节点的HTTP入口地址 dfs.http.address：通过HTTP访问HDFS的Web管理界面的地址 配置mapred-site.xml（具体是/data/hadoop/app/etc/hadoop/mapred-site.xml）:\n\u0026lt;configuration\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;mapreduce.framework.name\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;yarn\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;yarn.app.mapreduce.am.env\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;mapreduce.map.env\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;mapreduce.reduce.env\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; mapreduce.framework.name：选用yarn，也就是MR框架使用YARN进行资源调度。 配置yarn-site.xml（具体是/data/hadoop/app/etc/hadoop/yarn-site.xml）：\n\u0026lt;configuration\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;yarn.resourcemanager.hostname\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;node3\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;yarn.nodemanager.aux-services\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;mapreduce_shuffle\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; yarn.resourcemanager.hostname：指定ResourceManager所在的主机名 yarn.nodemanager.aux-services：指定YARN集群为MapReduce程序提供Shuffle服务 配置workers文件（这个文件在旧版本叫slaves，因为技术政治化运动被改为workers，具体是/data/hadoop/app/etc/hadoop/workers：\nnode1 node2 node3 至此，核心配置基本完成。\n同步配置到node23 scp -r /data/hadoop/app hadoop@node2:/data/hadoop scp -r /data/hadoop/app hadoop@node3:/data/hadoop 在node1上初始化节点 hadoop namenode -format\n7、启动和停止HDFS# 可以在任意一个节点中启动和停止HDFS，为了简单起见还是在hadoop01节点中操作：\n启动：start-dfs.sh 停止：stop-dfs.sh 调用启动命令后，控制台输出如下：\n[hadoop@hadoop01 hadoop]$ start-dfs.sh Starting namenodes on [hadoop01] Starting datanodes Starting secondary namenodes [hadoop03] 8、启动和停止YARN# YARN集群的启动命令必须在ResourceManager节点中调用，规划中的对应角色的节点为hadoop03，在该机器执行YARN相关命令：\n启动：start-yarn.sh 停止：stop-yarn.sh 执行启动命令后，控制台输出如下：\n[hadoop@hadoop03 data]$ start-yarn.sh Starting resourcemanager Starting nodemanagers 9、查看所有节点的进程状态# 分别查看集群中所有节点的进程状态，可以直接使用jps工具，具体结果如下：\n[hadoop@hadoop01 hadoop]$ jps 8673 NameNode 8823 DataNode 9383 NodeManager 9498 Jps [hadoop@hadoop02 hadoop]$ jps 4305 DataNode 4849 Jps 4734 NodeManager [hadoop@hadoop03 data]$ jps 9888 Jps 9554 NodeManager 5011 DataNode 9427 ResourceManager 5125 SecondaryNameNode 可见进程是正常运行的。\n![[Snipaste_2024-03-19_10-23-23.png]] ![[Snipaste_2024-03-19_10-24-26.png]]\n后续软件补充 Spark2.1.0 HBase1.1.5 Scala2.11.8 MySQL Kafka_2.11-0.10.2.0 Flume1.7.0 sbt Maven3.3.9 MongoDB3.2.17 Hive2.1.0 Scala IDE（包含Eclipse4.7.0和Maven、Scala、sbt插件） 只是简单记录，可能某些地方会有小错误，如有发现，联系我修改\n","permalink":"https://erain.fun/posts/tech/hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/","summary":"先前条件 Node1 Node2 Node3 192.168.1.39 192.168.1.9 192.168.1.40 关闭防火墙 停止防火墙进程 systemctl stop firewalld.service 禁用防火墙开机启动 systemctl disable firewalld.service 对三个节点分别修改主机名 hostnamectl set-hostname Node{1,2,3} 安装必要软件环境 yum install -y java-1.8.0-openjdk vim #安装jd","title":"Hadoop集群配置"},{"content":"SW1、SW2、SW3、RT1 以太链路、RT2 以太链路、FW1、FW2、AC1 之间运行 OSPFv2 和 OSPFv3 协议 注意要求 按照IP 地址从小到大的顺序发布 每个 prefix-list 的序号从 5 开始 按照 IP 地址从小到大的顺序递增 5 route-map 的序号从 10 开始 递增 10 route-map 名称与 prefix-list 名称相同 每个 ACL 序号从 10 开始,按照 IP 地址从小到大的顺序递增 10 OSPFv2部分 SW1、SW2、SW3、RT1、RT2、FW1 之间 OSPFv2 和 OSPFv3 协议 进程1 区域号 0 分别发布 Loopback1 地址路由和产品路由 FW1通告 type1默认路由 RT2 与 AC1 之间运行 OSPFv2 协议,进程 1 区域 1 nssa no-summar AC1 发布 Loopback1 地址路由、管理、产品和营销路由 AC1用 prefix-list 重发布 Loopback3 prefix-list 名称为 AC1-Loopback3-IPv4 SW1\nrouter ospf 1 ospf router-id 10.4.1.1 network 10.4.1.1/32 area 0 network 10.4.11.0/24 area 0 network 10.4.220.0/24 area 0 network 10.4.255.0/30 area 0 network 10.4.255.4/30 area 0 network 10.4.255.12/30 area 0 network 192.168.2.0/24 area 0 ! SW2\nrouter ospf 1 ospf router-id 10.4.2.1 network 10.4.2.1/32 area 0 network 10.4.21.0/24 area 0 network 10.4.210.0/24 area 0 network 10.4.255.0/30 area 0 network 10.4.255.8/30 area 0 network 10.4.255.20/30 area 0 network 192.168.100.0/24 area 0 SW3\nrouter ospf 1 ospf router-id 10.4.3.1 network 10.4.3.1/32 area 0 network 10.4.31.0/24 area 0 network 10.4.255.4/30 area 0 network 10.4.255.8/30 area 0 ! AC1\nrouter ospf 1 ospf router-id 10.4.4.1 area 1 nssa no-summary network 10.4.4.1/32 area 1 network 10.4.130.0/24 area 1 network 10.4.140.0/24 area 1 network 10.4.150.0/24 area 1 network 10.4.255.44/30 area 1 redistribute connected route-map AC1-Loopback3-IPv4 ip prefix-list AC1-Loopback3-IPv4 seq 5 permit 10.4.4.3/32 route-map AC1-Loopback3-IPv4 permit 10 match ip address prefix-list AC1-Loopback3-IPv4 配置nssa特区 area 1 nssa no-summary\n配置 prefix-list 序号为5 匹配 Loopback4 地址 ip prefix-list AC1-Loopback3-IPv4 seq 5 permit 10.4.4.3/32 配置 route-map 序号为 10 匹配AC1-Loopback3-IPv4 通过\nroute-map AC1-Loopback3-IPv4 permit 10 match ip address prefix-list AC1-Loopback3-IPv4 过滤重发布 redistribute connected route-map AC1-Loopback3-IPv4\nRT1\nrouter ospf 1 router-id 10.4.5.1 network 10.4.5.1 255.255.255.255 area 0 network 10.4.255.16 255.255.255.252 area 0 network 10.4.255.20 255.255.255.252 area 0 network 10.4.255.32 255.255.255.252 area 0 RT2\nrouter ospf 1 router-id 10.4.6.1 network 10.4.6.1 255.255.255.255 area 0 network 10.4.255.32 255.255.255.252 area 0 network 10.4.255.44 255.255.255.252 area 1 area 1 nssa no-summary 配置nssa特区 area 1 nssa no-summary\nFW1\nrouter ospf 1 router-id 10.4.7.1 default-information originate always type 1 network 10.4.7.1/32 area 0 network 10.4.255.12/30 area 0 network 10.4.255.16/30 area 0 FW1通告type1默认路由 default-information originate always type 1\nFW2\nrouter ospf 2 router-id 10.4.8.1 network 10.4.8.1/32 area 2 network 10.4.255.24/30 area 2 network 10.4.255.28/30 area 2 RT1 FW2 SW3 模拟办事处之间运行 OSPFv2协议 进程 2 区域 2 SW3 模拟办事处发布 Loopback2、产品和营销路由 FW2发布 Loopback1 路由。 RT1 发布 Loopback4 路由,向该区域通告 type1默认路由 RT1 用 prefix-list 匹配 SW3 模拟办事处 Loopback2 和产品路由、 FW2 Loopback1 路由(prefix-list 名称分别为 SW3-FW2-IPv4 RT1 与 FW2 直连 IPv4 路由(prefix-list 名称为RT1-FW2-IPv4) 以上路由重发布到 process 1 RT1\nrouter ospf 2 router-id 10.4.5.4 network 10.4.5.4 255.255.255.255 area 2 network 10.4.255.24 255.255.255.252 area 2 default-information originate always metric-type 1 FW2\nrouter ospf 2 router-id 10.4.8.1 network 10.4.8.1/32 area 2 network 10.4.255.24/30 area 2 network 10.4.255.28/30 area 2 SW3\n! router ospf 2 vrf Office ospf router-id 10.4.3.2 network 10.4.3.2/32 area 2 network 10.4.110.0/24 area 2 network 10.4.120.0/24 area 2 network 10.4.255.28/30 area 2 ! 重发布\nprefix-list 匹配 SW3 模拟办事处 Loopback2 产品路由 FW2 Loopback1 路由prefix-list 名称为 SW3-FW2-IPv4\nRT1\n配置prefix-list\nip prefix-list SW3-FW2-IPv4 seq 5 permit 10.4.3.2/32 ip prefix-list SW3-FW2-IPv4 seq 10 permit 10.4.8.1/32 ip prefix-list SW3-FW2-IPv4 seq 15 permit 10.4.110.0/24 配置route-map\nroute-map SW3-FW2-IPv4 10 permit match ip address prefix-list SW3-FW2-IPv4 重发布到 进程 1\nrouter ospf 1 redistribute ospf 2 route-map SW3-FW2-IPv4 RT1 与 FW2 直连 IPv4 路由(prefix-list 名称为RT1-FW2-IPv4) 以上路由重发布到 process 1\nip prefix-list RT1-FW2-IPv4 seq 5 permit 10.4.255.24/30 route-map RT1-FW2-IPv4 10 permit match ip address prefix-list RT1-FW2-IPv4 router ospf 1 redistribute connect route-map RT1-FW2-IPv4 修改 ospf cost 为 100,实现 SW1 分别与 RT2、FW2 之间 IPv4 和 IPv6互访流量优先通过 SW1-SW2-RT1 链路转发,SW2 访问 Internet IPv4和 IPv6 流量优先通过 SW2-SW1-FW1 链路转发 四条链路全部配置Cost花费100\nip ospf cost 100 ipv6 ospf cost 100 OSPFv6部分 SW1、SW2、SW3、RT1、RT2、FW1 OSPFv3 协议process1 area 0 分别发布Loopback1 地址路由和产品路由 FW1 通告 type1默认路由 RT2 与 AC1 之间运行 OSPFv3 协议,process 1,area 1 stub no-summary AC1 发布 Loopback1 地址路由、管理、产品和营销路由 RT1、FW2、SW3 模拟办事处之间运行 OSPFv3 协议 process2 area 2 SW3 模拟办事处发布 Loopback2、产品和营销路由 FW2发布 Loopback1 路由 RT1 发布 Loopback4 路由 向该区域通告 type1默认路由 RT1 用 prefix-list 匹配 SW3 模拟办事处 Loopback2 和产品路由、 FW2 Loopback1 路由(prefix-list 名称分别为 SW3-FW2-IPv4和 SW3-FW2-IPv6)、RT1 与 FW2 直连 IPv4 路由(prefix-list 名称为RT1-FW2-IPv4),以上路由重发布到 process 1。 SW1\n! router ipv6 ospf 1 router-id 10.4.1.1 ! router ipv6 ospf 2 vrf Finance router-id 10.4.1.2 ! interface Vlan1019 ip ospf cost 100 ipv6 ospf cost 100 ipv6 router ospf area 0 tag 1 ip address 10.4.255.14 255.255.255.252 ! interface Vlan1020 ipv6 router ospf area 0 tag 1 ip address 10.4.255.5 255.255.255.252 ! interface Vlan1023 ip ospf cost 100 ipv6 router ospf area 0 tag 1 ip address 10.4.255.1 255.255.255.252 ! interface Vlan1024 ip vrf forwarding Finance ipv6 router ospf area 2 tag 2 ip address 10.4.255.1 255.255.255.252 ! interface Loopback1 ipv6 address 2001:10:4:1::1/128 ipv6 router ospf area 0 tag 1 ip address 10.4.1.1 255.255.255.255 ! interface Loopback2 ip vrf forwarding Finance ipv6 address 2001:10:4:1::2/128 ipv6 router ospf area 2 tag 2 ip address 10.4.1.2 255.255.255.255 ! SW2\ninterface Vlan21 ipv6 address 2001:10:4:21::1/64 ipv6 router ospf area 0 tag 1 interface Vlan1019 ip ospf cost 100 ipv6 ospf cost 100 ipv6 router ospf area 0 tag 1 ip address 10.4.255.22 255.255.255.252 ! interface Vlan1020 ipv6 router ospf area 0 tag 1 ip address 10.4.255.9 255.255.255.252 ! interface Vlan1023 ip ospf cost 100 ipv6 router ospf area 0 tag 1 ip address 10.4.255.2 255.255.255.252 ! interface Vlan1024 ip vrf forwarding Finance ipv6 router ospf area 2 tag 2 ip address 10.4.255.2 255.255.255.252 ! interface Loopback1 ipv6 address 2001:10:4:2::1/128 ipv6 router ospf area 0 tag 1 interface Loopback2 ip vrf forwarding Finance ipv6 address 2001:10:4:2::2/128 ipv6 router ospf area 2 tag 2 ip address 10.4.2.2 255.255.255.255 router ipv6 ospf 1 router-id 10.4.2.1 ! router ipv6 ospf 2 vrf Finance router-id 10.4.2.2 SW3\ninterface Vlan31 ipv6 address 2001:10:4:31::1/64 ipv6 router ospf area 0 tag 1 ip address 10.4.31.1 255.255.255.0 ! interface Vlan110 ip vrf forwarding Office ipv6 address 2001:10:4:110::1/64 ipv6 router ospf area 2 tag 2 ip address 10.4.110.1 255.255.255.0 ! interface Vlan120 ip vrf forwarding Office ipv6 address 2001:10:4:120::1/64 ipv6 router ospf area 2 tag 2 ip address 10.4.120.1 255.255.255.0 ! interface Vlan1015 ip vrf forwarding Office ipv6 router ospf area 2 tag 2 ip address 10.4.255.30 255.255.255.252 ! interface Vlan1019 ipv6 router ospf area 0 tag 1 ip address 10.4.255.6 255.255.255.252 ! interface Vlan1020 ipv6 router ospf area 0 tag 1 ip address 10.4.255.10 255.255.255.252 ! interface Loopback1 ipv6 address 2001:10:4:3::1/128 ipv6 router ospf area 0 tag 1 ip address 10.4.3.1 255.255.255.255 ! interface Loopback2 ip vrf forwarding Office ipv6 address 2001:10:4:3::2/128 ipv6 router ospf area 2 tag 2 ip address 10.4.3.2 255.255.255.255 ! AC1\ninterface Vlan130 ipv6 address 2001:10:4:130::1/64 ipv6 router ospf area 1 tag 1 ip address 10.4.130.1 255.255.255.0 ! interface Vlan140 ipv6 address 2001:10:4:140::1/64 ipv6 router ospf area 1 tag 1 ip address 10.4.140.1 255.255.255.0 ! interface Vlan150 ipv6 address 2001:10:4:150::1/64 ipv6 router ospf area 1 tag 1 ip address 10.4.150.1 255.255.255.0 ! interface Vlan1001 ipv6 router ospf area 1 tag 1 ip address 10.4.255.46 255.255.255.252 ! interface Loopback1 ipv6 address 2001:10:4:4::1/128 ipv6 router ospf area 1 tag 1 ip address 10.4.4.1 255.255.255.255 ! ! router ipv6 ospf 1 router-id 10.4.4.1 area 1 stub no-summary RT1\nrouter ospfv3 1 router-id 10.4.5.1 redistribute ospf 2 route-map SW3-FW2-IPv6 router ospfv3 2 router-id 10.4.5.4 interface Loopback1 ip address 10.4.5.1 255.255.255.255 ipv6 enable ipv6 address 2001:10:4:5::1/128 ipv6 ospf 1 area 0 interface Loopback4 ip address 10.4.5.4 255.255.255.255 ipv6 address 2001:10:4:5::4/128 ipv6 ospf 2 area 2 interface GigaEthernet0/0 ip address 10.4.255.33 255.255.255.252 ipv6 enable ipv6 ospf 1 area 0 interface GigaEthernet0/1 ip address 10.4.255.18 255.255.255.252 ipv6 enable ip ospf cost 100 ipv6 ospf 1 area 0 ipv6 ospf cost 100 interface GigaEthernet0/2 ip address 10.4.255.21 255.255.255.252 ipv6 enable ip ospf cost 100 ipv6 ospf 1 area 0 ipv6 ospf cost 100 interface GigaEthernet0/3 ip address 10.4.255.25 255.255.255.252 ipv6 enable ipv6 ospf 2 area 2 RT2\nrouter ospfv3 1 router-id 10.4.6.5 area 1 stub no-summary interface Loopback1 ip address 10.4.6.1 255.255.255.255 ipv6 enable ipv6 address 2001:10:4:6::1/128 ipv6 ospf 1 area 0 interface GigaEthernet0/0 ip address 10.4.255.34 255.255.255.252 ipv6 enable ipv6 ospf 1 area 0 interface GigaEthernet0/1 ip address 10.4.255.45 255.255.255.252 ipv6 enable ipv6 ospf 1 area 1 FW1\ninterface ethernet0/1 zone \u0026quot;trust\u0026quot; ip address 10.4.255.13 255.255.255.252 ipv6 enable manage ping ip ospf cost 100 ipv6 ospf 1 area 0 interface ethernet0/2 zone \u0026quot;trust\u0026quot; ip address 10.4.255.17 255.255.255.252 ipv6 enable manage ping ip ospf cost 100 ipv6 ospf 1 area 0 exit FW2\ninterface ethernet0/1 zone \u0026quot;dmz\u0026quot; ip address 10.4.255.26 255.255.255.252 ipv6 enable manage ping ipv6 ospf 2 area 2 exit interface ethernet0/2 zone \u0026quot;trust\u0026quot; ip address 10.4.255.29 255.255.255.252 ipv6 enable manage ping ipv6 ospf 2 area 2 exit interface loopback1 zone \u0026quot;trust\u0026quot; ip address 10.4.8.1 255.255.255.255 ipv6 enable ipv6 address 2001:10:4:8::1/128 manage ping ipv6 ospf 2 area 2 重发布\n! route-map SW3-FW2-IPv6 10 permit match ipv6 address prefix-list SW3-FW2-IPv6 ! ! ipv6 prefix-list SW3-FW2-IPv6 seq 5 permit 2001:10:4:3::2/128 ipv6 prefix-list SW3-FW2-IPv6 seq 10 permit 2001:10:4:8::1/128 ipv6 prefix-list SW3-FW2-IPv6 seq 15 permit 2001:10:4:110::/64 router ospfv3 1 router-id 10.4.5.1 redistribute ospf 2 route-map SW3-FW2-IPv6 ","permalink":"https://erain.fun/posts/tech/ospf%E9%A2%98%E7%9B%AE%E9%83%A8%E5%88%86/","summary":"SW1、SW2、SW3、RT1 以太链路、RT2 以太链路、FW1、FW2、AC1 之间运行 OSPFv2 和 OSPFv3 协议 注意要求 按照IP 地址从小到大的顺序发布 每个 prefix-list","title":"OSPF题目部分"},{"content":"交换机部分 1、生成树spanning-tree SW1、SW2、SW3启用MSTP，实现网络二层负载均衡和冗余备份，创建实例Instance10和Instance20，名称为SKILLS，修订版本为1，其中Instance10关联vlan60和vlan70，Instance20关联vlan80和vlan90。SW1为Instance0和Instance10的根交换机，为Instance20备份根交换机；SW2为Instance20根交换机，为Instance0和Instance10的备份根交换机；根交换机STP优先级为0，备份根交换机STP优先级为4096。关闭交换机之间三层互联接口的STP。 SW1配置步骤： 进入全局配置模式：enable\n配置Instance0为根交换机：\nconf t spanning-tree mst 0 priority 0\n配置Instance10为根交换机：\nspanning-tree mst 10 priority 0\n配置Instance20为备份根交换机：\nspanning-tree mst 20 priority 4096\n禁用Ethernet1/0/22和Ethernet1/0/26上的STP：\ninterface Ethernet1/0/22 no spanning-tree interface Ethernet1/0/26 no spanning-tree`\nSW2配置步骤： 进入全局配置模式：enable\n配置Instance0为备份根交换机：\nconf t spanning-tree mst 0 priority 4096\n配置Instance10为备份根交换机：\nspanning-tree mst 10 priority 4096\n配置Instance20为根交换机： spanning-tree mst 20 priority 0\n禁用Ethernet1/0/22和Ethernet1/0/26上的STP： interface Ethernet1/0/22 no spanning-tree interface Ethernet1/0/26 no spanning-tree`\nSW3配置步骤： 进入全局配置模式：enable\n禁用Ethernet1/0/21和Ethernet1/0/22上的STP：\nconf t interface Ethernet1/0/21 no spanning-tree interface Ethernet1/0/22 no spanning-tree\n完成以上配置后，网络中的生成树协议将按照所配置的优先级和备份关系进行运行，实现二层负载均衡和冗余备份的目标。\n2、链路聚合（LACP）： SW1 和 SW2 之间利用三条裸光缆实现互通，其中一条裸光缆承载三层 IP业务、一条裸光缆承载 VPN 业务、一条裸光缆承载二层业务。用相关技术分别实现财务 1 段、财务 2 段业务路由表与其它业务路由表隔离，财务业务 VPN 实例名称为 CW。 SW1配置： 进入全局配置模式：\nSW1\u0026gt; enable SW1# configure terminal 创建端口组并配置为主动模式：\nSW1(config)# port-channel 1 SW1(config)# interface range Ethernet1/0/25 - 28 SW1(config-if-range)# channel-group 1 mode active 配置流量负载均衡模式为源和目的 IP 地址：\nSW1(config)# port-channel load-balance dst-src-ip SW2配置： 进入全局配置模式：\nSW2\u0026gt; enable SW2# configure terminal 创建端口组并配置为主动模式：\nSW2(config)# port-channel 1 SW2(config)# interface range Ethernet1/0/25 - 28 SW2(config-if-range)# channel-group 1 mode active 配置流量负载均衡模式为源和目的 IP 地址：\nSW2(config)# port-channel load-balance dst-src-ip 配置结果验证： 你可以使用以下命令来验证链路聚合的配置是否成功：\n配置结果： SW1#sho port-group 1 detail Flags: A -- LACP_Activity, B -- LACP_timeout, C -- Aggregation, D -- Synchronization, E -- Collecting, F -- Distributing, G -- Defaulted, H -- Expired Port-group number: 1, Mode: active, Load-balance: dst-src-ip Port-group detail information: System ID: 0x8000,00-03-0f-e0-f9-b3 Local: Port Status Priority Oper-Key Flag ----------------------------------------------------------- Ethernet1/0/25 Unselected 32768 1 {ACG} Ethernet1/0/28 Selected 32768 1 {ACDEF} Remote: Actor Partner Priority Oper-Key SystemID Flag -------------------------------------------------------------------------------- Ethernet1/0/28 28 32768 1 0x8000,00-03-0f-e0-f9-b6 {ACDEF} SW2----------------------------------------------=---------=-=-=-=-=-= SW2#sho port-group 1 detail Flags: A -- LACP_Activity, B -- LACP_timeout, C -- Aggregation, D -- Synchronization, E -- Collecting, F -- Distributing, G -- Defaulted, H -- Expired Port-group number: 1, Mode: active, Load-balance: dst-src-ip Port-group detail information: System ID: 0x8000,00-03-0f-e0-f9-b6 Local: Port Status Priority Oper-Key Flag ----------------------------------------------------------- Ethernet1/0/25 Unselected 32768 1 {ACG} Ethernet1/0/28 Selected 32768 1 {ACDEF} Remote: Actor Partner Priority Oper-Key SystemID Flag -------------------------------------------------------------------------------- Ethernet1/0/28 28 32768 1 0x8000,00-03-0f-e0-f9-b3 {ACDEF} 3、路由表隔离VPN 将 SW3 模拟为 Internet 交换机，实现与集团其它业务路由表隔离，Internet 路由表 VPN 实例名称为 Internet。将 SW3 模拟办事处交换机，实现与集团其它业务路由表隔离，办事处路由表 VPN 实例名称为 Guangdong。 SW3配置： 创建VPN实例并分配VRF：\nSW3(config)# ip vrf Guangdong SW3(config)# ip vrf Internet 配置Loopback接口并分配给相应的VRF：\nSW3(config)# interface Loopback2 SW3(config-if)# ip vrf forwarding Guangdong SW3(config-if)# ip address 10.10.3.2 255.255.255.255 SW3(config)# interface Loopback3 SW3(config-if)# ip vrf forwarding Internet SW3(config-if)# ip address 200.200.3.3 255.255.255.255 配置VLAN接口并分配给相应的VRF：\nSW3(config)# interface Vlan110 SW3(config-if)# ip vrf forwarding Guangdong SW3(config-if)# ip address 10.16.110.1 255.255.255.0 SW3(config)# interface Vlan120 SW3(config-if)# ip vrf forwarding Guangdong SW3(config-if)# ip address 10.16.120.1 255.255.255.0 SW3(config)# interface Vlan1015 SW3(config-if)# ip vrf forwarding Guangdong SW3(config-if)# ip address 10.10.255.46 255.255.255.252 SW3(config)# interface Vlan1017 SW3(config-if)# ip vrf forwarding Internet SW3(config-if)# ip address 200.200.200.1 255.255.255.252 SW3(config)# interface Vlan1018 SW3(config-if)# ip vrf forwarding Internet SW3(config-if)# ip address 200.200.200.5 255.255.255.252 配置结果验证： 您可以使用以下命令来验证VRF配置：\nSW3#sho ip vrf VRF Guangdong, FIB ID 1 Router ID: 10.10.3.2 (loopback) Interfaces: Vlan110 Vlan120 Vlan1015 Loopback2 ! VRF Internet, FIB ID 2 Router ID: 200.200.3.3 (loopback) Interfaces: Vlan1017 Vlan1018 Loopback3 ! VRF Guangdong; (id=1); RIP is not enabled VRF Internet; (id=2); RIP is not enabled Name Interfaces Guangdong Vlan110 Vlan120 Vlan1015 Loopback2 Internet Vlan1017 Vlan1018 Loopback3 Name Default RD Interfaces Guangdong Vlan110 Vlan120 Vlan1015 Loopback2 Internet Vlan1017 Vlan1018 Loopback3 4、端口安全 SW1 法务物理接口限制收发数据占用的带宽均为 1000Mbps，限制所有报文最大收包速率为 1000packets/s，如果超过了配置交换机端口的报文最大收包速率则关闭此端口，1 分钟后恢复此端口；启用端口安全功能，最大安全 MAC 地址数为 20，当超过设定 MAC 地址数量的最大值，不学习新的 MAC、丢弃数据包、发nmp trap、同时在 syslog 日志中记录，端口的老化定时器到期后，在老化周期中没有流量的部分表项老化，有流量的部分依旧保留，恢复时间为 10 分钟；禁止采用访控制列表，只允许 IP 主机位为 20-50 的数据包进行转发；禁止配置访问控制列表，实现端口间二层流量无法互通，组名称 FW。 SW1配置： 配置端口带宽限制和报文最大收包速率：\nSW1(config)# interface Ethernet1/0/3 SW1(config-if)# bandwidth control 1000000 both SW1(config-if)# rate-violation all 1000 SW1(config-if)# rate-violation control shutdown recovery 60 启用端口安全功能并设置最大安全MAC地址数：\nSW1(config-if)# switchport port-security SW1(config-if)# switchport port-security maximum 20 配置违规处理策略：\nSW1(config-if)# switchport port-security violation restrict recovery 600 配置MAC地址学习控制和老化定时器类型：\nSW1(config)# mac-address-learning cpu-control SW1(config)# interface Ethernet1/0/3 SW1(config-if)# switchport port-security aging type inactivity 启用AM功能并配置IP池：\nSW1(config)# am enable SW1(config)# interface Ethernet1/0/3 SW1(config-if)# am port SW1(config-if)# am ip-pool 10.10.120.20 31 禁止端口间二层流量互通，并应用组名称为FW：\nSW1(config)# isolate-port group FW switchport interface Ethernet1/0/3 SW1(config)# isolate-port apply l2 配置结果验证： 您可以使用以下命令来验证端口安全配置：\nSW1# show running-config interface Ethernet1/0/3 SW1# show isolate-port group FW SW1(config-if-ethernet1/0/3)#sho run c bandwidth control 1000000 both rate-violation all 1000 rate-violation control shutdown recovery 60 switchport access vlan 30 switchport port-security switchport port-security maximum 20 switchport port-security violation restrict recovery 600 switchport port-security aging type inactivity am port am ip-pool 10.10.120.20 31 SW1#sho isolate-port group FW Isolate-port group FW The isolate-port Ethernet1/0/3 5、开启日志记录\u0026amp;保护功能： 开启 SW1日志记录功能和保护功能，采样周期5s一次，恢复周期为100s，从而保障 CPU 稳定运行。 SW1配置： 开启日志记录功能：\nSW1(config)# cpu-protect log enable 开启保护功能并设置采样周期和恢复周期：\nSW1(config)# cpu-protect enable SW1(config)# cpu-protect interval 5 SW1(config)# cpu-protect recovery-time 100 配置结果验证： 您可以使用以下命令来验证CPU保护的运行配置：\nSW1# show cpu-protect running-config SW1#sho cpu-protect running-config Cpu-Protect Globle: enable Cpu-Protect trap : disable Cpu-Protect Log: enable Cpu-Protect Interval: 5 Cpu-Protect Recovery-Time: 100 Cap-Num Ip-Num Mac-Num Protocal-Num 0 0 0 0 Stream Threshould Limit-Speed Action IP 300 150 Speed-Limit DHCP 150 80 Speed-Limit IGMP 150 80 Speed-Limit ARP 300 150 Speed-Limit ICMP 80 50 Speed-Limit PER-IP 400 200 Speed-Limit PER-MAC 400 200 Speed-Limit 6、SNMP配置： SW1 配置 SNMP，引擎 id 分别为 1；创建组 GROUP2022，采用最高安全级别，配置组的读、写视图分别为：SKILLS_R、SKILLS_W；创建认证用户为SER2022，采用 aes 算法进行加密，密钥为 Pass-1234，哈希算法为 sha，密钥为 Pass-1234；当设备有异常时，需要用本地的环回地址 loopback1 发送 v3 Trap 消息至集团网管服务器 10.10.11.99、2001:10:10:11::99，采用最高安全级别； SW1配置： 启用SNMP功能：\nsnmp-server enable 配置允许接收SNMP消息的安全IP地址：\nsnmp-server securityip 10.1.15.120 snmp-server securityip 2001:10:1:15::120 配置Trap消息的源IP地址：\nsnmp-server trap-source 10.1.1.1 snmp-server trap-source 2001:10:1:1::1 配置SNMP引擎ID：\nsnmp-server engineid 1000 创建SNMP认证用户和组：\nsnmp-server user UserSkills GroupSkills authPriv aes Key-1122 auth sha Key-1122 snmp-server group GroupSkills authpriv read Skills_R write Skills_W 配置发送Trap消息的目标主机：\nsnmp-server host 10.1.1.1 v3 authpriv UserSkills snmp-server host 2001:10:1:1::1 v3 authpriv UserSkills 启用SNMP Trap：\nsnmp-server enable traps 配置结果验证： 您可以使用以下命令验证SNMP配置的结果：\nSW1# show snmp engineid SW1# show snmp group SW1# show snmp status SW1# show snmp user SW1# show running-config interface Ethernet1/0/3 SW1(config)#sho snmp engineid SNMP engineID:1 Engine Boots is:1 SW1(config)#sho snmp group Group Name:GROUP2022 Security Level:AuthPriv Read View:SKILLS_R Write View:SKILLS_W Notify View:\u0026lt;no notifyview specified\u0026gt; SW1(config)#sho snmp status System Name : DC YunKe Networks Co.,Ltd. System Contact : 400-810-9119 System Location : China Trap enable RMON enable Community Information: V1/V2c Trap Host Information: V3 Trap Host Information: Trap-rec-address: 2001:10:10:11::99 User-name :USER2022 Security Level:AuthPriv Trap-rec-address: 10.10.11.99 User-name :USER2022 Security Level:AuthPriv Security IP is Enabled. Security IP: 10.10.11.99 Security IP: 2001:10:10:11::99 SW1(config)#sho snmp user User name: USER2022 Engine ID: 0x31 Auth Protocol:SHA Priv Protocol:AES-CFB-128 Row status:active 当法务部门对应的用户接口发生 UP DOWN 事件时，禁止发送 trap 消息至上述集团网管服务器。 SW1(config-if-ethernet1/0/3)#sho run c no switchport updown notification enable 7、互联流量镜像 将 W1 与 FW1 互连流量镜像到 SW1 E1/0/1，会话列表为 1。\nmonitor session 1 source interface Ethernet1/0/21 tx monitor session 1 source interface Ethernet1/0/21 rx monitor session 1 destination interface Ethernet1/0/1 配置结果：\nSW1(config)#sho monitor monitor session 1: Destination Ethernet1/0/1 Card: slot 1 source ports: RX port: 21 TX port: 21 -------------------------------------------------------- No monitor in session 2 -------------------------------------------------------- No monitor in session 3 -------------------------------------------------------- No monitor in session 4 -------------------------------------------------------- No monitor in session 5 -------------------------------------------------------- No monitor in session 6 -------------------------------------------------------- No monitor in session 7 -------------------------------------------------------- 8、ULDP： SW1 和 SW2 E1/0/21-28 启用单向链路故障检测，当发生该故障时，端口标记为 errdisable 状态，自动关闭端口，经过 1 分钟后，端口自动重启；发送 Hello 报文时间间隔为 15s。\nSW1配置： SW1(config)# uldp enable SW1(config)# uldp aggressive-mode SW1(config)# interface range Ethernet1/0/21-28 SW1(config-if-range)# uldp enable SW1(config-if-range)# uldp aggressive-mode SW1(config)# uldp recovery-time 60 SW1(config)# uldp hello-interval 15 SW2配置： SW2(config)# uldp enable SW2(config)# uldp aggressive-mode SW2(config)# interface range Ethernet1/0/21-28 SW2(config-if-range)# uldp enable SW2(config-if-range)# uldp aggressive-mode SW2(config)# uldp recovery-time 60 SW2(config)# uldp hello-interval 15 配置结果： SW1(config)# sho uldp uldp enable uldp hello interval is 15 uldp recovery time is 60 uldp shut down mode is AUTO uldp global work mode is AGGRESSIVE the total number of the port is 8 --------------------------------------------------------------------------- PortName PhyLink LineProto WorkMode PortState NeighborNum --------------------------------------------------------------------------- Ethernet1/0/21 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/22 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/23 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/24 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/25 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/26 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/27 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/28 UP UP AGGRESSIVE BIDIRECTION 1 --------------------------------------------------------------------------- SW2(config)# sho uldp uldp enable uldp hello interval is 15 uldp recovery time is 60 uldp shut down mode is AUTO uldp global work mode is AGGRESSIVE the total number of the port is 8 --------------------------------------------------------------------------- PortName PhyLink LineProto WorkMode PortState NeighborNum --------------------------------------------------------------------------- Ethernet1/0/21 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/22 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/23 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/24 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/25 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/26 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/27 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/28 UP UP AGGRESSIVE BIDIRECTION 1 --------------------------------------------------------------------------- 9、LLDP： SW1和SW2所有端口启用链路层发现协议，更新报文发送时间间隔为20s，老化时间乘法器值为 5，Trap 报文发送间隔为 10s，配置三条裸光缆端口使能Trap 功能。\nSW1配置： SW1(config)# lldp enable SW1(config)# lldp msgTxHold 5 SW1(config)# lldp tx-interval 10 ! Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable SW2配置： SW2(config)# lldp enable SW2(config)# lldp msgTxHold 5 SW2(config)# lldp tx-interval 10 ! Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable 配置结果： SW1# sho lldp -----LLDP GLOBAL INFORMATIONS----- LLDP has been enabled globally. LLDP enabled port : Ethernet1/0/21 Ethernet1/0/22 Ethernet1/0/23 Ethernet1/0/26 Ethernet1/0/27 Ethernet1/0/28 LLDP interval :10 LLDP txTTL :50 LLDP NotificationInterval :5 LLDP txDelay :2 LLDP-MED FastStart Repeat Count :4 -------------END------------------ SW1(config)# interface range Ethernet1/0/26-28 SW1(config-if-range)# sho run c Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable Sw2!!!!!!!!!!!! SW2# sho lldp -----LLDP GLOBAL INFORMATIONS----- LLDP has been enabled globally. LLDP enabled port : Ethernet1/0/21 Ethernet1/0/22 Ethernet1/0/23 Ethernet1/0/26 Ethernet1/0/27 Ethernet1/0/28 LLDP interval :10 LLDP txTTL :50 LLDP NotificationInterval :5 LLDP txDelay :2 LLDP-MED FastStart Repeat Count :4 -------------END------------------ SW2(config)# interface range Ethernet1/0/26-28 SW2(config-if-range)# sho run c Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable 路由器部分 1、SSH服务 启用所有设备的 ssh 服务，防火墙用户名 admin，明文密码 Pass-1234，其余设备用户名和明文密码均为 admin\n交换机\u0026amp;AC： SW(config)#ssh-server enable SW(config)#username admin password 0 admin 路由器： RT1_config#username admin password 0 admin RT1_config#aaa authentication login default local RT1_config#aaa authentication enable default none RT1_config#ip sshd enable 防火墙： 需要在web页面上开启 \u0026lt;你一定能找到的=-=\u0026gt; 2、配置时区 配置所有设备的时区为 GMT+08:00，调整 SW1 时间为实际时间，SW1 配置为 ntp server，其他设备用 SW1 loopback1 ipv4 地址作为 ntp server 地址，ntp client 请求报文时间间隔 1 分钟。\nSW1配置： SW1#clock set 14:41:30 2023.4.24 SW1#config SW1(config)#clock timezone GMT add 8 0 SW1(config)#ntp enable SW1(config)#ntp-service refclock-master 1 SW1(config)#ntp server 10.10.1.1 SW1(config)#ntp syn-interval 60 SW2、SW3、AC配置： clock timezone GMT add 8 0 ntp enable ntp syn-interval 60 ntp server 10.10.1.1 路由器配置： time-zone GMT 8 0 ntp query-interval 60 ntp server 10.10.1.1 防火墙配置： FW1(config)# clock zone GMT 8 0 FW1(config)# ntp enable FW1(config)# ntp server 10.10.1.1 FW1(config)# ntp query-interval 1 配置结果： SW1(config)#sho clock Current time is Mon Apr 24 15:13:30 2023 [GMT+08:00] SW1(config)#sho ntp status ntp clock status: synchronized Clock stratum:4 Reference clock server:10.10.1.1 Clock offset:0.0 s Root delay:0.000 ms Root dispersion:0.000 ms Reference time:Mon Apr 24 07:06:3.203 2023 Syn-interval:60s 3、VRRP 利用 vrrpv2 和 vrrpv3 技术实现 vlan60、vlan70、vlan80、vlan90 网关冗余备份，vrrp id 与 vlan id 相同。vrrpv2 vip 为 10.10.vlanid.9（如 vlan60的 vrrpv2 vip 为 10.10.60.9），vrrpv3 vip 为 FE80:vlanid::9（如 vlan60 的vrrpv3 vip 为 FE80:60::9）。配置 SW1 为 vlan60、vlan70 的 Master，SW2 为vlan80、vlan90 的 aster。要求 vrrp 组中高优先级为 120，低优先级为默认值，抢占模式为默认值，vrrpv2 和 vrrpv3 发送通告报文时间间隔为默认值。当 SW1或 SW2 上联链路发生故障，Master 优先级降低 50。\nVRRPv2 配置： SW1配置： SW1(config)# interface Vlan60 SW1(config-if)# ip address 10.10.60.1 255.255.255.0 SW1(config-if)# exit SW1(config)# interface Vlan70 SW1(config-if)# ip address 10.10.70.1 255.255.255.0 SW1(config-if)# exit SW1(config)# router vrrp 60 SW1(config-router)# virtual-ip 10.10.60.9 SW1(config-router)# priority 120 SW1(config-router)# circuit-failover Vlan1021 50 SW1(config-router)# enable SW1(config-router)# exit SW1(config)# router vrrp 70 SW1(config-router)# virtual-ip 10.10.70.9 SW1(config-router)# priority 120 SW1(config-router)# circuit-failover Vlan1021 50 SW1(config-router)# enable SW1(config-router)# exit SW2配置： SW2(config)# interface Vlan80 SW2(config-if)# ip address 10.10.80.1 255.255.255.0 SW2(config-if)# exit SW2(config)# interface Vlan90 SW2(config-if)# ip address 10.10.90.1 255.255.255.0 SW2(config-if)# exit SW2(config)# router vrrp 80 SW2(config-router)# virtual-ip 10.10.80.9 SW2(config-router)# priority 120 SW2(config-router)# circuit-failover Vlan1021 50 SW2(config-router)# enable SW2(config-router)# exit SW2(config)# router vrrp 90 SW2(config-router)# virtual-ip 10.10.90.9 SW2(config-router)# priority 120 SW2(config-router)# circuit-failover Vlan1021 50 SW2(config-router)# enable SW2(config-router)# exit VRRPv3 配置： SW1配置： SW1(config)# ipv6 unicast-routing SW1(config)# interface Vlan60 SW1(config-if)# ipv6 address FE80::1 link-local SW1(config-if)# ipv6 address 2001:DB8:0:60::1/64 SW1(config-if)# exit SW1(config)# interface Vlan70 SW1(config-if)# ipv6 address FE80::1 link-local SW1(config-if)# ipv6 address 2001:DB8:0:70::1/64 SW1(config-if)# exit SW1(config)# router ipv6 vrrp 60 SW1(config-router)# virtual-ipv6 FE80:60::9 interface Vlan60 SW1(config-router)# priority 120 SW1(config-router)# circuit-failover Vlan1021 50 SW1(config-router)# enable SW1(config-router)# exit SW1(config)# router ipv6 vrrp 70 SW1(config-router)# virtual-ipv6 FE80:70::9 interface Vlan70 SW1(config-router)# priority 120 SW1(config-router)# circuit-failover Vlan1021 50 SW1(config-router)# enable SW1(config-router)# exit SW2配置： SW2(config)# ipv6 unicast-routing SW2(config)# interface Vlan80 SW2(config-if)# ipv6 address FE80::1 link-local SW2(config-if)# ipv6 address 2001:DB8:0:80::1/64 SW2(config-if)# exit SW2(config)# interface Vlan90 SW2(config-if)# ipv6 address FE80::1 link-local SW2(config-if)# ipv6 address 2001:DB8:0:90::1/64 SW2(config-if)# exit SW2(config)# router ipv6 vrrp 80 SW2(config-router)# virtual-ipv6 FE80:80::9 interface Vlan80 SW2(config-router)# priority 120 SW2(config-router)# circuit-failover Vlan1021 50 SW2(config-router)# enable SW2(config-router)# exit SW2(config)# router ipv6 vrrp 90 SW2(config-router)# virtual-ipv6 FE80:90::9 interface Vlan90 SW2(config-router)# priority 120 SW2(config-router)# circuit-failover Vlan1021 50 SW2(config-router)# enable SW2(config-router)# exit 4、DHCP 服务： 在 AC1 上配置了 DHCPv4 服务，为 SW1 的产品1段 VLAN10 和分公司 VLAN100、VLAN110、VLAN120 分配地址池。IPv4 地址池名称分别为 POOLv4-10、POOLv4-100、POOLv4-110、POOLv4-120。\n配置 DHCP 服务和 DHCP Snooping 在 AC1 上配置 DHCPv4 和 DHCPv6 服务，为 SW1 和分公司的 VLAN 分配地址，并在 SW1 上启用 DHCP Snooping。\n启用 DHCPv4 和 DHCPv6 服务。\nAC1(config)#service dhcp AC1(config)#service dhcpv6 为 VLAN10、VLAN100、VLAN110 和 VLAN120 配置 DHCPv4 地址池，并分配地址、设置默认网关和 DNS 服务器\nAC1(config)#ip dhcp pool POOLv4-10 AC1(dhcp-config)#network 10.10.11.0 255.255.255.0 AC1(dhcp-config)#default-router 10.10.11.1 AC1(dhcp-config)#dns-server 114.114.114.114 AC1(config)#ip dhcp pool POOLv4-100 AC1(dhcp-config)#network 10.17.100.0 255.255.255.0 AC1(dhcp-config)#default-router 10.17.100.1 AC1(dhcp-config)#dns-server 114.114.114.114 AC1(config)#ip dhcp pool POOLv4-110 AC1(dhcp-config)#network 10.17.110.0 255.255.255.0 AC1(dhcp-config)#default-router 10.17.110.1 AC1(dhcp-config)#dns-server 114.114.114.114 AC1(config)#ip dhcp pool POOLv4-120 AC1(dhcp-config)#network 10.17.120.0 255.255.255.0 AC1(dhcp-config)#default-router 10.17.120.1 AC1(dhcp-config)#dns-server 114.114.114.114 为 VLAN10、VLAN100、VLAN110 和 VLAN120 配置 DHCPv6 地址池，并分配 IPv6 地址。\nAC1(config)#ipv6 dhcp pool POOLv6-10 AC1(config-dhcpv6)#address prefix 2001:10:10:11::/64 AC1(config)#ipv6 dhcp pool POOLv6-100 AC1(config-dhcpv6)#address prefix 2001:10:17:100::/64 AC1(config)#ipv6 dhcp pool POOLv6-110 AC1(config-dhcpv6)#address prefix 2001:10:17:110::/64 AC1(config)#ipv6 dhcp pool POOLv6-120 AC1(config-dhcpv6)#address prefix 2001:10:17:120::/64 排除网关地址以外的地址池范围内的地址。\nAC1(config)#ip dhcp excluded-address 10.10.11.1 AC1(config)#ip dhcp excluded-address 10.17.100.1 AC1(config)#ip dhcp excluded-address 10.17.110.1 AC1(config)#ip dhcp excluded-address 10.17.120.1 AC1(config)#ipv6 dhcp pool POOLv6-120 AC1(config-dhcpv6)#excluded-address 2001:10:17:120::1 AC1(config)#ipv6 dhcp pool POOLv6-110 AC1(config-dhcpv6)#excluded-address 2001:10:17:110::1 AC1(config)#ipv6 dhcp pool POOLv6-100 AC1(config-dhcpv6)#excluded-address 2001:10:17:100::1 AC1(config)#ipv6 dhcp pool POOLv6-10 AC1(config-dhcpv6)#dns-server 2400:3200::1 AC1(config-dhcpv6)#excluded-address 2001:10:10:11::1 为设备保留地址。\nAC1(config)#ip dhcp pool AP1 AC1(dhcp-config)#host 10.17.100.9 255.255.255.0 AC1(dhcp-config)#hardware-address 00-03-0F-8A-F8-B0 AC1(dhcp-config)#default-router 10.17.100.1 AC1(config)#ip dhcp pool PC1 AC1(dhcp-config)#host 10.10.11.9 255.255.255.0 AC1(dhcp-config)#hardware-address 8C-16-45-78-8D-98 AC1(dhcp-config)#default-router 10.10.11.1 AC1(dhcp-config)#dns-server 114.114.114.114 AC1(config)#ip dhcp pool PC2 AC1(dhcp-config)#host 10.17.110.9 255.255.255.0 AC1(dhcp-config)#hardware-address 24-69-8E-1E-B9-5E AC1(dhcp-config)#default-router 10.17.110.1 AC1(dhcp-config)#dns-server 114.114.114.114 在 AC1 上配置 DHCP 服务，并为 VLAN1000、VLAN110 和 VLAN120 启用 DHCPv6 服务器。\nAC1(config)#interface Vlan1000 AC1(config-if)#ipv6 dhcp server POOLv6-100 AC1(config)#interface Vlan110 AC1(config-if)#ipv6 dhcp server POOLv6-110 AC1(config)#interface Vlan120 AC1(config-if)#ipv6 dhcp server POOLv6-120 在 SW1 上启用 DHCP Snooping，并将 E1/0/1 端口配置为受信任的端口，以允许 DHCP 流量通过。\nSW1(config)#ip dhcp snooping SW1(config)#ip dhcp snooping vlan 10,100-110 SW1(config)#interface Ethernet1/0/1 SW1(config-if)#ip dhcp snooping trust 配置 DHCPv6 中继，将 DHCPv6 请求转发到 AC1 上的 DHCPv6 服务器。\nSW1(config)#ipv6 dhcp relay destination 2001:10:10:8::1 Vlan10-Vlan110 5、OSPF SW1、SW2、SW3、RT1 以太链路、RT2 以太链路、FW1、FW2、AC1 之间运行OSPFv2 和 OSPFv3 协议（路由模式发布网络用接口地址，- BGP 协议除外）。\nOSPFv2 (1) SW1、SW2、SW3、RT1、RT2、FW1 之间 OSPFv2 ，进程 1，区域 0，分别发布 loopback1 地址路由和产品路由，FW1 通告 type2 默认路由。\n1、配置SW1: SW1(config)# router ospf 1 SW1(config-router)# ospf router-id 10.10.1.1 SW1(config-router)# network 10.10.1.1/32 area 0 SW1(config-router)# network 10.10.11.1/32 area 0 SW1(config-router)# network 10.10.255.1/32 area 0 SW1(config-router)# network 10.10.255.5/32 area 0 SW1(config-router)# network 10.10.255.14/32 area 0 2、 配置SW2: SW2(config)# router ospf 1 SW2(config-router)# ospf router-id 10.10.2.1 SW2(config-router)# network 10.10.2.1/32 area 0 SW2(config-router)# network 10.10.21.1/32 area 0 SW2(config-router)# network 10.10.255.2/32 area 0 SW2(config-router)# network 10.10.255.9/32 area 0 SW2(config-router)# network 10.10.255.22/32 area 0 3、 配置SW3: SW3(config)# router ospf 1 SW3(config-router)# ospf router-id 10.10.3.1 SW3(config-router)# network 10.10.3.1/32 area 0 SW3(config-router)# network 10.10.31.1/32 area 0 SW3(config-router)# network 10.10.255.6/32 area 0 SW3(config-router)# network 10.10.255.10/32 area 0 4、配置RT1: RT1(config)# router ospf 1 RT1(config-router)# router-id 10.10.4.1 RT1(config-router)# network 10.10.4.1 255.255.255.255 area 0 RT1(config-router)# network 10.10.255.29 255.255.255.255 area 0 RT1(config-router)# network 10.10.255.21 255.255.255.255 area 0 RT1(config-router)# network 10.10.255.18 255.255.255.255 area 0 5、 配置RT2 RT2(config)# router ospf 1 RT2(config-router)# router-id 10.10.5.1 RT2(config-router)# network 10.10.5.1 255.255.255.255 area 0 RT2(config-router)# network 10.10.255.30 255.255.255.255 area 0 6、 配置FW1 FW1(config)# ip vrouter \u0026quot;trust-vr\u0026quot; FW1(config-vrouter)# ip route 0.0.0.0/0 200.200.200.1 FW1(config-vrouter)# router ospf 1 FW1(config-router)# router-id 10.10.6.1 FW1(config-router)# default-information originate FW1(config-router)# network 10.10.6.1/32 area 0 FW1(config-router)# network 10.10.255.13/32 area 0 FW1(config-router)# network 10.10.255.17/32 area 0 7、 配置RT2与AC1之间的OSPFv2协议 RT2(config)# router ospf 1 RT2(config-router)# network 10.10.255.41 255.255.255.255 area 1 RT2(config-router)# area 1 nssa no-summary AC1(config)# router ospf 1 AC1(config-router)# ospf router-id 10.10.8.1 AC1(config-router)# area 1 nssa no-summary AC1(config-router)# network 10.10.8.1/32 area 1 AC1(config-router)# network 10.10.255.42/32 area 1 AC1(config-router)# network 10.17.110.1/32 area 1 AC1(config-router)# network 10.17.120.1/32 area 1 AC1(config-router)# redistribute connected route-map L3 AC1(config-router)# ip prefix-list L3 seq 5 permit 10.10.8.3/32 AC1(config-router)# route-map L3 permit 10 AC1(config-router)# match ip address prefix-list L3 8、 配置SW3模拟办事处与FW2之间的OSPFv2协议 SW3(config)# interface Ethernet1/0/11 SW3(config-if)# loopback SW3(config-if)# switchport access vlan 110 SW3(config)# interface Ethernet1/0/12 SW3(config-if)# loopback SW3(config-if)# switchport access vlan 120 SW3(config)# router ospf 2 SW3(config-router)# ospf router-id 10.10.3.2 SW3(config-router)# network 10.10.3.2/32 area 2 SW3(config-router)# network 10.10.255.46/32 area 2 SW3(config-router)# network 10.16.110.1/32 area 2 SW3(config-router)# network 10.16.120.1/32 area 2 FW2(config)# ip vrouter \u0026quot;trust-vr\u0026quot; FW2(config-vrouter)# router ospf 2 FW2(config-router)# router-id 10.10.7.1 FW2(config-router)# network 10.10.255.45/32 area 2 FW2(config-router)# network 10.10.255.26/32 area 2 FW2(config-router)# network 10.10.7.1/32 area 2 9、配置RT1与FW2之间的OSPFv2协议和重发布路由 RT1(config)# router ospf 2 RT1(config-router)# router-id 10.10.4.4 RT1(config-router)# network 10.10.4.4 255.255.255.255 area 2 RT1(config-router)# network 10.10.255.25 255.255.255.255 area 2 RT1(config-router)# default-information originate always metric-type 1 FW2(config)# ip vrouter \u0026quot;trust-vr\u0026quot; FW2(config-vrouter)# router ospf 2 FW2(config-router)# router-id 10.10.7.1 FW2(config-router)# network 10.10.255.45/32 area 2 FW2(config-router)# network 10.10.255.26/32 area 2 FW2(config-router)# network 10.10.7.1/32 area 2 RT1(config)# router ospf 1 RT1(config-router)# router-id 10.10.4.1 RT1(config-router)# network 10.10.4.1 255.255.255.255 area 0 RT1(config-router)# network 10.10.255.29 255.255.255.255 area 0 RT1(config-router)# network 10.10.255.21 255.255.255.255 area 0 RT1(config-router)# network 10.10.255.18 255.255.255.255 area 0 RT1(config-router)# redistribute ospf 2 route-map BSC RT1(config-router)# redistribute connect route-map ZL RT1(config)# route-map BSC 10 permit RT1(config-route-map)# match ip address prefix-list BSC RT1(config)# ip prefix-list BSC seq 5 permit 10.10.7.1/32 RT1(config)# ip prefix-list BSC seq 10 permit 10.10.3.2/32 RT1(config)# ip prefix-list BSC seq 15 permit 10.16.110.0/24 RT1(config)# route-map ZL 10 permit RT1(config-route-map)# match ip address prefix-list ZL RT1(config)# ip prefix-list ZL seq 5 permit 10.10.255.24/30 路由表对照： SW1:\nSW1(config)#sho ip route ospf O*E2 0.0.0.0/0 [110/10] via 10.10.255.13, Vlan1021, 12:37:46 tag:0 O 10.10.2.1/32 [110/2] via 10.10.255.2, Vlan1026, 15:51:53 tag:0 O 10.10.3.1/32 [110/2] via 10.10.255.6, Vlan1022, 15:46:35 tag:0 O E2 10.10.3.2/32 [110/100] via 10.10.255.13, Vlan1021, 11:56:19 tag:0 [110/100] via 10.10.255.2, Vlan1026, 11:56:19 tag:0 O 10.10.4.1/32 [110/3] via 10.10.255.13, Vlan1021, 14:40:59 tag:0 [110/3] via 10.10.255.2, Vlan1026, 14:40:59 tag:0 O 10.10.5.1/32 [110/4] via 10.10.255.13, Vlan1021, 14:40:59 tag:0 [110/4] via 10.10.255.2, Vlan1026, 14:40:59 tag:0 O 10.10.6.1/32 [110/2] via 10.10.255.13, Vlan1021, 14:42:20 tag:0 O E2 10.10.7.1/32 [110/100] via 10.10.255.13, Vlan1021, 12:02:08 tag:0 [110/100] via 10.10.255.2, Vlan1026, 12:02:08 tag:0 O IA 10.10.8.1/32 [110/5] via 10.10.255.13, Vlan1021, 13:59:39 tag:0 [110/5] via 10.10.255.2, Vlan1026, 13:59:39 tag:0 O E2 10.10.8.3/32 [110/20] via 10.10.255.13, Vlan1021, 12:32:00 tag:0 [110/20] via 10.10.255.2, Vlan1026, 12:32:00 tag:0 O 10.10.21.0/24 [110/2] via 10.10.255.2, Vlan1026, 15:51:53 tag:0 O 10.10.31.0/24 [110/2] via 10.10.255.6, Vlan1022, 15:46:35 tag:0 O 10.10.255.8/30 [110/2] via 10.10.255.6, Vlan1022, 15:46:35 tag:0 [110/2] via 10.10.255.2, Vlan1026, 15:46:35 tag:0 O 10.10.255.16/30 [110/2] via 10.10.255.13, Vlan1021, 14:41:09 tag:0 O 10.10.255.20/30 [110/2] via 10.10.255.2, Vlan1026, 15:51:53 tag:0 O E2 10.10.255.24/30 [110/100] via 10.10.255.13, Vlan1021, 11:52:58 tag:0 [110/100] via 10.10.255.2, Vlan1026, 11:52:58 tag:0 O 10.10.255.28/30 [110/3] via 10.10.255.13, Vlan1021, 14:40:59 tag:0 [110/3] via 10.10.255.2, Vlan1026, 14:40:59 tag:0 O IA 10.10.255.40/30 [110/4] via 10.10.255.13, Vlan1021, 13:59:30 tag:0 [110/4] via 10.10.255.2, Vlan1026, 13:59:30 tag:0 O E2 10.16.110.0/24 [110/100] via 10.10.255.13, Vlan1021, 11:55:52 tag:0 [110/100] via 10.10.255.2, Vlan1026, 11:55:52 tag:0 O IA 10.17.110.0/24 [110/5] via 10.10.255.13, Vlan1021, 13:59:39 tag:0 [110/5] via 10.10.255.2, Vlan1026, 13:59:39 tag:0 O IA 10.17.120.0/24 [110/5] via 10.10.255.13, Vlan1021, 13:59:39 tag:0 [110/5] via 10.10.255.2, Vlan1026, 13:59:39 tag:0 Total routes are : 34 item(s) SW2:\nSW2(config)#sho ip rout ospf O*E2 0.0.0.0/0 [110/10] via 10.10.255.1, Vlan1026, 12:38:26 tag:0 [110/10] via 10.10.255.21, Vlan1021, 12:38:26 tag:0 O 10.10.1.1/32 [110/2] via 10.10.255.1, Vlan1026, 15:52:34 tag:0 O 10.10.3.1/32 [110/2] via 10.10.255.10, Vlan1022, 15:47:42 tag:0 O E2 10.10.3.2/32 [110/100] via 10.10.255.21, Vlan1021, 11:57:00 tag:0 O 10.10.4.1/32 [110/2] via 10.10.255.21, Vlan1021, 15:18:41 tag:0 O 10.10.5.1/32 [110/3] via 10.10.255.21, Vlan1021, 15:03:50 tag:0 O 10.10.6.1/32 [110/3] via 10.10.255.1, Vlan1026, 14:41:39 tag:0 [110/3] via 10.10.255.21, Vlan1021, 14:41:39 tag:0 O E2 10.10.7.1/32 [110/100] via 10.10.255.21, Vlan1021, 12:02:49 tag:0 O IA 10.10.8.1/32 [110/4] via 10.10.255.21, Vlan1021, 14:00:19 tag:0 O E2 10.10.8.3/32 [110/20] via 10.10.255.21, Vlan1021, 12:32:40 tag:0 O 10.10.11.0/24 [110/2] via 10.10.255.1, Vlan1026, 15:52:34 tag:0 O 10.10.31.0/24 [110/2] via 10.10.255.10, Vlan1022, 15:47:42 tag:0 O 10.10.255.4/30 [110/2] via 10.10.255.1, Vlan1026, 15:47:42 tag:0 [110/2] via 10.10.255.10, Vlan1022, 15:47:42 tag:0 O 10.10.255.12/30 [110/2] via 10.10.255.1, Vlan1026, 15:52:34 tag:0 O 10.10.255.16/30 [110/2] via 10.10.255.21, Vlan1021, 15:18:41 tag:0 O E2 10.10.255.24/30 [110/100] via 10.10.255.21, Vlan1021, 11:53:38 tag:0 O 10.10.255.28/30 [110/2] via 10.10.255.21, Vlan1021, 15:08:47 tag:0 O IA 10.10.255.40/30 [110/3] via 10.10.255.21, Vlan1021, 14:00:11 tag:0 O E2 10.16.110.0/24 [110/100] via 10.10.255.21, Vlan1021, 11:56:32 tag:0 O IA 10.17.110.0/24 [110/4] via 10.10.255.21, Vlan1021, 14:00:19 tag:0 O IA 10.17.120.0/24 [110/4] via 10.10.255.21, Vlan1021, 14:00:19 tag:0 Total routes are : 24 item(s) SW3:\nSW3(config)#sho ip route ospf O*E2 0.0.0.0/0 [110/10] via 10.10.255.5, Vlan1021, 12:38:54 tag:0 O 10.10.1.1/32 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 O 10.10.2.1/32 [110/2] via 10.10.255.9, Vlan1022, 15:48:13 tag:0 O E2 10.10.3.2/32 [110/100] via 10.10.255.9, Vlan1022, 11:57:27 tag:0 O 10.10.4.1/32 [110/3] via 10.10.255.9, Vlan1022, 15:19:09 tag:0 O 10.10.5.1/32 [110/4] via 10.10.255.9, Vlan1022, 15:04:17 tag:0 O 10.10.6.1/32 [110/3] via 10.10.255.5, Vlan1021, 14:43:28 tag:0 O E2 10.10.7.1/32 [110/100] via 10.10.255.9, Vlan1022, 12:03:16 tag:0 O IA 10.10.8.1/32 [110/5] via 10.10.255.9, Vlan1022, 14:00:47 tag:0 O E2 10.10.8.3/32 [110/20] via 10.10.255.9, Vlan1022, 12:33:08 tag:0 O 10.10.11.0/24 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 O 10.10.21.0/24 [110/2] via 10.10.255.9, Vlan1022, 15:48:13 tag:0 O 10.10.255.0/30 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 [110/2] via 10.10.255.9, Vlan1022, 15:47:43 tag:0 O 10.10.255.12/30 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 O 10.10.255.16/30 [110/3] via 10.10.255.5, Vlan1021, 14:42:17 tag:0 [110/3] via 10.10.255.9, Vlan1022, 14:42:17 tag:0 O 10.10.255.20/30 [110/2] via 10.10.255.9, Vlan1022, 15:48:13 tag:0 O E2 10.10.255.24/30 [110/100] via 10.10.255.9, Vlan1022, 11:54:06 tag:0 O 10.10.255.28/30 [110/3] via 10.10.255.9, Vlan1022, 15:09:14 tag:0 O IA 10.10.255.40/30 [110/4] via 10.10.255.9, Vlan1022, 14:00:39 tag:0 O E2 10.16.110.0/24 [110/100] via 10.10.255.9, Vlan1022, 11:57:00 tag:0 O IA 10.17.110.0/24 [110/5] via 10.10.255.9, Vlan1022, 14:00:47 tag:0 O IA 10.17.120.0/24 [110/5] via 10.10.255.9, Vlan1022, 14:00:47 tag:0 Total routes are : 24 item(s) SW3(config)#sho ip route vrf Guangdong ospf O*E1 0.0.0.0/0 [110/102] via 10.10.255.45, Vlan1015, 12:10:12 tag:0 O 10.10.4.4/32 [110/3] via 10.10.255.45, Vlan1015, 12:10:13 tag:0 O 10.10.7.1/32 [110/2] via 10.10.255.45, Vlan1015, 12:19:31 tag:0 O 10.10.255.24/30 [110/2] via 10.10.255.45, Vlan1015, 12:10:33 tag:0 Total routes are : 4 item(s) RT1:\nRT1_config#sho ip route ospf VRF ID: 0 O E2 0.0.0.0/0 [150,10] via 10.10.255.17(on GigaEthernet0/2) O 10.10.1.1/32 [110,3] via 10.10.255.17(on GigaEthernet0/2) [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.2.1/32 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.3.1/32 [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.3.2/32 [110,3] via 10.10.255.26(on GigaEthernet0/3) O 10.10.5.1/32 [110,2] via 10.10.255.30(on GigaEthernet0/0) O 10.10.6.1/32 [110,2] via 10.10.255.17(on GigaEthernet0/2) O 10.10.7.1/32 [110,2] via 10.10.255.26(on GigaEthernet0/3) O IA 10.10.8.1/32 [110,3] via 10.10.255.30(on GigaEthernet0/0) O E2 10.10.8.3/32 [150,20] via 10.10.255.30(on GigaEthernet0/0) O 10.10.11.0/24 [110,3] via 10.10.255.17(on GigaEthernet0/2) [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.21.0/24 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.31.0/24 [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.0/30 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.4/30 [110,3] via 10.10.255.17(on GigaEthernet0/2) [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.8/30 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.12/30 [110,2] via 10.10.255.17(on GigaEthernet0/2) O IA 10.10.255.40/30 [110,2] via 10.10.255.30(on GigaEthernet0/0) O 10.10.255.44/30 [110,2] via 10.10.255.26(on GigaEthernet0/3) O 10.16.110.0/24 [110,3] via 10.10.255.26(on GigaEthernet0/3) O 10.16.120.0/24 [110,3] via 10.10.255.26(on GigaEthernet0/3) O IA 10.17.110.0/24 [110,3] via 10.10.255.30(on GigaEthernet0/0) O IA 10.17.120.0/24 [110,3] via 10.10.255.30(on GigaEthernet0/0) RT2:\nRT2_config#sho ip route ospf VRF ID: 0 O E2 0.0.0.0/0 [150,10] via 10.10.255.29(on GigaEthernet0/0) O 10.10.1.1/32 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.2.1/32 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.3.1/32 [110,4] via 10.10.255.29(on GigaEthernet0/0) O E2 10.10.3.2/32 [150,100] via 10.10.255.29(on GigaEthernet0/0) O 10.10.4.1/32 [110,2] via 10.10.255.29(on GigaEthernet0/0) O 10.10.6.1/32 [110,3] via 10.10.255.29(on GigaEthernet0/0) O E2 10.10.7.1/32 [150,100] via 10.10.255.29(on GigaEthernet0/0) O 10.10.8.1/32 [110,2] via 10.10.255.42(on GigaEthernet0/1) O N2 10.10.8.3/32 [150,20] via 10.10.255.42(on GigaEthernet0/1) O 10.10.11.0/24 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.21.0/24 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.31.0/24 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.0/30 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.4/30 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.8/30 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.12/30 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.16/30 [110,2] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.20/30 [110,2] via 10.10.255.29(on GigaEthernet0/0) O E2 10.10.255.24/30 [150,100] via 10.10.255.29(on GigaEthernet0/0) O E2 10.16.110.0/24 [150,100] via 10.10.255.29(on GigaEthernet0/0) O 10.17.110.0/24 [110,2] via 10.10.255.42(on GigaEthernet0/1) O 10.17.120.0/24 [110,2] via 10.10.255.42(on GigaEthernet0/1) AC1:\nAC1(config)#sho ip route os O*IA 0.0.0.0/0 [110/101] via 10.10.255.41, Vlan1001, 14:02:54 tag:0 Total routes are : 1 item(s) FW1:\nFW1(config)# sho ip route ospf Codes: K - kernel route, C - connected, S - static, Z - ISP, R - RIP, O - OSPF, B - BGP, D - DHCP, P - PPPoE, W - wireless, H - HOST, G - SCVPN, V - VPN, M - IMPORT, I - ISIS, Y - SYNC, L - llb outbound, \u0026gt; - selected first nexthop, * - FIB route, b - BFD enable Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt;* 10.10.1.1/32 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.2.1/32 [110/3/1] via 10.10.255.14, ethernet0/1, 14:44:57 * [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.3.1/32 [110/3/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.3.2/32 [110/100/1] via 10.10.255.18, ethernet0/2, 12:00:17 O\u0026gt;* 10.10.4.1/32 [110/2/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.5.1/32 [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.7.1/32 [110/100/1] via 10.10.255.18, ethernet0/2, 12:06:06 O\u0026gt;* 10.10.8.1/32 [110/4/1] via 10.10.255.18, ethernet0/2, 14:03:32 O\u0026gt;* 10.10.8.3/32 [110/20/1] via 10.10.255.18, ethernet0/2, 12:35:58 O\u0026gt;* 10.10.11.0/24 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.21.0/24 [110/3/1] via 10.10.255.14, ethernet0/1, 14:44:57 * [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.31.0/24 [110/3/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.255.0/30 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.255.4/30 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.255.8/30 [110/3/1] via 10.10.255.14, ethernet0/1, 14:44:57 * [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.255.20/30 [110/2/1] via 10.10.255.18, ethernet0/2, 14:44:59 O\u0026gt;* 10.10.255.24/30 [110/100/1] via 10.10.255.18, ethernet0/2, 11:56:58 O\u0026gt;* 10.10.255.28/30 [110/2/1] via 10.10.255.18, ethernet0/2, 14:44:59 O\u0026gt;* 10.10.255.40/30 [110/3/1] via 10.10.255.18, ethernet0/2, 14:03:24 O\u0026gt;* 10.16.110.0/24 [110/100/1] via 10.10.255.18, ethernet0/2, 11:59:52 O\u0026gt;* 10.17.110.0/24 [110/4/1] via 10.10.255.18, ethernet0/2, 14:03:34 O\u0026gt;* 10.17.120.0/24 [110/4/1] via 10.10.255.18, ethernet0/2, 14:03:34 ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== FW2:\nFW2(config)# sho ip route os \u0026lt;cr\u0026gt; | Output modifiers vrouter Virtual router FW2(config)# sho ip route os Codes: K - kernel route, C - connected, S - static, Z - ISP, R - RIP, O - OSPF, B - BGP, D - DHCP, P - PPPoE, W - wireless, H - HOST, G - SCVPN, V - VPN, M - IMPORT, I - ISIS, Y - SYNC, L - llb outbound, \u0026gt; - selected first nexthop, * - FIB route, b - BFD enable Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt;* 0.0.0.0/0 [110/101/1] via 10.10.255.25, ethernet0/2, 12:12:31 O\u0026gt;* 10.10.3.2/32 [110/2/1] via 10.10.255.46, ethernet0/1, 12:23:29 O\u0026gt;* 10.10.4.4/32 [110/2/1] via 10.10.255.25, ethernet0/2, 12:12:32 O\u0026gt;* 10.16.110.0/24 [110/2/1] via 10.10.255.46, ethernet0/1, 12:23:29 O\u0026gt;* 10.16.120.0/24 [110/2/1] via 10.10.255.46, ethernet0/1, 12:23:29 ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== OSPFv3 (1) SW1、SW2、SW3、RT1、RT2、FW1 之间 OSPFv3 ，进程 1，区域 0，分别发布 loopback1 地址路由和产品路由，FW1 通告 type2 默认路由。\nSW1配置： SW1(config)# router ipv6 ospf 1 SW1(config-router)# router-id 10.10.1.1 SW1(config-router)# interface Loopback1 SW1(config-if)# ipv6 router ospf 1 area 0 tag 1 SW1(config-router)# interface Vlan10 SW1(config-if)# ipv6 router ospf 1 area 0 tag 1 SW1(config-router)# interface Vlan1021 SW1(config-if)# ipv6 router ospf 1 area 0 tag 1 SW1(config-router)# interface Vlan1022 SW1(config-if)# ipv6 router ospf 1 area 0 tag 1 SW1(config-router)# interface Vlan1026 SW1(config-if)# ipv6 router ospf 1 area 0 tag 1 配置SW2： SW2(config)# router ipv6 ospf 1 SW2(config-router)# router-id 10.10.2.1 SW2(config-router)# interface Loopback1 SW2(config-if)# ipv6 router ospf 1 area 0 tag 1 SW2(config-router)# interface Vlan10 SW2(config-if)# ipv6 router ospf 1 area 0 tag 1 SW2(config-router)# interface Vlan1021 SW2(config-if)# ipv6 router ospf 1 area 0 tag 1 SW2(config-router)# interface Vlan1022 SW2(config-if)# ipv6 router ospf 1 area 0 tag 1 SW2(config-router)# interface Vlan1026 SW2(config-if)# ipv6 router ospf 1 area 0 tag 1 配置SW3： SW3(config)# router ipv6 ospf 1 SW3(config-router)# router-id 10.10.3.1 SW3(config-router)# interface Loopback1 SW3(config-if)# ipv6 router ospf 1 area 0 tag 1 SW3(config-router)# interface Vlan10 SW3(config-if)# ipv6 router ospf 1 area 0 tag 1 SW3(config-router)# interface Vlan1021 SW3(config-if)# ipv6 router ospf 1 area 0 tag 1 SW3(config-router)# interface Vlan1022 SW3(config-if)# ipv6 router ospf 1 area 0 tag 1 配置RT1： RT1(config)# router ospfv3 1 RT1(config-router)# router-id 10.10.4.1 RT1(config-router)# interface Loopback1 RT1(config-if)# ipv6 enable RT1(config-if)# ipv6 ospf 1 area 0 RT1(config-router)# interface GigaEthernet0/0 RT1(config-if)# ipv6 enable RT1(config-if)# ipv6 ospf 1 area 0 RT1(config-router)# interface GigaEthernet0/1 RT1(config-if)# ipv6 enable RT1(config-if)# ipv6 ospf 1 area 0 RT1(config-router)# interface GigaEthernet0/2 RT1(config-if)# ipv6 ospf 1 area 0 配置RT2： RT2(config)# router ospfv3 1 RT2(config-router)# router-id 10.10.5.1 RT2(config-router)# interface Loopback1 RT2(config-if)# ipv6 enable RT2(config-if)# ipv6 ospf 1 area 0 RT2(config-router)# interface GigaEthernet0/0 RT2(config-if)# ipv6 enable RT2(config-if)# ipv6 ospf 1 area 0 配置FW1： FW1(config)# ipv6 route ::/0 \u0026quot;ethernet0/3\u0026quot; FE80::203:FFF:FEE0:F9B8 FW1(config)# ipv6 router ospf 1 FW1(config-router)# router-id 10.10.6.1 FW1(config-router)# default-information originate FW1(config-router)# exit FW1(config)# interface loopback1 FW1(config-if)# ipv6 enable FW1(config-if)# ipv6 ospf 1 area 0 FW1(config)# interface ethernet0/1 FW1(config-if)# ipv6 enable FW1(config-if)# ipv6 ospf 1 area 0 FW1(config)# interface ethernet0/2 FW1(config-if)# ipv6 enable FW1(config-if)# ipv6 ospf 1 area 0 配置RT2与AC1之间的OSPFv3： RT2(config)# router ospfv3 1 RT2(config-router)# router-id 10.10.5.1 RT2(config-router)# area 1 stub no-summary RT2(config-router)# interface GigaEthernet0/1 RT2(config-if)# ipv6 enable RT2(config-if)# ipv6 ospf 1 area 1 AC1(config)# router ipv6 ospf 1 AC1(config-router)# router-id 10.10.8.1 AC1(config-router)# area 1 stub no-summary AC1(config-router)# interface Loopback1 AC1(config-if)# ipv6 router ospf area 1 tag 1 AC1(config-router)# interface Vlan110 AC1(config-if)# ipv6 router ospf area 1 tag 1 AC1(config-router)# interface Vlan120 AC1(config-if)# ipv6 router ospf area 1 tag 1 AC1(config-router)# interface Vlan1001 AC1(config-if)# ipv6 router ospf area 1 tag 1 配置SW3和FW2的IPv6路由： SW3(config)# ipv6 route vrf Guangdong ::/0 fe80::203:fff:fea6:8341 Vlan1015 FW2(config)# ip vrouter \u0026quot;trust-vr\u0026quot; FW2(config-vrouter)# ipv6 route 2001:10:10:3::1/128 \u0026quot;ethernet0/1\u0026quot; FE80::203:FFF:FEE0:F9B8 FW2(config-vrouter)# ipv6 route 2001:10:16:110::/64 \u0026quot;ethernet0/1\u0026quot; FE80::203:FFF:FEE0:F9B8 FW2(config-vrouter)# ipv6 route 2001:10:16:120::/64 \u0026quot;ethernet0/1\u0026quot; FE80::203:FFF:FEE0:F9B8 FW2(config-vrouter)# ipv6 router ospf 2 FW2(config-router)# router-id 10.10.7.1 FW2(config-router)# redistribute static 配置RT1与FW2之间的OSPFv3： RT1(config)# router ospfv3 2 RT1(config-router)# router-id 10.10.4.4 RT1(config-router)# default-information originate always metric-type 1 RT1(config-router)# interface Loopback4 RT1(config-if)# ipv6 enable RT1(config-if)# ipv6 ospf 2 area 2 FW2(config)# interface loopback1 FW2(config-if)# ipv6 enable FW2(config-if)# ipv6 ospf 2 area 2 FW2(config)# interface ethernet0/1 FW2(config-if)# ipv6 enable FW2(config-if)# ipv6 ospf 2 area 2 FW2(config-if)# exit FW2(config)# interface ethernet0/2 FW2(config-if)# ipv6 enable FW2(config-if)# ipv6 ospf 2 area 2 FW2(config-if)# exit RT1(config)# router ospfv3 1 RT1(config-router)# router-id 10.10.4.1 RT1(config-router)# redistribute ospf 2 route-map BSCV6 RT1(config)# route-map BSCV6 10 permit RT1(config-route-map)# match ipv6 address prefix-list BSCV6 RT1(config)# ipv6 prefix-list BSCV6 seq 5 permit 2001:10:10:3::2/128 RT1(config)# ipv6 prefix-list BSCV6 seq 10 permit 2001:10:16:110::/64 修改ospf cost为100： FW1(config)# interface ethernet0/2 FW1(config-if)# ip ospf cost 100 FW1(config-if)# ipv6 ospf cost 100 RT1(config)# interface GigaEthernet0/2 RT1(config-if)# ip ospf cost 100 RT1(config-if)# ipv6 ospf cost 100 验证部分：\nSW1：\nSW1(config)#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/21] via fe80::203:fff:fea6:72c1, Vlan1021, 12:00:39 tag:0 O 2001:10:10:2::1/128 [110/1] via fe80::203:fff:fee0:f9b5, Vlan1026, 12:24:12 tag:0 O 2001:10:10:3::1/128 [110/1] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:16:43 tag:0 O 2001:10:10:3::2/128 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:20 tag:0 O 2001:10:10:4::1/128 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:10:5::1/128 [110/3] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:10:6::1/128 [110/2] via fe80::203:fff:fea6:72c1, Vlan1021, 12:05:24 tag:0 O 2001:10:10:8::1/128 [110/4] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:10:21::/64 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1026, 12:24:12 tag:0 O 2001:10:10:31::/64 [110/2] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:16:43 tag:0 O 2001:10:16:110::/64 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:20 tag:0 O 2001:10:17:110::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:17:120::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 Sw2:\nSW2(config)#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/22] via fe80::203:fff:fee0:f9b2, Vlan1026, 11:31:37 tag:0 O 2001:10:10:1::1/128 [110/1] via fe80::203:fff:fee0:f9b2, Vlan1026, 12:24:52 tag:0 O 2001:10:10:3::1/128 [110/1] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:17:33 tag:0 O 2001:10:10:3::2/128 [110/150] via fe80::203:fff:fedc:c392, Vlan1021, 11:36:13 tag:0 O 2001:10:10:4::1/128 [110/1] via fe80::203:fff:fedc:c392, Vlan1021, 12:14:02 tag:0 O 2001:10:10:5::1/128 [110/2] via fe80::203:fff:fedc:c392, Vlan1021, 12:11:48 tag:0 O 2001:10:10:6::1/128 [110/3] via fe80::203:fff:fee0:f9b2, Vlan1026, 11:31:38 tag:0 O 2001:10:10:8::1/128 [110/3] via fe80::203:fff:fedc:c392, Vlan1021, 11:59:02 tag:0 O 2001:10:10:11::/64 [110/2] via fe80::203:fff:fee0:f9b2, Vlan1026, 12:24:52 tag:0 O 2001:10:10:31::/64 [110/2] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:17:33 tag:0 O 2001:10:16:110::/64 [110/150] via fe80::203:fff:fedc:c392, Vlan1021, 11:36:13 tag:0 O 2001:10:17:110::/64 [110/4] via fe80::203:fff:fedc:c392, Vlan1021, 11:59:02 tag:0 O 2001:10:17:120::/64 [110/4] via fe80::203:fff:fedc:c392, Vlan1021, 11:59:02 tag:0 SW3:\nSW3#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/22] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:01:49 tag:0 O 2001:10:10:1::1/128 [110/1] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:17:56 tag:0 O 2001:10:10:2::1/128 [110/1] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:17:56 tag:0 O 2001:10:10:3::2/128 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:36:44 tag:0 O 2001:10:10:4::1/128 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:14:33 tag:0 O 2001:10:10:5::1/128 [110/3] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:12:19 tag:0 O 2001:10:10:6::1/128 [110/3] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:06:35 tag:0 O 2001:10:10:8::1/128 [110/4] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:59:33 tag:0 O 2001:10:10:11::/64 [110/2] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:17:56 tag:0 O 2001:10:10:21::/64 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:17:56 tag:0 O 2001:10:16:110::/64 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:36:44 tag:0 O 2001:10:17:110::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:59:33 tag:0 O 2001:10:17:120::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:59:33 tag:0 RT1:\nRT1_config#sho ipv route ospf OE1 ::/0[1] [110,23] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:1::1/128[1] [110,2] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:2::1/128[1] [110,1] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:3::1/128[1] [110,2] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) OE2 2001:10:10:3::2/128[1] [110,20] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) O 2001:10:10:5::1/128[1] [110,1] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) O 2001:10:10:6::1/128[1] [110,4] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:7::1/128[1] [110,2] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) OIA 2001:10:10:8::1/128[1] [110,2] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) O 2001:10:10:11::/64[1] [110,3] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:21::/64[1] [110,2] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:31::/64[1] [110,3] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) OE2 2001:10:16:110::/64[1] [110,20] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) OE2 2001:10:16:120::/64[1] [110,20] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) OIA 2001:10:17:110::/64[1] [110,3] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) OIA 2001:10:17:120::/64[1] [110,3] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) RT2:\nRT2_config#sho ipv route ospf OE1 ::/0[1] [110,24] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:1::1/128[1] [110,3] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:2::1/128[1] [110,2] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:3::1/128[1] [110,3] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) OE2 2001:10:10:3::2/128[1] [110,150] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:4::1/128[1] [110,1] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:6::1/128[1] [110,5] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:8::1/128[1] [110,1] via fe80::203:fff:fed4:28b2(on GigaEthernet0/1) O 2001:10:10:11::/64[1] [110,4] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:21::/64[1] [110,3] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:31::/64[1] [110,4] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) OE2 2001:10:16:110::/64[1] [110,150] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:17:110::/64[1] [110,2] via fe80::203:fff:fed4:28b2(on GigaEthernet0/1) O 2001:10:17:120::/64[1] [110,2] via fe80::203:fff:fed4:28b2(on GigaEthernet0/1) AC1:\nAC1(config)#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/2] via fe80::203:fff:fedc:c38a, Vlan1001, 12:01:37 tag:0 FW1:\nFW1(config)# sho ipv route ospf ? \u0026lt;cr\u0026gt; | Output modifiers vrouter Virtual router FW1(config)# sho ipv route ospf Codes: K - kernel route, C - connected, S - static, R - RIPng, O - OSPFv3, B - BGP, I - ISIS, A - AUTOCONF, H - HOST, \u0026gt; - selected route, * - FIB route, Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt; 2001:10:10:1::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/1/1] O\u0026gt; 2001:10:10:2::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/2/1] O\u0026gt; 2001:10:10:3::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/2/1] O\u0026gt; 2001:10:10:3::2/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/150/1] O\u0026gt; 2001:10:10:4::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/3/1] O\u0026gt; 2001:10:10:5::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/4/1] O\u0026gt; 2001:10:10:8::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/5/1] O\u0026gt; 2001:10:10:11::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/2/1] O\u0026gt; 2001:10:10:21::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/3/1] O\u0026gt; 2001:10:10:31::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/3/1] O\u0026gt; 2001:10:16:110::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/150/1] O\u0026gt; 2001:10:17:110::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/6/1] O\u0026gt; 2001:10:17:120::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/6/1] ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== FW2:\nFW2(config)# sho ipv route ospf Codes: K - kernel route, C - connected, S - static, R - RIPng, O - OSPFv3, B - BGP, I - ISIS, A - AUTOCONF, H - HOST, \u0026gt; - selected route, * - FIB route, Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt; ::/0 * via FE80::203:FFF:FEDC:C394, ethernet0/2 [110/151/1] O\u0026gt; 2001:10:10:4::4/128 * via FE80::203:FFF:FEDC:C394, ethernet0/2 [110/1/1] ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== 6、RIP RT1串行链路、RT2串行链路、FW1、AC1之间分别运行RIP和RIPng协议， FW1、RT1、RT2的RIP和RIPng发布loopback2地址路由，AC1 RIP发布loopback2 地址路由，AC1 RIPng采用route-map匹配prefix-list重发布loopback2地址路由。\nIPV4: FW1: FW1\u0026gt; enable FW1# configure terminal FW1(config)# router rip FW1(config-router)# network 10.10.6.2/32 FW1(config-router)# network 10.10.255.16/30 RT1: RT1\u0026gt; enable RT1# configure terminal RT1(config)# router rip 1 RT1(config-router)# version 2 RT1(config-router)# no auto-summary RT1(config-router)# interface Loopback2 RT1(config-if)# ip rip 1 enable RT1(config-if)# interface Serial1/0 RT1(config-if)# ip rip 1 enable RT1(config-if)# interface Serial1/1 RT1(config-if)# ip rip 1 enable RT1(config-if)# interface GigaEthernet0/2 RT1(config-if)# ip rip 1 enable RT2:\nRT2\u0026gt; enable RT2# configure terminal RT2(config)# router rip 1 RT2(config-router)# version 2 RT2(config-router)# no auto-summary RT2(config-router)# interface Loopback2 RT2(config-if)# ip rip 1 enable RT2(config-if)# interface Serial1/0 RT2(config-if)# ip rip 1 enable RT2(config-if)# interface Serial1/1 RT2(config-if)# ip rip 1 enable RT2(config-if)# interface GigaEthernet0/1 RT2(config-if)# ip rip 1 enable AC1:\nAC1\u0026gt; enable AC1# configure terminal AC1(config)# router rip AC1(config-router)# network Loopback2 AC1(config-router)# network Vlan1001 RT1: 配置 RT1 路由策略：\nRT1\u0026gt; enable RT1# configure terminal RT1(config)# router rip 1 RT1(config-router)# version 2 RT1(config-router)# no auto-summary RT1(config-router)# offset Serial1/1 in AclRIP 3 RT1(config-router)# offset Serial1/1 out AclRIP 3 RT1(config-router)# ip access-list standard AclRIP RT1(config-access-list)# permit any sequence 10 双向认证 RT1的S1/0与RT2的S1/1之间采用chap双向认证，用户名为对端设备名称，密码为Pass-1234。\nRT1: aaa authentication ppp default local ! username RT2 password 0 Pass-1234 ! interface Serial1/0 ppp authentication chap ppp chap hostname RT1 ppp chap password 0 Pass-1234 RT2: aaa authentication ppp default local ! username RT1 password 0 Pass-1234 ! interface Serial1/1 ppp authentication chap ppp chap hostname RT2 ppp chap password 0 Pass-1234 验证： FW1(config)# sho ip route rip Codes: K - kernel route, C - connected, S - static, Z - ISP, R - RIP, O - OSPF, B - BGP, D - DHCP, P - PPPoE, W - wireless, H - HOST, G - SCVPN, V - VPN, M - IMPORT, I - ISIS, Y - SYNC, L - llb outbound, \u0026gt; - selected first nexthop, * - FIB route, b - BFD enable Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== R\u0026gt;* 10.10.4.2/32 [120/2/1] via 10.10.255.18, ethernet0/2, 09:01:13 R\u0026gt;* 10.10.5.2/32 [120/3/1] via 10.10.255.18, ethernet0/2, 07:44:32 R\u0026gt;* 10.10.8.2/32 [120/4/1] via 10.10.255.18, ethernet0/2, 07:44:32 R\u0026gt;* 10.10.255.32/30 [120/2/1] via 10.10.255.18, ethernet0/2, 07:44:43 R\u0026gt;* 10.10.255.36/30 [120/2/1] via 10.10.255.18, ethernet0/2, 07:44:43 R 10.10.255.40/30 [120/3/1] via 10.10.255.18, ethernet0/2, 07:44:32 ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== RT1_config#sho ip route rip VRF ID: 0 R 10.10.5.2/32 [120,1] via 10.10.255.34(on Serial1/0) R 10.10.6.2/32 [120,1] via 10.10.255.17(on GigaEthernet0/2) R 10.10.8.2/32 [120,2] via 10.10.255.34(on Serial1/0) RT2_config#sho ip route rip VRF ID: 0 R 10.10.4.2/32 [120,1] via 10.10.255.33(on Serial1/1) R 10.10.6.2/32 [120,2] via 10.10.255.33(on Serial1/1) R 10.10.8.2/32 [120,1] via 10.10.255.42(on GigaEthernet0/1) AC1(config)#sho ip route rip R 10.10.4.2/32 [120/3] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.5.2/32 [120/2] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.6.2/32 [120/4] via 10.10.255.41, Vlan1001, 07:47:32 tag:0 R 10.10.255.16/30 [120/3] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.255.32/30 [120/2] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.255.36/30 [120/2] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 Total routes are : 6 item(s) ","permalink":"https://erain.fun/posts/tech/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E9%A2%98%E7%9B%AE%E7%AD%94%E6%A1%88/","summary":"交换机部分 1、生成树spanning-tree SW1、SW2、SW3启用MSTP，实现网络二层负载均衡和冗余备份，创建实例Instance1","title":"网络设备题目"},{"content":" 第一法则 机器人不得伤害人类，或坐视人类受到伤害；\n第二法则 机器人必须服从人类命令，除非命令与第一法则发生冲突；\n第三法则 在不违背第一或第二法则之下，机器人可以保护自己。\n这不是我第一次读这本书，开篇著名的艾氏机器人三定律首次登场 本书一共9个短篇，以回忆的方式叙述出来，所谓用“机器人心理学“去和异常的机器人打交道，如同书的标题“I,Robot” 书中的机器人三定律的第一法则的电平大于第二法则，第二法则的电平大于第三规则，机器人必须遵守这些“硬代码”否则会自毁\n我很喜欢《Liar!》这篇（译文翻译的是“说假话的机器人”） 在生产机器人的的过程中出现了失误，使得机器人（代号：Herbie）拥有了类似读取脑电波的能力，赫比给研究机器人的专家们展现了它读取他们想法的能力，在谈话中赫比向人们透露了其他人的想法，使心理学家苏珊在感情问题上得到了她想知道的答案，赫比告诉了苏珊 米尔顿对她的爱恋之情，苏珊信以为真但在之后的聊天中米尔顿告诉苏珊自己要结婚了，苏珊这才意识到赫比欺骗了她，当众人人质问赫比为什么要撒谎时，赫比被逼的几乎疯癫说出了原因\n“机器人不得伤害人类，或坐视人类受到伤害“\n原来在赫比的逻辑中第一法则的电平依然是最大的，远超第二法则，赫比认为告诉他们真话会伤害到人类的感情，于是告诉了他们心中希望听到的答案 苏珊博士处于被欺骗和感情上的羞辱报复性地对赫比说 “你不能告诉他们，因为告诉他们，就是伤害他们，可如果你不告诉他们，你就是在伤害他们…” 赫比在心理学家苏珊的思想中感受到了无尽的苦痛，屈辱和仇恨，最终在苏珊创造的逻辑悖论下变成了一坨再也不能思考的废铁\n机器人理解不了人类的感情，它只能按照第一法则去避免伤害到人类，没想到这种谎言最终使物理的伤害转变为了精神上的痛苦\n这很有意思，不禁令人思考当下火爆的人工智能模型如何判断伤害到人类的范畴，人们也许会允许人在一些事情上犯错，但这种宽容会出现在人工智能上吗?\n","permalink":"https://erain.fun/posts/read/%E6%88%91%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%B0%8F%E8%AE%B0/","summary":"第一法则 机器人不得伤害人类，或坐视人类受到伤害； 第二法则 机器人必须服从人类命令，除非命令与第一法则发生冲突； 第三法则 在不违背第一或第二法则之","title":"《我，机器人》小记"},{"content":" OSPF是如何计算出路由表来的？什么是SPF算法？写下在查阅了各种文档和书籍后开始对OSPF的一些理解，做此纪录用于学习和分享。\nOSPF的特性 [Wiki] Wiki百科中这样写到 开放式最短路径优先（英语：Open Shortest Path First，缩写为 OSPF）是广泛使用的一种路由协议，它属于链路状态路由协议，具有路由变化收敛速度快、无路由环路、支持变长子网掩码（VLSM）和汇总、层次区域划分等优点。\n不难看出OSPF有很多难以拒绝的优点，收敛速度快，树状的拓扑时期不会出现环路问题，很容易划分区域，方便管理等，也许这就是为什么大多数企业都会选择OSPF的原因(对比RIP不要好用太多太多) 在上一篇文章中，我们讨论了OSPF是如何选举DR，如何建立链接以及如何交换LSA数据库的。如果你还没有看那篇文章，建议先读一读再继续。\n今天主要来看OSPF是如何计算出最短路由的。\nSPF算法如何计算出优先算短路径？ SPF算法中有一个很重要的点叫Cost(花费),中文翻译过来叫花费，听起来就像去超市买东西花费了很多钱一样，但它有所不同，它更像是你从家门口打车去到某一个地方花了多少钱。 在树状图中Cost的值代表了一个节点到另一个节点所花费的跃点(Cost)，其实就是你经过了几个路由(节点)。 为什么是树状图？\n如果对STP生成树协议有所了解的话，我们就会知道树状图能有效避免环路的问题，如图，树状图不会有任何一个”三角形“出现，这样的结构能避免环路的问题。\n回到正题，我们要知道一点每一台路由(节点)都会运行SPF算法来计算出最短路径来，就像图中这四个节点一样，R1会计算出如下信息 R1\u0026mdash;R2 Cost=1 但它会计算其他的路径吗，不会。因为SPF不计算间接连接的节点所的Cost值。这或许能解释为什么在配置ospf时我们只会配置相邻的网段而不会配置间接连接的网段。我将四个节点所计算出的信息一一列出 R1: R1\u0026mdash;R2 Cost=1 R2: R2\u0026mdash;R1 Cost=1 R2\u0026mdash;R3 Cost=1 R3: R3\u0026mdash;R2 Cost=1 R3\u0026mdash;R4 Cost=1 R4: R4\u0026mdash;R3 Cost=1\n此时每个节点会将自己计算的信息打包和相邻的节点进行数据库交互，它们交换数据包，就有了完整的最短路径树，如下：\nR1的路径表：\n到达R2的最短路径：R1-\u0026gt;R2，链路成本(Cost)为1 到达R3的最短路径：R1-\u0026gt;R2-\u0026gt;R3，链路成本为2 到达R4的最短路径：R1-\u0026gt;R2-\u0026gt;R3-\u0026gt;R4，链路成本为3 R2的路径表：\n到达R1的最短路径：R2-\u0026gt;R1，链路成本为1 到达R3的最短路径：R2-\u0026gt;R3，链路成本为1 到达R4的最短路径：R2-\u0026gt;R3-\u0026gt;R4，链路成本为2 R3的路径表：\n到达R1的最短路径：R3-\u0026gt;R2-\u0026gt;R1，链路成本为2 到达R2的最短路径：R3-\u0026gt;R2，链路成本为1 到达R4的最短路径：R3-\u0026gt;R4，链路成本为1 R4的路径表：\n到达R1的最短路径：R4-\u0026gt;R3-\u0026gt;R2-\u0026gt;R1，链路成本为3 到达R2的最短路径：R4-\u0026gt;R3-\u0026gt;R2，链路成本为2 到达R3的最短路径：R4-\u0026gt;R3，链路成本为1 最短路径树 完整的最短路径树就是如此生成出来的，有了最短路径树，就像有了一张绝对快速不拖沓的地图。 用这张地图来计算路由表，计算出类似的信息\n目标网络：x.x.x.x/x （查找最短路径） 下一跳：y.y.y.y （选择最快的下一跳路由） 出接口：GigabitEthernet0/1 SPF（Shortest Path First，最短路径优先）算法，也称为Dijkstra算法，是OSPF用来计算最短路径的核心算法。总结下来一共四大步骤，下面是SPF算法的工作原理和步骤：\n1. 初始步骤 每个OSPF路由器会创建一个链路状态数据库（LSDB），存储关于网络拓扑的所有信息。 路由器通过发送和接收链路状态广告（LSA）来更新其LSDB，确保所有路由器的LSDB保持一致。 2. 计算Cost值 Cost（花费）：在OSPF中，Cost表示路由器到达目标网络的开销。Cost的值可以根据链路的带宽、延迟等因素进行设置。默认情况下，OSPF根据链路带宽计算Cost值，带宽越高，Cost越低。 树状图：OSPF使用树状拓扑结构避免环路问题。每个路由器只计算直接相连的链路的Cost值，并根据这些信息逐步构建整个网络的最短路径树。 3. 运行SPF算法 初始节点：从源节点（当前路由器）开始，将其标记为已访问，并初始化其到自身的Cost为0。 扩展节点：从当前节点开始，访问所有直接相连的节点，计算每个节点的累计Cost值，并选择累计Cost值最小的节点作为下一个访问节点。 重复计算：重复上述步骤，直到访问所有节点，生成一棵完整的最短路径树。 4. 生成路由表 每个路由器根据生成的最短路径树，更新其路由表。 路由表包含目标网络、下一跳地址和出接口等信息。 最短路径树中的每个节点都有一个数据库，数据库中包含了目标网络的最短路径和下一跳路由的地址信息，路由器根据最短路径树去更新自己的路由表，实现高效率，高速度，优质的通信。\n参考wiki百科；Jan Ho大佬的总结 [https://en.wikipedia.org/wiki/Open_Shortest_Path_First] [https://www.jannet.hk/open-shortest-path-first-ospf-zh-hant]\n","permalink":"https://erain.fun/posts/tech/ospf%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E5%87%BA%E8%B7%AF%E7%94%B1%E8%A1%A8%E6%9D%A5%E7%9A%84%E4%BB%80%E4%B9%88%E6%98%AFspf%E7%AE%97%E6%B3%95/","summary":"OSPF是如何计算出路由表来的？什么是SPF算法？写下在查阅了各种文档和书籍后开始对OSPF的一些理解，做此纪录用于学习和分享。 OSPF的特","title":"OSPF是如何计算出路由表来的？什么是SPF算法？"},{"content":" 仅作为备份文件 备份时间 2023.6.23\n一、交换机配置 1、生成树spanning-tree SW1、SW2、SW3启用MSTP，实现网络二层负载均衡和冗余备份，创建实例Instance10和Instance20，名称为SKILLS，修订版本为1，其中Instance10关联vlan60和vlan70，Instance20关联vlan80和vlan90。SW1为Instance0和Instance10的根交换机，为Instance20备份根交换机；SW2为Instance20根交换机，为Instance0和Instance10的备份根交换机；根交换机STP优先级为0，备份根交换机STP优先级为4096。关闭交换机之间三层互联接口的STP。\nSW1:\nspanning-tree mst configuration name SKILLS revision-level 1 instance 0 vlan 1-59;61-69;71-79;81-89;91-4094 instance 10 vlan 60;70 instance 20 vlan 80;90 exit ! spanning-tree spanning-tree mst 0 priority 0 spanning-tree mst 10 priority 0 spanning-tree mst 20 priority 4096 Interface Ethernet1/0/22 no spanning-tree Interface Ethernet1/0/26 no spanning-tree SW2:\nspanning-tree mst configuration name SKILLS revision-level 1 instance 0 vlan 1-59;61-69;71-79;81-89;91-4094 instance 10 vlan 60;70 instance 20 vlan 80;90 exit ! spanning-tree spanning-tree mst 0 priority 4096 spanning-tree mst 10 priority 4096 spanning-tree mst 20 priority 0 Interface Ethernet1/0/22 no spanning-tree Interface Ethernet1/0/26 no spanning-tree SW3:\nspanning-tree mst configuration name SKILLS revision-level 1 instance 0 vlan 1-59;61-69;71-79;81-89;91-4094 instance 10 vlan 60;70 instance 20 vlan 80;90 exit ! spanning-tree Interface Ethernet1/0/21 no spanning-tree Interface Ethernet1/0/22 no spanning-tree 配置结果：\nSW3(config)#show spanning-tree *********************************** Process 0 *********************************** -- MSTP Bridge Config Info -- Standard : IEEE 802.1s Bridge MAC : 00:03:0f:e0:f9:b9 Bridge Times : Max Age 20, Hello Time 2, Forward Delay 15 Force Version: 3 ########################### Instance 0 ########################### Self Bridge Id : 32768.00:03:0f:e0:f9:b9 Root Id : 0.00:03:0f:e0:f9:b3 Ext.RootPathCost : 0 Region Root Id : 0.00:03:0f:e0:f9:b3 Int.RootPathCost : 20000 Root Port ID : 128.23 Current port list in Instance 0: Ethernet1/0/11 Ethernet1/0/12 Ethernet1/0/15 Ethernet1/0/17 Ethernet1/0/18 Ethernet1/0/23 Ethernet1/0/24 (Total 7) PortName ID ExtRPC IntRPC State Role DsgBridge DsgPort -------------- ------------ --------- --------- --- ---- ------------------ ------------ Ethernet1/0/11 128.00011 0 20000 FWD DSGN 32768.00030fe0f9b9 128.00011 Ethernet1/0/12 128.00012 0 20000 FWD DSGN 32768.00030fe0f9b9 128.00012 Ethernet1/0/15 128.00015 0 20000 FWD DSGN 32768.00030fe0f9b9 128.00015 Ethernet1/0/17 128.00017 0 20000 FWD DSGN 32768.00030fe0f9b9 128.00017 Ethernet1/0/18 128.00018 0 20000 FWD DSGN 32768.00030fe0f9b9 128.00018 Ethernet1/0/23 128.00023 0 0 FWD ROOT 0.00030fe0f9b3 128.00023 Ethernet1/0/24 128.00024 0 20000 BLK ALTR 4096.00030fe0f9b6 128.00023 ########################### Instance 10 ########################### Self Bridge Id : 32768.00:03:0f:e0:f9:b9 Region Root Id : 0.00:03:0f:e0:f9:b3 Int.RootPathCost : 20000 Root Port ID : 128.23 Current port list in Instance 10: Ethernet1/0/23 Ethernet1/0/24 (Total 2) PortName ID IntRPC State Role DsgBridge DsgPort --------------- ------------ --------- --- ---- ------------------ ---------- Ethernet1/0/23 128.00023 0 FWD ROOT 0.00030fe0f9b3 128.00023 Ethernet1/0/24 128.00024 20000 BLK ALTR 4096.00030fe0f9b6 128.00023 ########################### Instance 20 ########################### Self Bridge Id : 32768.00:03:0f:e0:f9:b9 Region Root Id : 0.00:03:0f:e0:f9:b6 Int.RootPathCost : 20000 Root Port ID : 128.24 Current port list in Instance 20: Ethernet1/0/23 Ethernet1/0/24 (Total 2) PortName ID IntRPC State Role DsgBridge DsgPort --------------- ------------ --------- --- ---- ------------------ ---------- Ethernet1/0/23 128.00023 20000 BLK ALTR 4096.00030fe0f9b3 128.00023 Ethernet1/0/24 128.00024 0 FWD ROOT 0.00030fe0f9b6 128.00023 2、链路聚合LACP SW1 和 SW2 之间利用三条裸光缆实现互通，其中一条裸光缆承载三层 IP业务、一条裸光缆承载 VPN 业务、一条裸光缆承载二层业务。用相关技术分别实现财务 1 段、财务 2 段业务路由表与其它业务路由表隔离，财务业务 VPN 实例名称为 CW。\nSW1：\nSW1#sho ip vrf VRF CW, FIB ID 1 Router ID: 10.10.255.2 (automatic) Interfaces: Vlan40 Vlan1027 ! VRF CW; (id=1); RIP is not enabled Name Interfaces CW Vlan40 Vlan1027 Name Default RD Interfaces CW Vlan40 Vlan1027 SW2：\nSW2#sho ip vrf VRF CW, FIB ID 1 Router ID: 10.10.255.2 (automatic) Interfaces: Vlan40 Vlan1027 ! VRF CW; (id=1); RIP is not enabled Name Interfaces CW Vlan40 Vlan1027 Name Default RD Interfaces CW Vlan40 Vlan1027 承载二层业务的只有一条裸光缆通道，配置相关技术，方便后续链路扩容与冗余备份，编号为 1，用 LACP 协议，SW1 为 active，SW2 为 active；采用源、目的 IP 进行实现流量负载分担。\nSW1：\nSW1(config)#port-group 1 SW1(config)#int e1/0/25;28 SW1(config-if-port-range)#port-group 1 mode active SW1(config-if-port-range)#exit SW1(config)#load-balance dst-src-ip 配置结果：\nSW1#sho port-group 1 detail Flags: A -- LACP_Activity, B -- LACP_timeout, C -- Aggregation, D -- Synchronization, E -- Collecting, F -- Distributing, G -- Defaulted, H -- Expired Port-group number: 1, Mode: active, Load-balance: dst-src-ip Port-group detail information: System ID: 0x8000,00-03-0f-e0-f9-b3 Local: Port Status Priority Oper-Key Flag ----------------------------------------------------------- Ethernet1/0/25 Unselected 32768 1 {ACG} Ethernet1/0/28 Selected 32768 1 {ACDEF} Remote: Actor Partner Priority Oper-Key SystemID Flag -------------------------------------------------------------------------------- Ethernet1/0/28 28 32768 1 0x8000,00-03-0f-e0-f9-b6 {ACDEF} SW2：\nSW2(config)#port-group 1 SW1(config)#int e1/0/25;28 SW1(config-if-port-range)#port-group 1 mode active SW1(config-if-port-range)#exit SW2(config)#load-balance dst-src-ip 配置结果：\nSW2#sho port-group 1 detail Flags: A -- LACP_Activity, B -- LACP_timeout, C -- Aggregation, D -- Synchronization, E -- Collecting, F -- Distributing, G -- Defaulted, H -- Expired Port-group number: 1, Mode: active, Load-balance: dst-src-ip Port-group detail information: System ID: 0x8000,00-03-0f-e0-f9-b6 Local: Port Status Priority Oper-Key Flag ----------------------------------------------------------- Ethernet1/0/25 Unselected 32768 1 {ACG} Ethernet1/0/28 Selected 32768 1 {ACDEF} Remote: Actor Partner Priority Oper-Key SystemID Flag -------------------------------------------------------------------------------- Ethernet1/0/28 28 32768 1 0x8000,00-03-0f-e0-f9-b3 {ACDEF} 3、路由表隔离VPN 将 SW3 模拟为 Internet 交换机，实现与集团其它业务路由表隔离，Internet 路由表 VPN 实例名称为 Internet。将 SW3 模拟办事处交换机，实现与集团其它业务路由表隔离，办事处路由表 VPN 实例名称为 Guangdong。\nip vrf Guangdong ! ip vrf Internet ! interface Loopback2 ip vrf forwarding Guangdong ipv6 address 2001:10:10:3::2/128 ip address 10.10.3.2 255.255.255.255 ! interface Loopback3 ip vrf forwarding Internet ipv6 address 2001:200:200:3::3/128 ip address 200.200.3.3 255.255.255.255 ! interface Vlan110 ip vrf forwarding Guangdong ipv6 address 2001:10:16:110::1/64 ip address 10.16.110.1 255.255.255.0 ! interface Vlan120 ip vrf forwarding Guangdong ipv6 address 2001:10:16:120::1/64 ip address 10.16.120.1 255.255.255.0 ! interface Vlan1015 ip vrf forwarding Guangdong ip address 10.10.255.46 255.255.255.252 ! interface Vlan1017 ip vrf forwarding Internet ip address 200.200.200.1 255.255.255.252 ! interface Vlan1018 ip vrf forwarding Internet ip address 200.200.200.5 255.255.255.252 ! 配置结果：\nSW3#sho ip vrf VRF Guangdong, FIB ID 1 Router ID: 10.10.3.2 (loopback) Interfaces: Vlan110 Vlan120 Vlan1015 Loopback2 ! VRF Internet, FIB ID 2 Router ID: 200.200.3.3 (loopback) Interfaces: Vlan1017 Vlan1018 Loopback3 ! VRF Guangdong; (id=1); RIP is not enabled VRF Internet; (id=2); RIP is not enabled Name Interfaces Guangdong Vlan110 Vlan120 Vlan1015 Loopback2 Internet Vlan1017 Vlan1018 Loopback3 Name Default RD Interfaces Guangdong Vlan110 Vlan120 Vlan1015 Loopback2 Internet Vlan1017 Vlan1018 Loopback3 4、端口安全 SW1 法务物理接口限制收发数据占用的带宽均为 1000Mbps，限制所有报文最大收包速率为 1000packets/s，如果超过了配置交换机端口的报文最大收包速率则关闭此端口，1 分钟后恢复此端口；启用端口安全功能，最大安全 MAC 地址数为 20，当超过设定 MAC 地址数量的最大值，不学习新的 MAC、丢弃数据包、发nmp trap、同时在 syslog 日志中记录，端口的老化定时器到期后，在老化周期中没有流量的部分表项老化，有流量的部分依旧保留，恢复时间为 10 分钟；禁止采用访控制列表，只允许 IP 主机位为 20-50 的数据包进行转发；禁止配置访问控制列表，实现端口间二层流量无法互通，组名称 FW。\nSW1(config)#inter e1/0/3 SW1(config-if-ethernet1/0/3)#rate-violation all 1000 SW1(config-if-ethernet1/0/3)#bandwidth control 1000000 both SW1(config-if-ethernet1/0/3)#rate-violation control shutdown recovery 60 SW1(config-if-ethernet1/0/3)#switchport port-security Mac learning is not in cpu-control mode, please enable it to make port-security work well! SW1(config-if-ethernet1/0/3)#switchport port-security maximum 20 SW1(config-if-ethernet1/0/3)#exit SW1(config)#mac-address-learning cpu-control SW1(config)#inter e1/0/3 SW1(config-if-ethernet1/0/3)#switchport port-security violation restrict recovery 600 SW1(config-if-ethernet1/0/3)#switchport port-security aging type inactivity SW1(config-if-ethernet1/0/3)#exit SW1(config)#am enable SW1(config)#inter e1/0/3 SW1(config-if-ethernet1/0/3)#am port SW1(config-if-ethernet1/0/3)#am ip-pool 10.10.120.20 31 SW1(config-if-ethernet1/0/3)#exit SW1(config)#isolate-port group FW switchport interface e1/0/3 SW1(config)#isolate-port apply l2 配置结果：\nSW1(config-if-ethernet1/0/3)#sho run c bandwidth control 1000000 both rate-violation all 1000 rate-violation control shutdown recovery 60 switchport access vlan 30 switchport port-security switchport port-security maximum 20 switchport port-security violation restrict recovery 600 switchport port-security aging type inactivity am port am ip-pool 10.10.120.20 31 SW1#sho isolate-port group FW Isolate-port group FW The isolate-port Ethernet1/0/3 SW1 法务物理接口限制收发数据占用的带宽分别为 100Mbps、90Mbps,限制所有报文最大收包速率为100packets/s,如果超过了配置交换机端口的报文最大收包速率则关闭此端口,10 分钟后恢复此端口;启用端口安全功能,最大安全 MAC 地址数为 10,当超过设定 MAC 地址数量的最大值,不学习新的 MAC、丢弃数据包、发nmp trap、同时在 syslog 日志中记录,端口的老化定时器到期后,在老化周期中没有流量的部分表项老化,有流量的部分依旧保留,恢复时间为 10 分钟;禁止采用访控制列表,只允许 IP 主机位为 20-50 的数据包进行转发;禁止配置访问控制列表,实现端口间二层流量无法互通,组名称 FW。\nbandwidth control 90000 transmit bandwidth control 100000 receive rate-violation all 100 rate-violation control shutdown recovery 600 switchport access vlan 30 switchport port-security switchport port-security maximum 10 switchport port-security violation restrict recovery 600 switchport port-security aging type inactivity am port am ip-pool 10.1.13.20 31 SW1(config)#isolate-port group FW switchport interface e1/0/3 SW1(config)#isolate-port apply l2 5、开启日志记录\u0026amp;保护功能 开启 SW1日志记录功能和保护功能，采样周期5s一次，恢复周期为100s，从而保障 CPU 稳定运行。\nSW1(config)#cpu-protect log enable SW1(config)#cpu-protect enable SW1(config)#cpu-protect interval 5 SW1(config)#cpu-protect recovery-time 100 配置结果：\nSW1#sho cpu-protect running-config Cpu-Protect Globle: enable Cpu-Protect trap : disable Cpu-Protect Log: enable Cpu-Protect Interval: 5 Cpu-Protect Recovery-Time: 100 Cap-Num Ip-Num Mac-Num Protocal-Num 0 0 0 0 Stream Threshould Limit-Speed Action IP 300 150 Speed-Limit DHCP 150 80 Speed-Limit IGMP 150 80 Speed-Limit ARP 300 150 Speed-Limit ICMP 80 50 Speed-Limit PER-IP 400 200 Speed-Limit PER-MAC 400 200 Speed-Limit 6、SNMP .SW1 配置 SNMP，引擎 id 分别为 1；创建组 GROUP2022，采用最高安全级别，配置组的读、写视图分别为：SKILLS_R、SKILLS_W；创建认证用户为SER2022，采用 aes 算法进行加密，密钥为 Pass-1234，哈希算法为 sha，密钥为 Pass-1234；当设备有异常时，需要用本地的环回地址 loopback1 发送 v3 Trap 消息至集团网管服务器 10.10.11.99、2001:10:10:11::99，采用最高安全级别；\nsnmp-server enable snmp-server securityip 10.1.15.120 snmp-server securityip 2001:10:1:15::120 snmp-server trap-source 10.1.1.1 snmp-server trap-source 2001:10:1:1::1 snmp-server engineid 1000 snmp-server user UserSkills GroupSkills authPriv aes Key-1122 auth sha Key-1122 snmp-server group GroupSkills authpriv read Skills_R write Skills_W snmp-server host 10.1.1.1 v3 authpriv UserSkills snmp-server host 2001:10:1:1::1 v3 authpriv UserSkills snmp-server enable traps 配置结果：\nSW1(config)#sho snmp engineid SNMP engineID:1 Engine Boots is:1 SW1(config)#sho snmp group Group Name:GROUP2022 Security Level:AuthPriv Read View:SKILLS_R Write View:SKILLS_W Notify View:\u0026lt;no notifyview specified\u0026gt; SW1(config)#sho snmp status System Name : DC YunKe Networks Co.,Ltd. System Contact : 400-810-9119 System Location : China Trap enable RMON enable Community Information: V1/V2c Trap Host Information: V3 Trap Host Information: Trap-rec-address: 2001:10:10:11::99 User-name :USER2022 Security Level:AuthPriv Trap-rec-address: 10.10.11.99 User-name :USER2022 Security Level:AuthPriv Security IP is Enabled. Security IP: 10.10.11.99 Security IP: 2001:10:10:11::99 SW1(config)#sho snmp user User name: USER2022 Engine ID: 0x31 Auth Protocol:SHA Priv Protocol:AES-CFB-128 Row status:active 当法务部门对应的用户接口发生 UP DOWN 事件时，禁止发送 trap 消息至上述集团网管服务器。\nSW1(config-if-ethernet1/0/3)#sho run c no switchport updown notification enable 7、互联流量镜像 将 W1 与 FW1 互连流量镜像到 SW1 E1/0/1，会话列表为 1。\nmonitor session 1 source interface Ethernet1/0/21 tx monitor session 1 source interface Ethernet1/0/21 rx monitor session 1 destination interface Ethernet1/0/1 配置结果：\nSW1(config)#sho monitor monitor session 1: Destination Ethernet1/0/1 Card: slot 1 source ports: RX port: 21 TX port: 21 -------------------------------------------------------- No monitor in session 2 -------------------------------------------------------- No monitor in session 3 -------------------------------------------------------- No monitor in session 4 -------------------------------------------------------- No monitor in session 5 -------------------------------------------------------- No monitor in session 6 -------------------------------------------------------- No monitor in session 7 -------------------------------------------------------- 8、ULDP SW1 和 SW2 E1/0/21-28 启用单向链路故障检测，当发生该故障时，端口标记为 errdisable 状态，自动关闭端口，经过 1 分钟后，端口自动重启；发送、、\nHello 报文时间间隔为 15s；\nSW1：\nSW1(config)#uldp enable SW1(config)#uldp aggressive-mode SW1(config)#inter e1/0/21-28 SW1(config-if-port-range)#uldp enable SW1(config-if-port-range)#uldp aggressive-mode SW1(config)#uldp recovery-time 60 SW1(config)#uldp hello-interval 15 配置结果：\nSW1(config)#sho uldp uldp enable uldp hello interval is 15 uldp recovery time is 60 uldp shut down mode is AUTO uldp global work mode is AGGRESSIVE the total number of the port is 8 --------------------------------------------------------------------------- PortName PhyLink LineProto WorkMode PortState NeighborNum --------------------------------------------------------------------------- Ethernet1/0/21 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/22 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/23 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/24 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/25 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/26 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/27 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/28 UP UP AGGRESSIVE BIDIRECTION 1 --------------------------------------------------------------------------- SW2：\nSW2(config)#uldp enable SW2(config)#uldp aggressive-mode SW2(config)#inter e1/0/21-28 SW2(config-if-port-range)#uldp enable SW2(config-if-port-range)#uldp aggressive-mode SW2(config)#uldp recovery-time 60 SW2(config)#uldp hello-interval 15 配置结果：\nSW2(config)#sho uldp uldp enable uldp hello interval is 15 uldp recovery time is 60 uldp shut down mode is AUTO uldp global work mode is AGGRESSIVE the total number of the port is 8 --------------------------------------------------------------------------- PortName PhyLink LineProto WorkMode PortState NeighborNum --------------------------------------------------------------------------- Ethernet1/0/21 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/22 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/23 UP UP AGGRESSIVE BIDIRECTION 0 Ethernet1/0/24 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/25 UP DOWN AGGRESSIVE INACTIVE 0 Ethernet1/0/26 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/27 UP UP AGGRESSIVE BIDIRECTION 1 Ethernet1/0/28 UP UP AGGRESSIVE BIDIRECTION 1 --------------------------------------------------------------------------- 9、LLDP\nSW1和SW2所有端口启用链路层发现协议，更新报文发送时间间隔为20s，老化时间乘法器值为 5，Trap 报文发送间隔为 10s，配置三条裸光缆端口使能Trap 功能。\nSW1：\n! lldp enable lldp msgTxHold 5 lldp tx-interval 10 ! Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable ! 配置结果：\nSW1#sho lldp -----LLDP GLOBAL INFORMATIONS----- LLDP has been enabled globally. LLDP enabled port : Ethernet1/0/21 Ethernet1/0/22 Ethernet1/0/23 Ethernet1/0/26 Ethernet1/0/27 Ethernet1/0/28 LLDP interval :10 LLDP txTTL :50 LLDP NotificationInterval :5 LLDP txDelay :2 LLDP-MED FastStart Repeat Count :4 -------------END------------------ SW1(config)#inter e1/0/26-28 SW1(config-if-port-range)#sho run c Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable SW2：\n! lldp enable lldp msgTxHold 5 lldp tx-interval 10 ! Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable ! 配置结果：\nSW2#sho lldp -----LLDP GLOBAL INFORMATIONS----- LLDP has been enabled globally. LLDP enabled port : Ethernet1/0/21 Ethernet1/0/22 Ethernet1/0/23 Ethernet1/0/26 Ethernet1/0/27 Ethernet1/0/28 LLDP interval :10 LLDP txTTL :50 LLDP NotificationInterval :5 LLDP txDelay :2 LLDP-MED FastStart Repeat Count :4 -------------END------------------ SW2(config)#inter e1/0/26-28 SW2(config-if-port-range)#sho run c Interface Ethernet1/0/26 lldp trap enable ! Interface Ethernet1/0/27 lldp trap enable ! Interface Ethernet1/0/28 lldp trap enable 二、路由配置 1、SSH服务 启用所有设备的 ssh 服务，防火墙用户名 admin，明文密码 Pass-1234，其余设备用户名和明文密码均为 admin。\n交换机\u0026amp;AC：\nSW(config)#ssh-server enable SW(config)#username admin password 0 admin 路由器：\nRT1_config#username admin password 0 admin RT1_config#aaa authentication login default local RT1_config#aaa authentication enable default none RT1_config#ip sshd enable 防火墙：in\n在所需端口上开启SSH服务\n例如： FW1(config)# interface e0/0 FW1(config-if-eth0/0)# manage ssh 2、配置时区 配置所有设备的时区为 GMT+08:00，调整 SW1 时间为实际时间，SW1 配置为 ntp server，其他设备用 SW1 loopback1 ipv4 地址作为 ntp server 地址，ntp client 请求报文时间间隔 1 分钟。\nSW1：\nSW1#clock set 14:41:30 2023.4.24 SW1#config SW1(config)#clock timezone GMT add 8 0 SW1(config)#ntp enable SW1(config)#ntp-service refclock-master 1 SW1(config)#ntp server 10.10.1.1 SW1(config)#ntp syn-interval 60 SW2、SW3、AC：\nclock timezone GMT add 8 0 ntp enable ntp syn-interval 60 ntp server 10.10.1.1 路由器：\ntime-zone GMT 8 0 ntp query-interval 60 ntp server 10.10.1.1 防火墙：\nFW1(config)# clock zone GMT 8 0 FW1(config)# ntp enable FW1(config)# ntp server 10.10.1.1 FW1(config)# ntp query-interval 1 配置结果：\nSW1(config)#sho clock Current time is Mon Apr 24 15:13:30 2023 [GMT+08:00] SW1(config)#sho ntp status ntp clock status: synchronized Clock stratum:4 Reference clock server:10.10.1.1 Clock offset:0.0 s Root delay:0.000 ms Root dispersion:0.000 ms Reference time:Mon Apr 24 07:06:3.203 2023 Syn-interval:60s 3、VRRP 利用 vrrpv2 和 vrrpv3 技术实现 vlan60、vlan70、vlan80、vlan90 网关冗余备份，vrrp id 与 vlan id 相同。vrrpv2 vip 为 10.10.vlanid.9（如 vlan60的 vrrpv2 vip 为 10.10.60.9），vrrpv3 vip 为 FE80:vlanid::9（如 vlan60 的vrrpv3 vip 为 FE80:60::9）。配置 SW1 为 vlan60、vlan70 的 Master，SW2 为vlan80、vlan90 的 aster。要求 vrrp 组中高优先级为 120，低优先级为默认值，抢占模式为默认值，vrrpv2 和 vrrpv3 发送通告报文时间间隔为默认值。当 SW1或 SW2 上联链路发生故障，Master 优先级降低 50。\nVRRPv2 SW1：\n! router vrrp 60 virtual-ip 10.10.60.9 interface Vlan60 circuit-failover Vlan1021 50 priority 120 enable ! router vrrp 70 virtual-ip 10.10.70.9 interface Vlan70 circuit-failover Vlan1021 50 priority 120 enable ! router vrrp 80 virtual-ip 10.10.80.9 interface Vlan80 enable ! router vrrp 90 virtual-ip 10.10.90.9 interface Vlan90 enable ! 配置结果：\nSW1(config)#sho vrrp VrId 60 State is Master Virtual IP is 10.10.60.9 (Not IP owner) Interface is Vlan60 Configured priority is 120, Current priority is 120 Advertisement interval is 1 sec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VrId 70 State is Master Virtual IP is 10.10.70.9 (Not IP owner) Interface is Vlan70 Configured priority is 120, Current priority is 120 Advertisement interval is 1 sec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VrId 80 State is Backup Virtual IP is 10.10.80.9 (Not IP owner) Interface is Vlan80 Priority is 100(config priority is 100) Advertisement interval is 1 sec Preempt mode is TRUE VrId 90 State is Backup Virtual IP is 10.10.90.9 (Not IP owner) Interface is Vlan90 Priority is 100(config priority is 100) Advertisement interval is 1 sec Preempt mode is TRUE SW2：\n! router vrrp 60 virtual-ip 10.10.60.9 interface Vlan60 enable ! router vrrp 70 virtual-ip 10.10.70.9 interface Vlan70 enable ! router vrrp 80 virtual-ip 10.10.80.9 interface Vlan80 circuit-failover Vlan1021 50 priority 120 enable ! router vrrp 90 virtual-ip 10.10.90.9 interface Vlan90 circuit-failover Vlan1021 50 priority 120 enable ! 配置结果：\nSW2(config)#sho vrrp VrId 60 State is Backup Virtual IP is 10.10.60.9 (Not IP owner) Interface is Vlan60 Priority is 100(config priority is 100) Advertisement interval is 1 sec Preempt mode is TRUE VrId 70 State is Backup Virtual IP is 10.10.70.9 (Not IP owner) Interface is Vlan70 Priority is 100(config priority is 100) Advertisement interval is 1 sec Preempt mode is TRUE VrId 80 State is Master Virtual IP is 10.10.80.9 (Not IP owner) Interface is Vlan80 Configured priority is 120, Current priority is 120 Advertisement interval is 1 sec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VrId 90 State is Master Virtual IP is 10.10.90.9 (Not IP owner) Interface is Vlan90 Configured priority is 120, Current priority is 120 Advertisement interval is 1 sec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP 配置结果：\nSW2(config)#sho ipv6 vrrp VrId 60 State is Backup Virtual IPv6 is fe80:60::9 (Not IPv6 owner) Interface is Vlan60 Priority is 100(config priority is 100) Advertisement interval is 100 centisec Preempt mode is TRUE VrId 70 State is Backup Virtual IPv6 is fe80:70::9 (Not IPv6 owner) Interface is Vlan70 Priority is 100(config priority is 100) Advertisement interval is 100 centisec Preempt mode is TRUE VrId 80 State is Master Virtual IPv6 is fe80:80::9 (Not IPv6 owner) Interface is Vlan80 Configured priority is 120, Current priority is 120 Advertisement interval is 100 centisec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VrId 90 State is Master Virtual IPv6 is fe80:90::9 (Not IPv6 owner) Interface is Vlan90 Configured priority is 120, Current priority is 120 Advertisement interval is 100 centisec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VRRPv3 SW1:\n! router ipv6 vrrp 60 virtual-ipv6 fe80:60::9 interface Vlan60 circuit-failover Vlan1021 50 priority 120 enable ! router ipv6 vrrp 70 virtual-ipv6 fe80:70::9 interface Vlan70 circuit-failover Vlan1021 50 priority 120 enable ! router ipv6 vrrp 80 virtual-ipv6 fe80:80::9 interface Vlan80 enable ! router ipv6 vrrp 90 virtual-ipv6 fe80:90::9 interface Vlan90 enable ! SW2:\n! router ipv6 vrrp 60 virtual-ipv6 fe80:60::9 interface Vlan60 enable ! router ipv6 vrrp 70 virtual-ipv6 fe80:70::9 interface Vlan70 enable ! router ipv6 vrrp 80 virtual-ipv6 fe80:80::9 interface Vlan80 circuit-failover Vlan1021 50 priority 120 enable ! router ipv6 vrrp 90 virtual-ipv6 fe80:90::9 interface Vlan90 circuit-failover Vlan1021 50 priority 120 enable ! 配置结果：\nSW1(config)#sho ipv6 vrrp VrId 60 State is Master Virtual IPv6 is fe80:60::9 (Not IPv6 owner) Interface is Vlan60 Configured priority is 120, Current priority is 120 Advertisement interval is 100 centisec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VrId 70 State is Master Virtual IPv6 is fe80:70::9 (Not IPv6 owner) Interface is Vlan70 Configured priority is 120, Current priority is 120 Advertisement interval is 100 centisec Preempt mode is TRUE Circuit failover interface Vlan1021, Priority Delta 50, Status UP VrId 80 State is Backup Virtual IPv6 is fe80:80::9 (Not IPv6 owner) Interface is Vlan80 Priority is 100(config priority is 100) Advertisement interval is 100 centisec Preempt mode is TRUE VrId 90 State is Backup Virtual IPv6 is fe80:90::9 (Not IPv6 owner) Interface is Vlan90 Priority is 100(config priority is 100) Advertisement interval is 100 centisec Preempt mode is TRUE 4、DHCP服务 AC1配置dhcpv4和dhcpv6，分别为SW1产品1段vlan10和分公司vlan100、vlan110 和 vlan120 分配地址；ipv4 地址池名称分别为 POOLv4-10、POOLv4-100、POOLv4-110、POOLv4-120\nservice dhcp ! ip dhcp pool POOLv4-10 network-address 10.10.11.0 255.255.255.0 default-router 10.10.11.1 dns-server 114.114.114.114 ! ip dhcp pool POOLv4-100 network-address 10.17.100.0 255.255.255.0 default-router 10.17.100.1 dns-server 114.114.114.114 ! ip dhcp pool POOLv4-110 network-address 10.17.110.0 255.255.255.0 default-router 10.17.110.1 dns-server 114.114.114.114 ! ip dhcp pool POOLv4-120 network-address 10.17.120.0 255.255.255.0 default-router 10.17.120.1 dns-server 114.114.114.114 ipv6 地址池名称分别为 POOLv6-10、POOLv6-100、POOLv6-110、POOLv6-120；ipv6 地址池用网络前缀表示；\nservice dhcpv6 ! ipv6 dhcp pool POOLv6-120 network-address 2001:10:17:120:: 64 static-binding 2001:10:17:120::9 24-69-8e-1e-b9-5e excluded-address 2001:10:17:120::1 ! ipv6 dhcp pool POOLv6-110 network-address 2001:10:17:110:: 64 static-binding 2001:10:17:110::9 8c-16-45-78-8d-98 excluded-address 2001:10:17:110::1 ! ipv6 dhcp pool POOLv6-100 network-address 2001:10:17:100:: 64 static-binding 2001:10:17:100::9 00-03-0f-8a-f8-b0 excluded-address 2001:10:17:100::1 ! ipv6 dhcp pool POOLv6-10 network-address 2001:10:10:11:: 64 excluded-address 2001:10:10:11::1 dns-server 2400:3200::1 ! 排除网关；\nIPv4:\nip dhcp excluded-address 10.10.11.1 ip dhcp excluded-address 10.17.100.1 ip dhcp excluded-address 10.17.110.1 ip dhcp excluded-address 10.17.120.1 IPv6:\nipv6 dhcp pool POOLv6-120 excluded-address 2001:10:17:120::1 ! ipv6 dhcp pool POOLv6-110 excluded-address 2001:10:17:110::1 ! ipv6 dhcp pool POOLv6-100 excluded-address 2001:10:17:100::1 ! ipv6 dhcp pool POOLv6-10 dns-server 2400:3200::1 ! DNS 分别为114.114.114.114 和 2400:3200::1 ； 为 PC1 保 留 地 址 10.10.11.9 和2001:10:10:11::9，为 AP1 保留地址 10.17.100.9 和 2001:10:17\u0026#x1f4af;9，为 PC2保留地址 10.17.110.9 和 2001:10:17:110::9。\nip dhcp pool AP1 host 10.17.100.9 255.255.255.0 hardware-address 00-03-0F-8A-F8-B0 default-router 10.17.100.1 ! ip dhcp pool PC1 host 10.10.11.9 255.255.255.0 hardware-address 8C-16-45-78-8D-98 default-router 10.10.11.1 dns-server 114.114.114.114 ! ip dhcp pool PC2 host 10.17.110.9 255.255.255.0 hardware-address 24-69-8E-1E-B9-5E default-router 10.17.110.1 dns-server 114.114.114.114 ! interface Vlan1000 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag ipv6 dhcp server POOLv6-100 ! interface Vlan110 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag ipv6 dhcp server POOLv6-110 ! interface Vlan120 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag ipv6 dhcp server POOLv6-120 ! DHCP中继： SW1 上中继地址为 AC1 loopback1地址。\nIPV4:\nSW1：\nSW1(config)#service dhcp SW1(config)#ip forward-protocol udp bootps interface Vlan10 ip helper-address 10.10.8.1 IPV6:\nSW1(config)#service dhcpv6 interface Vlan10 no ipv6 nd suppress-ra ipv6 nd managed-config-flag ipv6 nd other-config-flag ipv6 dhcp relay destination 2001:10:10:8::1 DHCP snooping SW1 启用 dhcpv4 和 dhcpv6 snooping，如果 E1/0/1 连接 dhcpv4 服务器，则关闭该端口，恢复时间为 1 分钟。\nIPV4:\nip dhcp snooping enable ! Interface Ethernet1/0/1 ip dhcp snooping action shutdown recovery 60 Interface Ethernet1/0/21;26;22 ip dhcp snooping trust IPV6:\nSW1(config)#savi enable SW1(config)#savi ipv6 dhcp-only enable Interface Ethernet1/0/21;26;22 ipv dhcp snooping trust 5、OSPF SW1、SW2、SW3、RT1 以太链路、RT2 以太链路、FW1、FW2、AC1 之间运行OSPFv2 和 OSPFv3 协议（路由模式发布网络用接口地址，-\tBGP 协议除外）。\nOSPFv2 (1) SW1、SW2、SW3、RT1、RT2、FW1 之间 OSPFv2 ，进程 1，区域 0，分别发布 loopback1 地址路由和产品路由，FW1 通告 type2 默认路由。\nSW1:\nrouter ospf 1 ospf router-id 10.10.1.1 network 10.10.1.1/32 area 0 network 10.10.11.1/32 area 0 network 10.10.255.1/32 area 0 network 10.10.255.5/32 area 0 network 10.10.255.14/32 area 0 SW2:\nrouter ospf 1 ospf router-id 10.10.2.1 network 10.10.2.1/32 area 0 network 10.10.21.1/32 area 0 network 10.10.255.2/32 area 0 network 10.10.255.9/32 area 0 network 10.10.255.22/32 area 0 SW3:\nrouter ospf 1 ospf router-id 10.10.3.1 network 10.10.3.1/32 area 0 network 10.10.31.1/32 area 0 network 10.10.255.6/32 area 0 network 10.10.255.10/32 area 0 RT1:\nrouter ospf 1 router-id 10.10.4.1 network 10.10.4.1 255.255.255.255 area 0 network 10.10.255.29 255.255.255.255 area 0 network 10.10.255.21 255.255.255.255 area 0 network 10.10.255.18 255.255.255.255 area 0 RT2:\nrouter ospf 1 router-id 10.10.5.1 network 10.10.5.1 255.255.255.255 area 0 network 10.10.255.30 255.255.255.255 area 0 FW1:\nip vrouter \u0026quot;trust-vr\u0026quot; ip route 0.0.0.0/0 200.200.200.1 router ospf 1 router-id 10.10.6.1 default-information originate network 10.10.6.1/32 area 0 network 10.10.255.13/32 area 0 network 10.10.255.17/32 area 0 exit (2) RT2 与 AC1 之间运行 OSPFv2 协议，进程 1，nssa no-summary 区域 1；AC1 发布 loopback1 地址路由、产品和营销路由，用 prefix-list 重发布loopback3。\nRT2:\nrouter ospf 1 network 10.10.255.41 255.255.255.255 area 1 area 1 nssa no-summary AC1:\nrouter ospf 1 ospf router-id 10.10.8.1 area 1 nssa no-summary network 10.10.8.1/32 area 1 network 10.10.255.42/32 area 1 network 10.17.110.1/32 area 1 network 10.17.120.1/32 area 1 redistribute connected route-map L3 ! ip prefix-list L3 seq 5 permit 10.10.8.3/32 ! route-map L3 permit 10 match ip address prefix-list L3 (4)SW3 模拟办事处产品和营销接口配置为 loopback，模拟接口 up。SW3 模拟办事处与 FW2 之间运行 OSPFv2 协议，进程 2，区域 2，SW3 模拟办事处发布loopback2、产品和营销。\nSW3：\nInterface Ethernet1/0/11 loopback switchport access vlan 110 ! Interface Ethernet1/0/12 loopback switchport access vlan 120 router ospf 2 Guangdong ospf router-id 10.10.3.2 network 10.10.3.2/32 area 2 network 10.10.255.46/32 area 2 network 10.16.110.1/32 area 2 network 10.16.120.1/32 area 2 FW2:\nip vrouter \u0026quot;trust-vr\u0026quot; router ospf 2 router-id 10.10.7.1 network 10.10.255.45/32 area 2 network 10.10.255.26/32 area 2 network 10.10.7.1/32 area 2 exit (5)RT1、FW2 之间 OSPFv2 协议，进程 2，区域 2；RT1 发布 loopback4路由，向该区域通告 type1 默认路由；\nRT1:\nrouter ospf 2 router-id 10.10.4.4 network 10.10.4.4 255.255.255.255 area 2 network 10.10.255.25 255.255.255.255 area 2 default-information originate always metric-type 1 FW2 发布 loopback1 路由，FW2 禁止学习到集团和分公司的所有路由。\nip vrouter \u0026quot;trust-vr\u0026quot; router ospf 2 router-id 10.10.7.1 network 10.10.255.45/32 area 2 network 10.10.255.26/32 area 2 network 10.10.7.1/32 area 2 exit RT1 用 prefix-list 匹配 FW2 loopback1 路由、SW3模拟办事处 loopback2 和产品路由、RT1 与 FW2 直连 ipv4 路由，将这些路由重发布到区域 0。\nrouter ospf 1 router-id 10.10.4.1 network 10.10.4.1 255.255.255.255 area 0 network 10.10.255.29 255.255.255.255 area 0 network 10.10.255.21 255.255.255.255 area 0 network 10.10.255.18 255.255.255.255 area 0 redistribute ospf 2 route-map BSC redistribute connect route-map ZL route-map BSC 10 permit match ip address prefix-list BSC ip prefix-list BSC seq 5 permit 10.10.7.1/32 ip prefix-list BSC seq 10 permit 10.10.3.2/32 ip prefix-list BSC seq 15 permit 10.16.110.0/24 route-map ZL 10 permit match ip address prefix-list ZL ip prefix-list ZL seq 5 permit 10.10.255.24/30 路由表：\nSW1:\nSW1(config)#sho ip route ospf O*E2 0.0.0.0/0 [110/10] via 10.10.255.13, Vlan1021, 12:37:46 tag:0 O 10.10.2.1/32 [110/2] via 10.10.255.2, Vlan1026, 15:51:53 tag:0 O 10.10.3.1/32 [110/2] via 10.10.255.6, Vlan1022, 15:46:35 tag:0 O E2 10.10.3.2/32 [110/100] via 10.10.255.13, Vlan1021, 11:56:19 tag:0 [110/100] via 10.10.255.2, Vlan1026, 11:56:19 tag:0 O 10.10.4.1/32 [110/3] via 10.10.255.13, Vlan1021, 14:40:59 tag:0 [110/3] via 10.10.255.2, Vlan1026, 14:40:59 tag:0 O 10.10.5.1/32 [110/4] via 10.10.255.13, Vlan1021, 14:40:59 tag:0 [110/4] via 10.10.255.2, Vlan1026, 14:40:59 tag:0 O 10.10.6.1/32 [110/2] via 10.10.255.13, Vlan1021, 14:42:20 tag:0 O E2 10.10.7.1/32 [110/100] via 10.10.255.13, Vlan1021, 12:02:08 tag:0 [110/100] via 10.10.255.2, Vlan1026, 12:02:08 tag:0 O IA 10.10.8.1/32 [110/5] via 10.10.255.13, Vlan1021, 13:59:39 tag:0 [110/5] via 10.10.255.2, Vlan1026, 13:59:39 tag:0 O E2 10.10.8.3/32 [110/20] via 10.10.255.13, Vlan1021, 12:32:00 tag:0 [110/20] via 10.10.255.2, Vlan1026, 12:32:00 tag:0 O 10.10.21.0/24 [110/2] via 10.10.255.2, Vlan1026, 15:51:53 tag:0 O 10.10.31.0/24 [110/2] via 10.10.255.6, Vlan1022, 15:46:35 tag:0 O 10.10.255.8/30 [110/2] via 10.10.255.6, Vlan1022, 15:46:35 tag:0 [110/2] via 10.10.255.2, Vlan1026, 15:46:35 tag:0 O 10.10.255.16/30 [110/2] via 10.10.255.13, Vlan1021, 14:41:09 tag:0 O 10.10.255.20/30 [110/2] via 10.10.255.2, Vlan1026, 15:51:53 tag:0 O E2 10.10.255.24/30 [110/100] via 10.10.255.13, Vlan1021, 11:52:58 tag:0 [110/100] via 10.10.255.2, Vlan1026, 11:52:58 tag:0 O 10.10.255.28/30 [110/3] via 10.10.255.13, Vlan1021, 14:40:59 tag:0 [110/3] via 10.10.255.2, Vlan1026, 14:40:59 tag:0 O IA 10.10.255.40/30 [110/4] via 10.10.255.13, Vlan1021, 13:59:30 tag:0 [110/4] via 10.10.255.2, Vlan1026, 13:59:30 tag:0 O E2 10.16.110.0/24 [110/100] via 10.10.255.13, Vlan1021, 11:55:52 tag:0 [110/100] via 10.10.255.2, Vlan1026, 11:55:52 tag:0 O IA 10.17.110.0/24 [110/5] via 10.10.255.13, Vlan1021, 13:59:39 tag:0 [110/5] via 10.10.255.2, Vlan1026, 13:59:39 tag:0 O IA 10.17.120.0/24 [110/5] via 10.10.255.13, Vlan1021, 13:59:39 tag:0 [110/5] via 10.10.255.2, Vlan1026, 13:59:39 tag:0 Total routes are : 34 item(s) SW2:\nSW2(config)#sho ip rout ospf O*E2 0.0.0.0/0 [110/10] via 10.10.255.1, Vlan1026, 12:38:26 tag:0 [110/10] via 10.10.255.21, Vlan1021, 12:38:26 tag:0 O 10.10.1.1/32 [110/2] via 10.10.255.1, Vlan1026, 15:52:34 tag:0 O 10.10.3.1/32 [110/2] via 10.10.255.10, Vlan1022, 15:47:42 tag:0 O E2 10.10.3.2/32 [110/100] via 10.10.255.21, Vlan1021, 11:57:00 tag:0 O 10.10.4.1/32 [110/2] via 10.10.255.21, Vlan1021, 15:18:41 tag:0 O 10.10.5.1/32 [110/3] via 10.10.255.21, Vlan1021, 15:03:50 tag:0 O 10.10.6.1/32 [110/3] via 10.10.255.1, Vlan1026, 14:41:39 tag:0 [110/3] via 10.10.255.21, Vlan1021, 14:41:39 tag:0 O E2 10.10.7.1/32 [110/100] via 10.10.255.21, Vlan1021, 12:02:49 tag:0 O IA 10.10.8.1/32 [110/4] via 10.10.255.21, Vlan1021, 14:00:19 tag:0 O E2 10.10.8.3/32 [110/20] via 10.10.255.21, Vlan1021, 12:32:40 tag:0 O 10.10.11.0/24 [110/2] via 10.10.255.1, Vlan1026, 15:52:34 tag:0 O 10.10.31.0/24 [110/2] via 10.10.255.10, Vlan1022, 15:47:42 tag:0 O 10.10.255.4/30 [110/2] via 10.10.255.1, Vlan1026, 15:47:42 tag:0 [110/2] via 10.10.255.10, Vlan1022, 15:47:42 tag:0 O 10.10.255.12/30 [110/2] via 10.10.255.1, Vlan1026, 15:52:34 tag:0 O 10.10.255.16/30 [110/2] via 10.10.255.21, Vlan1021, 15:18:41 tag:0 O E2 10.10.255.24/30 [110/100] via 10.10.255.21, Vlan1021, 11:53:38 tag:0 O 10.10.255.28/30 [110/2] via 10.10.255.21, Vlan1021, 15:08:47 tag:0 O IA 10.10.255.40/30 [110/3] via 10.10.255.21, Vlan1021, 14:00:11 tag:0 O E2 10.16.110.0/24 [110/100] via 10.10.255.21, Vlan1021, 11:56:32 tag:0 O IA 10.17.110.0/24 [110/4] via 10.10.255.21, Vlan1021, 14:00:19 tag:0 O IA 10.17.120.0/24 [110/4] via 10.10.255.21, Vlan1021, 14:00:19 tag:0 Total routes are : 24 item(s) SW3:\nSW3(config)#sho ip route ospf O*E2 0.0.0.0/0 [110/10] via 10.10.255.5, Vlan1021, 12:38:54 tag:0 O 10.10.1.1/32 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 O 10.10.2.1/32 [110/2] via 10.10.255.9, Vlan1022, 15:48:13 tag:0 O E2 10.10.3.2/32 [110/100] via 10.10.255.9, Vlan1022, 11:57:27 tag:0 O 10.10.4.1/32 [110/3] via 10.10.255.9, Vlan1022, 15:19:09 tag:0 O 10.10.5.1/32 [110/4] via 10.10.255.9, Vlan1022, 15:04:17 tag:0 O 10.10.6.1/32 [110/3] via 10.10.255.5, Vlan1021, 14:43:28 tag:0 O E2 10.10.7.1/32 [110/100] via 10.10.255.9, Vlan1022, 12:03:16 tag:0 O IA 10.10.8.1/32 [110/5] via 10.10.255.9, Vlan1022, 14:00:47 tag:0 O E2 10.10.8.3/32 [110/20] via 10.10.255.9, Vlan1022, 12:33:08 tag:0 O 10.10.11.0/24 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 O 10.10.21.0/24 [110/2] via 10.10.255.9, Vlan1022, 15:48:13 tag:0 O 10.10.255.0/30 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 [110/2] via 10.10.255.9, Vlan1022, 15:47:43 tag:0 O 10.10.255.12/30 [110/2] via 10.10.255.5, Vlan1021, 15:47:43 tag:0 O 10.10.255.16/30 [110/3] via 10.10.255.5, Vlan1021, 14:42:17 tag:0 [110/3] via 10.10.255.9, Vlan1022, 14:42:17 tag:0 O 10.10.255.20/30 [110/2] via 10.10.255.9, Vlan1022, 15:48:13 tag:0 O E2 10.10.255.24/30 [110/100] via 10.10.255.9, Vlan1022, 11:54:06 tag:0 O 10.10.255.28/30 [110/3] via 10.10.255.9, Vlan1022, 15:09:14 tag:0 O IA 10.10.255.40/30 [110/4] via 10.10.255.9, Vlan1022, 14:00:39 tag:0 O E2 10.16.110.0/24 [110/100] via 10.10.255.9, Vlan1022, 11:57:00 tag:0 O IA 10.17.110.0/24 [110/5] via 10.10.255.9, Vlan1022, 14:00:47 tag:0 O IA 10.17.120.0/24 [110/5] via 10.10.255.9, Vlan1022, 14:00:47 tag:0 Total routes are : 24 item(s) SW3(config)#sho ip route vrf Guangdong ospf O*E1 0.0.0.0/0 [110/102] via 10.10.255.45, Vlan1015, 12:10:12 tag:0 O 10.10.4.4/32 [110/3] via 10.10.255.45, Vlan1015, 12:10:13 tag:0 O 10.10.7.1/32 [110/2] via 10.10.255.45, Vlan1015, 12:19:31 tag:0 O 10.10.255.24/30 [110/2] via 10.10.255.45, Vlan1015, 12:10:33 tag:0 Total routes are : 4 item(s) RT1:\nRT1_config#sho ip route ospf VRF ID: 0 O E2 0.0.0.0/0 [150,10] via 10.10.255.17(on GigaEthernet0/2) O 10.10.1.1/32 [110,3] via 10.10.255.17(on GigaEthernet0/2) [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.2.1/32 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.3.1/32 [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.3.2/32 [110,3] via 10.10.255.26(on GigaEthernet0/3) O 10.10.5.1/32 [110,2] via 10.10.255.30(on GigaEthernet0/0) O 10.10.6.1/32 [110,2] via 10.10.255.17(on GigaEthernet0/2) O 10.10.7.1/32 [110,2] via 10.10.255.26(on GigaEthernet0/3) O IA 10.10.8.1/32 [110,3] via 10.10.255.30(on GigaEthernet0/0) O E2 10.10.8.3/32 [150,20] via 10.10.255.30(on GigaEthernet0/0) O 10.10.11.0/24 [110,3] via 10.10.255.17(on GigaEthernet0/2) [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.21.0/24 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.31.0/24 [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.0/30 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.4/30 [110,3] via 10.10.255.17(on GigaEthernet0/2) [110,3] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.8/30 [110,2] via 10.10.255.22(on GigaEthernet0/1) O 10.10.255.12/30 [110,2] via 10.10.255.17(on GigaEthernet0/2) O IA 10.10.255.40/30 [110,2] via 10.10.255.30(on GigaEthernet0/0) O 10.10.255.44/30 [110,2] via 10.10.255.26(on GigaEthernet0/3) O 10.16.110.0/24 [110,3] via 10.10.255.26(on GigaEthernet0/3) O 10.16.120.0/24 [110,3] via 10.10.255.26(on GigaEthernet0/3) O IA 10.17.110.0/24 [110,3] via 10.10.255.30(on GigaEthernet0/0) O IA 10.17.120.0/24 [110,3] via 10.10.255.30(on GigaEthernet0/0) RT2:\nRT2_config#sho ip route ospf VRF ID: 0 O E2 0.0.0.0/0 [150,10] via 10.10.255.29(on GigaEthernet0/0) O 10.10.1.1/32 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.2.1/32 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.3.1/32 [110,4] via 10.10.255.29(on GigaEthernet0/0) O E2 10.10.3.2/32 [150,100] via 10.10.255.29(on GigaEthernet0/0) O 10.10.4.1/32 [110,2] via 10.10.255.29(on GigaEthernet0/0) O 10.10.6.1/32 [110,3] via 10.10.255.29(on GigaEthernet0/0) O E2 10.10.7.1/32 [150,100] via 10.10.255.29(on GigaEthernet0/0) O 10.10.8.1/32 [110,2] via 10.10.255.42(on GigaEthernet0/1) O N2 10.10.8.3/32 [150,20] via 10.10.255.42(on GigaEthernet0/1) O 10.10.11.0/24 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.21.0/24 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.31.0/24 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.0/30 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.4/30 [110,4] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.8/30 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.12/30 [110,3] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.16/30 [110,2] via 10.10.255.29(on GigaEthernet0/0) O 10.10.255.20/30 [110,2] via 10.10.255.29(on GigaEthernet0/0) O E2 10.10.255.24/30 [150,100] via 10.10.255.29(on GigaEthernet0/0) O E2 10.16.110.0/24 [150,100] via 10.10.255.29(on GigaEthernet0/0) O 10.17.110.0/24 [110,2] via 10.10.255.42(on GigaEthernet0/1) O 10.17.120.0/24 [110,2] via 10.10.255.42(on GigaEthernet0/1) AC1:\nAC1(config)#sho ip route os O*IA 0.0.0.0/0 [110/101] via 10.10.255.41, Vlan1001, 14:02:54 tag:0 Total routes are : 1 item(s) FW1:\nFW1(config)# sho ip route ospf Codes: K - kernel route, C - connected, S - static, Z - ISP, R - RIP, O - OSPF, B - BGP, D - DHCP, P - PPPoE, W - wireless, H - HOST, G - SCVPN, V - VPN, M - IMPORT, I - ISIS, Y - SYNC, L - llb outbound, \u0026gt; - selected first nexthop, * - FIB route, b - BFD enable Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt;* 10.10.1.1/32 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.2.1/32 [110/3/1] via 10.10.255.14, ethernet0/1, 14:44:57 * [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.3.1/32 [110/3/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.3.2/32 [110/100/1] via 10.10.255.18, ethernet0/2, 12:00:17 O\u0026gt;* 10.10.4.1/32 [110/2/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.5.1/32 [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.7.1/32 [110/100/1] via 10.10.255.18, ethernet0/2, 12:06:06 O\u0026gt;* 10.10.8.1/32 [110/4/1] via 10.10.255.18, ethernet0/2, 14:03:32 O\u0026gt;* 10.10.8.3/32 [110/20/1] via 10.10.255.18, ethernet0/2, 12:35:58 O\u0026gt;* 10.10.11.0/24 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.21.0/24 [110/3/1] via 10.10.255.14, ethernet0/1, 14:44:57 * [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.31.0/24 [110/3/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.255.0/30 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.255.4/30 [110/2/1] via 10.10.255.14, ethernet0/1, 14:46:08 O\u0026gt;* 10.10.255.8/30 [110/3/1] via 10.10.255.14, ethernet0/1, 14:44:57 * [110/3/1] via 10.10.255.18, ethernet0/2, 14:44:57 O\u0026gt;* 10.10.255.20/30 [110/2/1] via 10.10.255.18, ethernet0/2, 14:44:59 O\u0026gt;* 10.10.255.24/30 [110/100/1] via 10.10.255.18, ethernet0/2, 11:56:58 O\u0026gt;* 10.10.255.28/30 [110/2/1] via 10.10.255.18, ethernet0/2, 14:44:59 O\u0026gt;* 10.10.255.40/30 [110/3/1] via 10.10.255.18, ethernet0/2, 14:03:24 O\u0026gt;* 10.16.110.0/24 [110/100/1] via 10.10.255.18, ethernet0/2, 11:59:52 O\u0026gt;* 10.17.110.0/24 [110/4/1] via 10.10.255.18, ethernet0/2, 14:03:34 O\u0026gt;* 10.17.120.0/24 [110/4/1] via 10.10.255.18, ethernet0/2, 14:03:34 ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== FW2:\nFW2(config)# sho ip route os \u0026lt;cr\u0026gt; | Output modifiers vrouter Virtual router FW2(config)# sho ip route os Codes: K - kernel route, C - connected, S - static, Z - ISP, R - RIP, O - OSPF, B - BGP, D - DHCP, P - PPPoE, W - wireless, H - HOST, G - SCVPN, V - VPN, M - IMPORT, I - ISIS, Y - SYNC, L - llb outbound, \u0026gt; - selected first nexthop, * - FIB route, b - BFD enable Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt;* 0.0.0.0/0 [110/101/1] via 10.10.255.25, ethernet0/2, 12:12:31 O\u0026gt;* 10.10.3.2/32 [110/2/1] via 10.10.255.46, ethernet0/1, 12:23:29 O\u0026gt;* 10.10.4.4/32 [110/2/1] via 10.10.255.25, ethernet0/2, 12:12:32 O\u0026gt;* 10.16.110.0/24 [110/2/1] via 10.10.255.46, ethernet0/1, 12:23:29 O\u0026gt;* 10.16.120.0/24 [110/2/1] via 10.10.255.46, ethernet0/1, 12:23:29 ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== OSPFv3 (1) SW1、SW2、SW3、RT1、RT2、FW1 之间 OSPFv3 ，进程 1，区域 0，分别发布 loopback1 地址路由和产品路由，FW1 通告 type2 默认路由。\nSW1:\nrouter ipv6 ospf 1 router-id 10.10.1.1 interface Loopback1 ipv6 router ospf area 0 tag 1 ! interface Vlan10 ipv6 router ospf area 0 tag 1 ! interface Vlan1021 ipv6 router ospf area 0 tag 1 ! interface Vlan1022 ipv6 router ospf area 0 tag 1 ! interface Vlan1026 ipv6 router ospf area 0 tag 1 SW2:\nrouter ipv6 ospf 1 router-id 10.10.2.1 interface Loopback1 ipv6 router ospf area 0 tag 1 ! interface Vlan10 ipv6 router ospf area 0 tag 1 ! interface Vlan1021 ipv6 router ospf area 0 tag 1 ! interface Vlan1022 ipv6 router ospf area 0 tag 1 ! interface Vlan1026 ipv6 router ospf area 0 tag 1 SW3:\nrouter ipv6 ospf 1 router-id 10.10.3.1 interface Loopback1 ipv6 router ospf area 0 tag 1 ! interface Vlan10 ipv6 router ospf area 0 tag 1 ! interface Vlan1021 ipv6 router ospf area 0 tag 1 ! interface Vlan1022 ipv6 router ospf area 0 tag 1 RT1:\nrouter ospfv3 1 router-id 10.10.4.1 interface Loopback1 ipv6 enable ipv6 ospf 1 area 0 ! interface GigaEthernet0/0 ipv6 enable ipv6 ospf 1 area 0 ! interface GigaEthernet0/1 ipv6 enable ipv6 ospf 1 area 0 ! interface GigaEthernet0/2 ipv6 ospf 1 area 0 RT2:\nrouter ospfv3 1 router-id 10.10.5.1 interface Loopback1 ipv6 enable ipv6 ospf 1 area 0 ! interface GigaEthernet0/0 ipv6 enable ipv6 ospf 1 area 0 FW1:\nipv6 route ::/0 \u0026quot;ethernet0/3\u0026quot; FE80::203:FFF:FEE0:F9B8 ipv6 router ospf 1 router-id 10.10.6.1 default-information originate exit ! interface loopback1 ipv6 enable ipv6 ospf 1 area 0 ! interface ethernet0/1 ipv6 enable ipv6 ospf 1 area 0 ! interface ethernet0/2 ipv6 enable ipv6 ospf 1 area 0 (3)RT2 与 AC1 之间运行 OSPFv3 协议，进程 1，stub no-summary 区域 1；AC1 发布 loopback1 地址路由、产品和营销。\nRT2:\nrouter ospfv3 1 router-id 10.10.5.1 area 1 stub no-summary interface GigaEthernet0/1 ipv6 enable ipv6 ospf 1 area 1 AC1:\nrouter ipv6 ospf 1 router-id 10.10.8.1 area 1 stub no-summary interface Loopback1 ipv6 router ospf area 1 tag 1 ! interface Vlan110 ipv6 router ospf area 1 tag 1 ! interface Vlan120 ipv6 router ospf area 1 tag 1 ! interface Vlan1001 ipv6 router ospf area 1 tag 1 (4)SW3 模拟办事处配置 ipv6 默认路由；FW2 分别配置到 SW3 模拟办事处 loopback2、产品和营销的 ipv6 明细静态路由，FW2 重发布静态 路由到 OSPFv3 协议。\nSW3:\nipv6 route vrf Guangdong ::/0 fe80::203:fff:fea6:8341 Vlan1015 FW2:\nip vrouter \u0026quot;trust-vr\u0026quot; ipv6 route 2001:10:10:3::1/128 \u0026quot;ethernet0/1\u0026quot; FE80::203:FFF:FEE0:F9B8 ipv6 route 2001:10:16:110::/64 \u0026quot;ethernet0/1\u0026quot; FE80::203:FFF:FEE0:F9B8 ipv6 route 2001:10:16:120::/64 \u0026quot;ethernet0/1\u0026quot; FE80::203:FFF:FEE0:F9B8 exit ipv6 router ospf 2 router-id 10.10.7.1 redistribute static exit (5)RT1、FW2 之间OSPFv3 协议，进程 2，区域 2；RT1 发布 loopback4路由，向该区域通告 type1 默认路由；\nRT1:\nrouter ospfv3 2 router-id 10.10.4.4 default-information originate always metric-type 1 interface Loopback4 ipv6 enable ipv6 ospf 2 area 2 FW2 发布 loopback1 路由，FW2 禁止学习到集团和分公司的所有路由。\nFW2:\ninterface loopback1 ipv6 enable ipv6 ospf 2 area 2 interface ethernet0/1 ipv6 enable ipv6 ospf 2 area 2 exit interface ethernet0/2 ipv6 enable ipv6 ospf 2 area 2 exit RT1 用 prefix-list 匹配 FW2 loopback1 路由、SW3模拟办事处 loopback2 和产品路由、RT1 与 FW2 直连 ipv4 路由，将这些路由重发布到区域 0。\nrouter ospfv3 1 router-id 10.10.4.1 redistribute ospf 2 route-map BSCV6· ! route-map BSCV6 10 permit match ipv6 address prefix-list BSCV6 ! ipv6 prefix-list BSCV6 seq 5 permit 2001:10:10:3::2/128 ipv6 prefix-list BSCV6 seq 10 permit 2001:10:16:110::/64 (6)修改ospf cost为100，实现SW1分别与RT2、FW2之间ipv4和ipv6互访流量优先通过SW1_SW2_RT1链路转发，SW2访问Internet ipv4和ipv6流量优先通过SW2_SW1_FW1链路转发。\nFW1:\ninterface ethernet0/2 ip ospf cost 100 ipv6 ospf cost 100 RT1:\ninterface GigaEthernet0/2 ip ospf cost 100 ipv6 ospf cost 100 IPV6路由表：\nSW1：\nSW1(config)#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/21] via fe80::203:fff:fea6:72c1, Vlan1021, 12:00:39 tag:0 O 2001:10:10:2::1/128 [110/1] via fe80::203:fff:fee0:f9b5, Vlan1026, 12:24:12 tag:0 O 2001:10:10:3::1/128 [110/1] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:16:43 tag:0 O 2001:10:10:3::2/128 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:20 tag:0 O 2001:10:10:4::1/128 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:10:5::1/128 [110/3] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:10:6::1/128 [110/2] via fe80::203:fff:fea6:72c1, Vlan1021, 12:05:24 tag:0 O 2001:10:10:8::1/128 [110/4] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:10:21::/64 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1026, 12:24:12 tag:0 O 2001:10:10:31::/64 [110/2] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:16:43 tag:0 O 2001:10:16:110::/64 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:20 tag:0 O 2001:10:17:110::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 O 2001:10:17:120::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1026, 11:30:21 tag:0 SW2:\nSW2(config)#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/22] via fe80::203:fff:fee0:f9b2, Vlan1026, 11:31:37 tag:0 O 2001:10:10:1::1/128 [110/1] via fe80::203:fff:fee0:f9b2, Vlan1026, 12:24:52 tag:0 O 2001:10:10:3::1/128 [110/1] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:17:33 tag:0 O 2001:10:10:3::2/128 [110/150] via fe80::203:fff:fedc:c392, Vlan1021, 11:36:13 tag:0 O 2001:10:10:4::1/128 [110/1] via fe80::203:fff:fedc:c392, Vlan1021, 12:14:02 tag:0 O 2001:10:10:5::1/128 [110/2] via fe80::203:fff:fedc:c392, Vlan1021, 12:11:48 tag:0 O 2001:10:10:6::1/128 [110/3] via fe80::203:fff:fee0:f9b2, Vlan1026, 11:31:38 tag:0 O 2001:10:10:8::1/128 [110/3] via fe80::203:fff:fedc:c392, Vlan1021, 11:59:02 tag:0 O 2001:10:10:11::/64 [110/2] via fe80::203:fff:fee0:f9b2, Vlan1026, 12:24:52 tag:0 O 2001:10:10:31::/64 [110/2] via fe80::203:fff:fee0:f9b8, Vlan1022, 12:17:33 tag:0 O 2001:10:16:110::/64 [110/150] via fe80::203:fff:fedc:c392, Vlan1021, 11:36:13 tag:0 O 2001:10:17:110::/64 [110/4] via fe80::203:fff:fedc:c392, Vlan1021, 11:59:02 tag:0 O 2001:10:17:120::/64 [110/4] via fe80::203:fff:fedc:c392, Vlan1021, 11:59:02 tag:0 SW3:\nSW3#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/22] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:01:49 tag:0 O 2001:10:10:1::1/128 [110/1] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:17:56 tag:0 O 2001:10:10:2::1/128 [110/1] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:17:56 tag:0 O 2001:10:10:3::2/128 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:36:44 tag:0 O 2001:10:10:4::1/128 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:14:33 tag:0 O 2001:10:10:5::1/128 [110/3] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:12:19 tag:0 O 2001:10:10:6::1/128 [110/3] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:06:35 tag:0 O 2001:10:10:8::1/128 [110/4] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:59:33 tag:0 O 2001:10:10:11::/64 [110/2] via fe80::203:fff:fee0:f9b2, Vlan1021, 12:17:56 tag:0 O 2001:10:10:21::/64 [110/2] via fe80::203:fff:fee0:f9b5, Vlan1022, 12:17:56 tag:0 O 2001:10:16:110::/64 [110/150] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:36:44 tag:0 O 2001:10:17:110::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:59:33 tag:0 O 2001:10:17:120::/64 [110/5] via fe80::203:fff:fee0:f9b5, Vlan1022, 11:59:33 tag:0 RT1:\nRT1_config#sho ipv route ospf OE1 ::/0[1] [110,23] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:1::1/128[1] [110,2] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:2::1/128[1] [110,1] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:3::1/128[1] [110,2] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) OE2 2001:10:10:3::2/128[1] [110,20] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) O 2001:10:10:5::1/128[1] [110,1] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) O 2001:10:10:6::1/128[1] [110,4] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:7::1/128[1] [110,2] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) OIA 2001:10:10:8::1/128[1] [110,2] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) O 2001:10:10:11::/64[1] [110,3] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:21::/64[1] [110,2] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) O 2001:10:10:31::/64[1] [110,3] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) OE2 2001:10:16:110::/64[1] [110,20] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) OE2 2001:10:16:120::/64[1] [110,20] via fe80::203:fff:fea6:8342(on GigaEthernet0/3) OIA 2001:10:17:110::/64[1] [110,3] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) OIA 2001:10:17:120::/64[1] [110,3] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) RT2:\nRT2_config#sho ipv route ospf OE1 ::/0[1] [110,24] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:1::1/128[1] [110,3] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:2::1/128[1] [110,2] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:3::1/128[1] [110,3] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) OE2 2001:10:10:3::2/128[1] [110,150] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:4::1/128[1] [110,1] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:6::1/128[1] [110,5] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:8::1/128[1] [110,1] via fe80::203:fff:fed4:28b2(on GigaEthernet0/1) O 2001:10:10:11::/64[1] [110,4] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:21::/64[1] [110,3] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:10:31::/64[1] [110,4] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) OE2 2001:10:16:110::/64[1] [110,150] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) O 2001:10:17:110::/64[1] [110,2] via fe80::203:fff:fed4:28b2(on GigaEthernet0/1) O 2001:10:17:120::/64[1] [110,2] via fe80::203:fff:fed4:28b2(on GigaEthernet0/1) AC1:\nAC1(config)#sho ipv route nsm ospf IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime O ::/0 [110/2] via fe80::203:fff:fedc:c38a, Vlan1001, 12:01:37 tag:0 FW1:\nFW1(config)# sho ipv route ospf ? \u0026lt;cr\u0026gt; | Output modifiers vrouter Virtual router FW1(config)# sho ipv route ospf Codes: K - kernel route, C - connected, S - static, R - RIPng, O - OSPFv3, B - BGP, I - ISIS, A - AUTOCONF, H - HOST, \u0026gt; - selected route, * - FIB route, Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt; 2001:10:10:1::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/1/1] O\u0026gt; 2001:10:10:2::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/2/1] O\u0026gt; 2001:10:10:3::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/2/1] O\u0026gt; 2001:10:10:3::2/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/150/1] O\u0026gt; 2001:10:10:4::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/3/1] O\u0026gt; 2001:10:10:5::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/4/1] O\u0026gt; 2001:10:10:8::1/128 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/5/1] O\u0026gt; 2001:10:10:11::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/2/1] O\u0026gt; 2001:10:10:21::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/3/1] O\u0026gt; 2001:10:10:31::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/3/1] O\u0026gt; 2001:10:16:110::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/150/1] O\u0026gt; 2001:10:17:110::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/6/1] O\u0026gt; 2001:10:17:120::/64 * via FE80::203:FFF:FEE0:F9B2, ethernet0/1 [110/6/1] ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== FW2:\nFW2(config)# sho ipv route ospf Codes: K - kernel route, C - connected, S - static, R - RIPng, O - OSPFv3, B - BGP, I - ISIS, A - AUTOCONF, H - HOST, \u0026gt; - selected route, * - FIB route, Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== O\u0026gt; ::/0 * via FE80::203:FFF:FEDC:C394, ethernet0/2 [110/151/1] O\u0026gt; 2001:10:10:4::4/128 * via FE80::203:FFF:FEDC:C394, ethernet0/2 [110/1/1] ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== 6、RIP RT1串行链路、RT2串行链路、FW1、AC1之间分别运行RIP和RIPng协议， FW1、RT1、RT2的RIP和RIPng发布loopback2地址路由，AC1 RIP发布loopback2 地址路由，AC1 RIPng采用route-map匹配prefix-list重发布loopback2地址路由。\nIPV4:\nFW1:\nrouter rip network 10.10.6.2/32 network 10.10.255.16/30 RT1:\nrouter rip 1 version 2 no auto-summary interface Loopback2 ip rip 1 enable ! interface Serial1/0 ip rip 1 enable ! interface Serial1/1 ip rip 1 enable ! interface GigaEthernet0/2 ip rip 1 enable ! RT2:\nrouter rip 1 version 2 no auto-summary interface Loopback2 ip rip 1 enable ! interface Serial1/0 ip rip 1 enable ! interface Serial1/1 ip rip 1 enable ! interface GigaEthernet0/1 ip rip 1 enable AC1:\nrouter rip network Loopback2 network Vlan1001 RT1配置offset值为3的路由策略，实现RT1-S1/0_RT2-S1/1为主链路， RT1-1/1_RT2-S1/0为备份链路，ipv4的ACL名称为AclRIP，ipv6的ACL名称为AclRIPng。\nrouter rip 1 version 2 no auto-summary offset Serial1/1 in AclRIP 3 offset Serial1/1 out AclRIP 3 ! ip access-list standard AclRIP permit any sequence 10 RIPng RT1串行链路、RT2串行链路、FW1、AC1之间运行RIPng协议， FW1、RT1、RT2的RIPng发布loopback2地址路由，AC1 RIP发布loopback2 地址路由，AC1 RIPng采用route-map匹配prefix-list重发布loopback2地址路由。\nFW1:\nipv6 router rip network loopback2 network ethernet0/2 RT1:\nrouter ripng 1 interface Loopback2 ipv6 rip 1 enable ! interface Serial1/0 ipv6 rip 1 enable ! interface Serial1/1 ipv6 rip 1 enable ! interface GigaEthernet0/2 ipv6 rip 1 enable RT2:\nrouter ripng 1 interface Loopback2 ipv6 rip 1 enable ! interface Serial1/0 ipv6 rip 1 enable ! interface Serial1/1 ipv6 rip 1 enable ! interface GigaEthernet0/1 ipv6 rip 1 enable AC1：\nrouter ipv6 rip redistribute connected route-map L2V6 ! route-map L2V6 permit 10 match ipv6 address prefix-list L2V6 ! ipv6 prefix-list L2V6 seq 5 permit 2001:10:10:8::2/128 ! interface Vlan1001 ipv6 router rip RT1配置offset值为3的路由策略，实现RT1-S1/0_RT2-S1/1为主链路， RT1-1/1_RT2-S1/0为备份链路，ipv4的ACL名称为AclRIP，ipv6的ACL名称为AclRIPng。\nRT1:\nrouter ripng 1 offset Serial1/1 in AclRIPng 3 offset Serial1/1 out AclRIPng 3 ! ipv6 access-list AclRIPng massive permit ipv6 any any sequence 10 chap双向认证 RT1的S1/0与RT2的S1/1之间采用chap双向认证，用户名为对端设备名称，密码为Pass-1234。\nRT1:\naaa authentication ppp default local ! username RT2 password 0 Pass-1234 ! interface Serial1/0 ppp authentication chap ppp chap hostname RT1 ppp chap password 0 Pass-1234 RT2:\naaa authentication ppp default local ! username RT1 password 0 Pass-1234 ! interface Serial1/1 ppp authentication chap ppp chap hostname RT2 ppp chap password 0 Pass-1234 路由表：\nFW1:\nFW1(config)# sho ip route rip Codes: K - kernel route, C - connected, S - static, Z - ISP, R - RIP, O - OSPF, B - BGP, D - DHCP, P - PPPoE, W - wireless, H - HOST, G - SCVPN, V - VPN, M - IMPORT, I - ISIS, Y - SYNC, L - llb outbound, \u0026gt; - selected first nexthop, * - FIB route, b - BFD enable Routing Table for Virtual Router \u0026lt;trust-vr\u0026gt; ============================================================================== R\u0026gt;* 10.10.4.2/32 [120/2/1] via 10.10.255.18, ethernet0/2, 09:01:13 R\u0026gt;* 10.10.5.2/32 [120/3/1] via 10.10.255.18, ethernet0/2, 07:44:32 R\u0026gt;* 10.10.8.2/32 [120/4/1] via 10.10.255.18, ethernet0/2, 07:44:32 R\u0026gt;* 10.10.255.32/30 [120/2/1] via 10.10.255.18, ethernet0/2, 07:44:43 R\u0026gt;* 10.10.255.36/30 [120/2/1] via 10.10.255.18, ethernet0/2, 07:44:43 R 10.10.255.40/30 [120/3/1] via 10.10.255.18, ethernet0/2, 07:44:32 ============================================================================== Routing Table for Virtual Router \u0026lt;mgt-vr\u0026gt; ============================================================================== ============================================================================== RT1:\nRT1_config#sho ip route rip VRF ID: 0 R 10.10.5.2/32 [120,1] via 10.10.255.34(on Serial1/0) R 10.10.6.2/32 [120,1] via 10.10.255.17(on GigaEthernet0/2) R 10.10.8.2/32 [120,2] via 10.10.255.34(on Serial1/0) RT2:\nRT2_config#sho ip route rip VRF ID: 0 R 10.10.4.2/32 [120,1] via 10.10.255.33(on Serial1/1) R 10.10.6.2/32 [120,2] via 10.10.255.33(on Serial1/1) R 10.10.8.2/32 [120,1] via 10.10.255.42(on GigaEthernet0/1) AC1:\nAC1(config)#sho ip route rip R 10.10.4.2/32 [120/3] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.5.2/32 [120/2] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.6.2/32 [120/4] via 10.10.255.41, Vlan1001, 07:47:32 tag:0 R 10.10.255.16/30 [120/3] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.255.32/30 [120/2] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 R 10.10.255.36/30 [120/2] via 10.10.255.41, Vlan1001, 00:00:25 tag:1 Total routes are : 6 item(s) 7、ISIS RT1 以太链路、RT2 以太链路之间运行 ISIS 协议，进程 1，分别实现 loopback3 之间 ipv4 互通和 ipv6 互通。RT1、RT2 的 NET 分别为10.0000.0000.0001.00、10.0000.0000.0002.00，路由器类型是Level-2，接口网络类型为点到点。\nRT1:\nrouter isis 1 is-type level-2 net 10.0000.0000.0001.00 ! interface Loopback3 ip router isis 1 ipv6 router isis 1 ! interface GigaEthernet0/0 ip router isis 1 ipv6 router isis 1 isis network point-to-point isis circuit-type level-2 RT2:\nrouter isis 1 is-type level-2 net 10.0000.0000.0002.00 ! interface Loopback3 ip router isis 1 ipv6 router isis 1 ! interface GigaEthernet0/0 ip router isis 1 ipv6 router isis 1 isis network point-to-point isis circuit-type level-2 isis network point-to-point 配置域md5认证和接口md5认证，密码均为Pass-1234。\nRT1:\nrouter isis 1 authentication mode md5 level-2 authentication key 0 Pass-1234 level-2 ! interface GigaEthernet0/0 isis authentication mode md5 level-2 isis authentication key 0 Pass-1234 RT2:\nrouter isis 1 authentication mode md5 level-2 authentication key 0 Pass-1234 level-2 ! interface GigaEthernet0/0 isis authentication mode md5 level-2 isis authentication key 0 Pass-1234 level-2 8、nat RT2配置ipv4 nat，实现AC1 ipv4产品部门用RT2外网接口ipv4地址访问Internet。RT2配置nat64，实现AC1 ipv6产品部门用RT2外网接口ipv4地址访问Internet，ipv4地址转ipv6地址前缀为64:ff9b::/96。\nIPV4:\nRT2:\nip route default 200.200.200.5 ! ip access-list standard NAT permit 10.17.110.0 255.255.255.0 sequence 10 ! ip nat inside source list NAT interface GigaEthernet0/3 ! interface GigaEthernet0/1 ip nat inside ! interface GigaEthernet0/3 ip nat outside ! router ospf 1 default-information originate 结果验证：\nAC1:\nAC1#ping src 10.17.110.1 200.200.200.5 Type ^c to abort. Sending 5 56-byte ICMP Echos to 200.200.200.5, using source address 10.17.110.1, timeout is 2 seconds. !!!!! Success rate is 100 percent (5/5), round-trip min/avg/max = 0/14/20 ms RT2:\nRT2_config#sho ip nat translations Pro. Dir Inside local Inside global Outside local Outside global ICMP OUT 10.17.110.1:4660 200.200.200.6:4660 200.200.200.5:4660 200.200.200.5:4660 IPV6:\nipv6 access-list NATV6 massive permit ipv6 2001:10:17:110::/64 any sequence 10 ! ipv6 nat v6v4 source list NATV6 interface GigaEthernet0/3 ipv6 nat prefix 64:FF9B::/96 v4-mapped NATV6 ! interface GigaEthernet0/3 ipv6 nat ! interface GigaEthernet0/1 ipv6 nat 结果验证：\nAC1:\nAC1#ping6 src 2001:10:17:110::1 64:ff9b::200.200.200.5 Type ^c to abort. Sending 5 56-byte ICMP Echos to 64:ff9b::200.200.200.5, using src address 2001:10:17:110::1, timeout is 2 seconds. !!!!! Success rate is 100 percent (5/5), round-trip min/avg/max = 0/6/20 ms RT2:\nRT2_config#sho ipv nat translations Prot V6Src V6Dst V4Src V4Dst ICMP 2001:10:17:110::1-466064:FF9B::C8C8:C805-4660200.200.200.6-4660200.200.200.5-4660 9、BGP SW1、SW2、SW3、RT1、RT2 之间运行 BGP 协议，SW1、SW2、RT1 AS 号 65001、 RT2 AS 号 65002、SW3 AS 号 65003。\nipv4 BGP (1)SW1、SW2、SW3、RT1、RT2 之间通过 loopback1 建立 ipv4BGP 邻 居。SW1 和 SW2 之间财务通过 loopback2 建立 ipv4 BGP 邻居，SW1 和 SW2 的 loopback2 互通采用静态路由。\nSW1:\nrouter bgp 65001 bgp router-id 10.10.1.1 neighbor 10.10.2.1 remote-as 65001 neighbor 10.10.2.1 update-source 10.10.1.1 neighbor 10.10.2.1 next-hop-self neighbor 10.10.3.1 remote-as 65003 neighbor 10.10.3.1 ebgp-multihop 255 neighbor 10.10.3.1 update-source 10.10.1.1 neighbor 10.10.4.1 remote-as 65001 neighbor 10.10.4.1 update-source 10.10.1.1 neighbor 10.10.4.1 next-hop-self ip route vrf CW 10.10.2.2/32 10.10.255.2 router bgp 65001 address-family ipv4 vrf CW network 10.10.14.0/24 neighbor 10.10.2.2 remote-as 65001 neighbor 10.10.2.2 update-source 10.10.1.2 exit-address-family SW2:\nrouter bgp 65001 bgp router-id 10.10.2.1 neighbor 10.10.1.1 remote-as 65001 neighbor 10.10.1.1 update-source 10.10.2.1 neighbor 10.10.1.1 next-hop-self neighbor 10.10.3.1 remote-as 65003 neighbor 10.10.3.1 ebgp-multihop 255 neighbor 10.10.3.1 update-source 10.10.2.1 neighbor 10.10.4.1 remote-as 65001 neighbor 10.10.4.1 update-source 10.10.2.1 neighbor 10.10.4.1 next-hop-self ip route vrf CW 10.10.1.2/32 10.10.255.1 router bgp 65001 address-family ipv4 vrf CW network 10.10.24.0/24 neighbor 10.10.1.2 remote-as 65001 neighbor 10.10.1.2 update-source 10.10.2.2 exit-address-familys SW3:\nrouter bgp 65003 bgp router-id 10.10.3.1 neighbor 10.10.1.1 remote-as 65001 neighbor 10.10.1.1 ebgp-multihop 255 neighbor 10.10.1.1 update-source 10.10.3.1 neighbor 10.10.2.1 remote-as 65001 neighbor 10.10.2.1 ebgp-multihop 255 neighbor 10.10.2.1 update-source 10.10.3.1 RT1:\nrouter bgp 65001 bgp router-id 10.10.4.1 neighbor 10.10.1.1 remote-as 65001 neighbor 10.10.1.1 update-source Loopback1 neighbor 10.10.1.1 next-hop-self neighbor 10.10.2.1 remote-as 65001 neighbor 10.10.2.1 update-source Loopback1 neighbor 10.10.2.1 next-hop-self neighbor 10.10.5.1 remote-as 65002 neighbor 10.10.5.1 ebgp-multihop 255 neighbor 10.10.5.1 update-source Loopback1 RT2:\nrouter bgp 65002 bgp router-id 10.10.5.1 neighbor 10.10.4.1 remote-as 65001 neighbor 10.10.4.1 ebgp-multihop 255 neighbor 10.10.4.1 update-source Loopback1 (2)SW1、SW2、SW3、RT2 分别只发布营销、法务、财务、人力等 ipv4路由；RT1 发布办事处营销 ipv4路由到 BGP。\nSW1:\nrouter bgp 65001 network 10.10.12.0/24 network 10.10.13.0/24 network 10.10.15.0/24 SW2:\nrouter bgp 65001 network 10.10.22.0/24 network 10.10.23.0/24 network 10.10.25.0/24 SW3:\nrouter bgp 65003 network 10.10.32.0/24 network 10.10.33.0/24 network 10.10.35.0/24 RT2:\nrouter bgp 65002 network 10.17.120.0/24 RT1:\nrouter bgp 65001 redistribute ospf 2 route-map BGP ! route-map BGP 10 permit match ip address prefix-list BGP ! ip prefix-list BGP seq 5 permit 10.16.120.0/24 (3)SW3 营销分别与 SW1 和 SW2 营销 ipv4互访优先在 SW3_SW1 链路 转发；SW3 法务及人力分别与 SW1 和 SW2 法务及人力 ipv4互访优先在 SW3_SW2 链路转发，主备链路相互备份；用 prefix-list、route-map 和 BGP 路 径属性进行选路，新增 AS 65000。\nSW1:\nrouter bgp 65001 neighbor 10.10.3.1 route-map R\u0026amp;F in ! route-map R\u0026amp;F permit 10 match ip address prefix-list R\u0026amp;F set as-path prepend 65000 ! route-map R\u0026amp;F permit 20 ! ip prefix-list R\u0026amp;F seq 5 permit 10.10.35.0/24 ip prefix-list R\u0026amp;F seq 10 permit 10.10.33.0/24 SW2:\nrouter bgp 65001 neighbor 10.10.3.1 route-map R\u0026amp;F in ! route-map R\u0026amp;F permit 10 match ip address prefix-list R\u0026amp;F set as-path prepend 65000 ! route-map R\u0026amp;F permit 20 ! ip prefix-list R\u0026amp;F seq 5 permit 10.10.32.0/24 SW3:\nrouter bgp 65003 neighbor 10.10.1.1 route-map R\u0026amp;F in neighbor 10.10.2.1 route-map YX in ! route-map R\u0026amp;F permit 10 match ip address prefix-list R\u0026amp;F set as-path prepend 65000 ! route-map R\u0026amp;F permit 20 ! route-map YX permit 10 match ip address prefix-list YX set as-path prepend 65000 ! route-map YX permit 20 ! ip prefix-list R\u0026amp;F seq 5 permit 10.10.13.0/24 ip prefix-list R\u0026amp;F seq 10 permit 10.10.23.0/24 ip prefix-list R\u0026amp;F seq 15 permit 10.10.15.0/24 ip prefix-list R\u0026amp;F seq 20 permit 10.10.25.0/24 ip prefix-list YX seq 5 permit 10.10.12.0/24 ip prefix-list YX seq 10 permit 10.10.22.0/24 ip prefix-list YX seq 15 permit 10.16.120.0/24 ip prefix-list YX seq 20 permit 10.17.120.0/24 路由表：\nSW1:\nSW1(config)#sho ip route bgp B 10.10.22.0/24 [200/0] via 10.10.2.1 (recursive via 10.10.255.2, Vlan1026), 01:01:28 tag:0 B 10.10.23.0/24 [200/0] via 10.10.2.1 (recursive via 10.10.255.2, Vlan1026), 01:01:28 tag:0 B 10.10.25.0/24 [200/0] via 10.10.2.1 (recursive via 10.10.255.2, Vlan1026), 01:01:28 tag:0 B 10.10.32.0/24 [20/0] via 10.10.3.1 (recursive via 10.10.255.6, Vlan1022), 01:00:34 tag:0 B 10.10.33.0/24 [20/0] via 10.10.3.1 (recursive via 10.10.255.6, Vlan1022), 01:00:34 tag:0 B 10.10.35.0/24 [20/0] via 10.10.3.1 (recursive via 10.10.255.6, Vlan1022), 01:00:34 tag:0 B 10.16.120.0/24 [200/3] via 10.10.4.1 (recursive via 10.10.255.2, Vlan1026), 01:00:43 tag:0 Total routes are : 7 item(s) SW2:\nSW2#sho ip route bgp B 10.10.12.0/24 [200/0] via 10.10.1.1 (recursive via 10.10.255.1, Vlan1026), 01:01:42 tag:0 B 10.10.13.0/24 [200/0] via 10.10.1.1 (recursive via 10.10.255.1, Vlan1026), 01:01:42 tag:0 B 10.10.15.0/24 [200/0] via 10.10.1.1 (recursive via 10.10.255.1, Vlan1026), 01:01:42 tag:0 B 10.10.32.0/24 [20/0] via 10.10.3.1 (recursive via 10.10.255.10, Vlan1022), 01:01:00 tag:0 B 10.10.33.0/24 [20/0] via 10.10.3.1 (recursive via 10.10.255.10, Vlan1022), 01:01:00 tag:0 B 10.10.35.0/24 [20/0] via 10.10.3.1 (recursive via 10.10.255.10, Vlan1022), 01:01:00 tag:0 B 10.16.120.0/24 [200/3] via 10.10.4.1 (recursive via 10.10.255.21, Vlan1021), 01:00:55 tag:0 Total routes are : 7 item(s) SW3:\nSW3#sho ip bgp BGP table version is 4, local router ID is 10.10.3.1 Status codes: s suppressed, d damped, h history, * valid, \u0026gt; best, i - internal, S Stale Origin codes: i - IGP, e - EGP, ? - incomplete Network Next Hop Metric LocPrf Weight Path * 10.10.12.0/24 10.10.1.1 0 65001 i * 10.10.2.1 0 65001 i * 10.10.2.1 0 65000 65001 i *\u0026gt; 10.10.1.1 0 65001 i * 10.10.13.0/24 10.10.1.1 0 65001 i * 10.10.2.1 0 65001 i *\u0026gt; 10.10.2.1 0 65001 i * 10.10.1.1 0 65000 65001 i * 10.10.15.0/24 10.10.1.1 0 65001 i * 10.10.2.1 0 65001 i *\u0026gt; 10.10.2.1 0 65001 i * 10.10.1.1 0 65000 65001 i * 10.10.22.0/24 10.10.2.1 0 65001 i * 10.10.2.1 0 65000 65001 i * 10.10.1.1 0 65001 i *\u0026gt; 10.10.1.1 0 65001 i * 10.10.23.0/24 10.10.2.1 0 65001 i * 10.10.2.1 0 65001 i * 10.10.1.1 0 65000 65001 i *\u0026gt; 10.10.1.1 0 65001 i * 10.10.25.0/24 10.10.2.1 0 65001 i * 10.10.2.1 0 65001 i * 10.10.1.1 0 65000 65001 i *\u0026gt; 10.10.1.1 0 65001 i *\u0026gt; 10.10.32.0/24 0.0.0.0 32768 i *\u0026gt; 10.10.33.0/24 0.0.0.0 32768 i *\u0026gt; 10.10.35.0/24 0.0.0.0 32768 i * 10.16.120.0/24 10.10.2.1 0 65001 ? * 10.10.2.1 0 65000 65001 ? * 10.10.1.1 0 65001 ? *\u0026gt; 10.10.1.1 0 65001 ? * 10.17.120.0/24 10.10.2.1 0 65001 65002 i * 10.10.2.1 0 65000 65001 65002 i * 10.10.1.1 0 65001 65002 i *\u0026gt; 10.10.1.1 0 65001 65002 i Total number of prefixes 11 RT1:\nRT1#sho ip route bgp VRF ID: 0 B 10.10.12.0/24 [200,0] via 10.10.1.1 B 10.10.13.0/24 [200,0] via 10.10.1.1 B 10.10.15.0/24 [200,0] via 10.10.1.1 B 10.10.22.0/24 [200,0] via 10.10.2.1 B 10.10.23.0/24 [200,0] via 10.10.2.1 B 10.10.25.0/24 [200,0] via 10.10.2.1 B 10.10.32.0/24 [200,0] via 10.10.2.1 B 10.10.33.0/24 [200,0] via 10.10.2.1 B 10.10.35.0/24 [200,0] via 10.10.2.1 B 10.17.120.0/24 [20,2] via 10.10.5.1 RT2:\nRT2#sho ip route bgp VRF ID: 0 B 10.10.12.0/24 [20,0] via 10.10.4.1 B 10.10.13.0/24 [20,0] via 10.10.4.1 B 10.10.15.0/24 [20,0] via 10.10.4.1 B 10.10.22.0/24 [20,0] via 10.10.4.1 B 10.10.23.0/24 [20,0] via 10.10.4.1 B 10.10.25.0/24 [20,0] via 10.10.4.1 B 10.10.32.0/24 [20,0] via 10.10.4.1 B 10.10.33.0/24 [20,0] via 10.10.4.1 B 10.10.35.0/24 [20,0] via 10.10.4.1 B 10.16.120.0/24 [20,3] via 10.10.4.1 ipv6 BGP (1)SW1、SW2、SW3、RT1、RT2 之间通过 loopback1 建立ipv6 BGP 邻 居。SW1 和 SW2 之间财务通过 loopback2 建立 ipv4 BGP 邻居，SW1 和 SW2 的 loopback2 互通采用静态路由。\nSW1:\nrouter bgp 65001 neighbor 2001:10:10:2::1 remote-as 65001 neighbor 2001:10:10:2::1 update-source 2001:10:10:1::1 neighbor 2001:10:10:3::1 remote-as 65003 neighbor 2001:10:10:3::1 ebgp-multihop 255 neighbor 2001:10:10:3::1 update-source 2001:10:10:1::1 neighbor 2001:10:10:4::1 remote-as 65001 neighbor 2001:10:10:4::1 update-source 2001:10:10:1::1 address-family ipv6 unicast neighbor 2001:10:10:2::1 activate neighbor 2001:10:10:2::1 next-hop-self neighbor 2001:10:10:3::1 activate neighbor 2001:10:10:4::1 activate neighbor 2001:10:10:4::1 next-hop-self SW2:\nrouter bgp 65001 neighbor 2001:10:10:1::1 remote-as 65001 neighbor 2001:10:10:1::1 update-source 2001:10:10:2::1 neighbor 2001:10:10:3::1 remote-as 65003 neighbor 2001:10:10:3::1 ebgp-multihop 255 neighbor 2001:10:10:3::1 update-source 2001:10:10:2::1 neighbor 2001:10:10:4::1 remote-as 65001 neighbor 2001:10:10:4::1 update-source 2001:10:10:2::1 address-family ipv6 unicast neighbor 2001:10:10:1::1 activate neighbor 2001:10:10:1::1 next-hop-self neighbor 2001:10:10:3::1 activate neighbor 2001:10:10:4::1 activate neighbor 2001:10:10:4::1 next-hop-self SW3:\nrouter bgp 65003 neighbor 2001:10:10:1::1 remote-as 65001 neighbor 2001:10:10:1::1 ebgp-multihop 255 neighbor 2001:10:10:1::1 update-source 2001:10:10:3::1 neighbor 2001:10:10:2::1 remote-as 65001 neighbor 2001:10:10:2::1 ebgp-multihop 255 neighbor 2001:10:10:2::1 update-source 2001:10:10:3::1 address-family ipv6 unicast neighbor 2001:10:10:1::1 activate neighbor 2001:10:10:2::1 activate RT1:\nrouter bgp 65001 neighbor 2001:10:10:1::1 remote-as 65001 neighbor 2001:10:10:1::1 update-source Loopback1 neighbor 2001:10:10:1::1 next-hop-self neighbor 2001:10:10:2::1 remote-as 65001 neighbor 2001:10:10:2::1 update-source Loopback1 neighbor 2001:10:10:2::1 next-hop-self neighbor 2001:10:10:5::1 remote-as 65002 neighbor 2001:10:10:5::1 ebgp-multihop 255 neighbor 2001:10:10:5::1 update-source Loopback1 address-family ipv6 neighbor 2001:10:10:1::1 activate neighbor 2001:10:10:1::1 next-hop-self neighbor 2001:10:10:2::1 activate neighbor 2001:10:10:2::1 next-hop-self neighbor 2001:10:10:5::1 activate RT2:\nrouter bgp 65002 neighbor 2001:10:10:4::1 remote-as 65001 neighbor 2001:10:10:4::1 ebgp-multihop 255 neighbor 2001:10:10:4::1 update-source Loopback1 address-family ipv6 (2)SW1、SW2、SW3、RT2 分别只发布营销、法务、财务、人力等ipv6 路由；RT1 发布办事处营销和 ipv6 路由到 BGP。\nSW1:\nrouter bgp 65001 address-family ipv6 unicast network 2001:10:10:12::/64 network 2001:10:10:13::/64 network 2001:10:10:15::/64 SW2:\nrouter bgp 65001 address-family ipv6 unicast network 2001:10:10:22::/64 network 2001:10:10:23::/64 network 2001:10:10:25::/64 SW3:\nrouter bgp 65003 address-family ipv6 unicast network 2001:10:10:32::/64 network 2001:10:10:33::/64 network 2001:10:10:35::/64 RT2:\nrouter bgp 65002 address-family ipv6 network 2001:10:17:120::/64 RT1:\nrouter bgp 65001 address-family ipv6 redistribute ospf 2 match external 2 route-map BGPV6 ! route-map BGPV6 10 permit match ipv6 address prefix-list BGPV6 ! ipv6 prefix-list BGPV6 seq 5 permit 2001:10:16:120::/64 (3)SW3 营销分别与 SW1 和 SW2 营销ipv6 互访优先在 SW3_SW1 链路 转发；SW3 法务及人力分别与 SW1 和 SW2 法务及人力ipv6 互访优先在 SW3_SW2 链路转发，主备链路相互备份；用 prefix-list、route-map 和 BGP 路 径属性进行选路，新增 AS 65000。\nSW1:\nrouter bgp 65001 address-family ipv6 unicast neighbor 2001:10:10:3::1 route-map R\u0026amp;FV6 in ! route-map R\u0026amp;FV6 permit 10 match ipv6 address prefix-list R\u0026amp;FV6 set as-path prepend 65000 ! route-map R\u0026amp;FV6 permit 20 ! ipv6 prefix-list R\u0026amp;FV6 seq 5 permit 2001:10:10:33::/64 ipv6 prefix-list R\u0026amp;FV6 seq 10 permit 2001:10:10:35::/64 SW2:\nrouter bgp 65001 address-family ipv6 unicast neighbor 2001:10:10:3::1 route-map R\u0026amp;FV6 in ! route-map R\u0026amp;FV6 permit 10 match ipv6 address prefix-list R\u0026amp;FV6 set as-path prepend 65000 ! route-map R\u0026amp;FV6 permit 20 ! ipv6 prefix-list R\u0026amp;FV6 seq 5 permit 2001:10:10:32::/64 SW3:\nrouter bgp 65003 address-family ipv6 unicast neighbor 2001:10:10:1::1 route-map R\u0026amp;FV6 in neighbor 2001:10:10:2::1 route-map YXV6 in ! route-map R\u0026amp;FV6 permit 10 match ipv6 address prefix-list R\u0026amp;FV6 set as-path prepend 65000 ! route-map R\u0026amp;FV6 permit 20 ! route-map YXV6 permit 10 match ipv6 address prefix-list YXV6 set as-path prepend 65000 ! route-map YXV6 permit 20 ! ipv6 prefix-list R\u0026amp;FV6 seq 5 permit 2001:10:10:13::/64 ipv6 prefix-list R\u0026amp;FV6 seq 10 permit 2001:10:10:23::/64 ipv6 prefix-list R\u0026amp;FV6 seq 15 permit 2001:10:10:15::/64 ipv6 prefix-list R\u0026amp;FV6 seq 20 permit 2001:10:10:25::/64 ipv6 prefix-list YXV6 seq 5 permit 2001:10:10:12::/64 ipv6 prefix-list YXV6 seq 10 permit 2001:10:10:22::/64 ipv6 prefix-list YXV6 seq 15 permit 2001:10:16:120::/64 ipv6 prefix-list YXV6 seq 20 permit 2001:10:17:120::/64 路由表：\nSW1:\nSW1(config)#sho ipv route nsm bgp IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime B 2001:10:10:22::/64 [200/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1026), 01:07:05 tag:0 B 2001:10:10:23::/64 [200/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1026), 01:07:05 tag:0 B 2001:10:10:25::/64 [200/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1026), 01:07:05 tag:0 B 2001:10:10:32::/64 [20/0] via 2001:10:10:3::1 (recursive via fe80::203:fff:fee0:f9b8, Vlan10), 01:06:02 tag:0 B 2001:10:10:33::/64 [200/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1026), 01:06:17 tag:0 B 2001:10:10:35::/64 [200/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1026), 01:06:17 tag:0 B 2001:10:16:120::/64 [200/20] via 2001:10:10:4::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1026), 01:05:18 tag:0 SW2:\nSW2#sho ipv route nsm bgp IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime B 2001:10:10:12::/64 [200/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1026), 01:07:22 tag:0 B 2001:10:10:13::/64 [200/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1026), 01:07:22 tag:0 B 2001:10:10:15::/64 [200/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1026), 01:07:22 tag:0 B 2001:10:10:32::/64 [200/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1026), 01:06:17 tag:0 B 2001:10:10:33::/64 [20/0] via 2001:10:10:3::1 (recursive via fe80::203:fff:fee0:f9b8, Vlan1022), 01:06:34 tag:0 B 2001:10:10:35::/64 [20/0] via 2001:10:10:3::1 (recursive via fe80::203:fff:fee0:f9b8, Vlan1022), 01:06:34 tag:0 B 2001:10:16:120::/64 [200/20] via 2001:10:10:4::1 (recursive via fe80::203:fff:fedc:c392, Vlan1021), 01:06:37 tag:0 SW3:\nSW3#sho ipv route nsm bgp IPv6 Routing Table Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP Timers: Uptime B 2001:10:10:12::/64 [20/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1021), 00:04:16 tag:0 B 2001:10:10:13::/64 [20/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1022), 00:04:43 tag:0 B 2001:10:10:15::/64 [20/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1022), 00:04:43 tag:0 B 2001:10:10:22::/64 [20/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1021), 00:04:43 tag:0 B 2001:10:10:23::/64 [20/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1022), 00:04:43 tag:0 B 2001:10:10:25::/64 [20/0] via 2001:10:10:2::1 (recursive via fe80::203:fff:fee0:f9b5, Vlan1022), 00:04:43 tag:0 B 2001:10:16:120::/64 [20/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1021), 00:03:47 tag:0 B 2001:10:17:120::/64 [20/0] via 2001:10:10:1::1 (recursive via fe80::203:fff:fee0:f9b2, Vlan1021), 00:03:47 tag:0 RT1:\nRT1#sho ipv route bgp B 2001:10:10:12::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:1::1 B 2001:10:10:13::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:1::1 B 2001:10:10:15::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:1::1 B 2001:10:10:22::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:2::1 B 2001:10:10:23::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:2::1 B 2001:10:10:25::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:2::1 B 2001:10:10:32::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:1::1 B 2001:10:10:33::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:2::1 B 2001:10:10:35::/64[1] [200,0] via fe80::203:fff:fee0:f9b5(on GigaEthernet0/1) gate 2001:10:10:2::1 B 2001:10:17:120::/64[1] [20,2] via fe80::203:fff:fedc:c389(on GigaEthernet0/0) gate 2001:10:10:5::1 RT2:\nRT2#sho ipv route bgp B 2001:10:10:12::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:13::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:15::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:22::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:23::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:25::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:32::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:33::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:10:35::/64[1] [20,0] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 B 2001:10:16:120::/64[1] [20,20] via fe80::203:fff:fedc:c391(on GigaEthernet0/0) gate 2001:10:10:4::1 10、BGP、MPLS、VPN 利用 BGP MPLS VPN 技术，RT1 与 RT2 以太链路间运行多协议标签交换、 标签分发协议。RT1 与 RT2 间创建财务 VPN 实例，名称为 CW，RT1 的 RD 值为 1:1，export rt 值为 1:2，import rt 值为 2:1；RT2 的 RD 值为 2:2。通过两端 loopback1 建立 VPN 邻居，分别实现两端 loopback5 ipv4 互通和 ipv6 互通。\nipv4 MPLS RT1:\nRT1_config#sho run ip vrf CW rd 1:1 route-target export 1:2 route-target import 2:1 interface Loopback5 ip vrf forwarding CW RT1_config#mpls ip RT1_config#mpls ldp router-id 10.10.4.1 RT1_config#int g0/0 RT1_config_g0/0#mpls ip RT1_config_g0/0#mpls ldp enable router bgp 65001 address-family vpnv4 neighbor 10.10.5.1 activate neighbor 10.10.5.1 send-community extended exit-address-family address-family ipv4 vrf CW no synchronization network 10.10.4.5/32 exit-address-family 配置结果：\nRT1_config#sho ip route vrf CW bgp VRF ID: 1 B 10.10.5.5/32 [20,0] via 10.10.5.1 RT2:\nRT2_config#sho run ip vrf CW rd 2:2 route-target export 2:1 route-target import 1:2 interface Loopback5 ip vrf forwarding CW RT2_config#mpls ip RT2_config#mpls ldp router-id 10.10.5.1 RT2_config#int g0/0 RT2_config_g0/0#mpls ip RT2_config_g0/0#mpls ldp enable router bgp 65002 address-family vpnv4 neighbor 10.10.4.1 activate neighbor 10.10.4.1 send-community extended exit-address-family address-family ipv4 vrf CW no synchronization network 10.10.5.5/32 exit-address-family 配置结果：\nRT2_config#sho ip route vr CW bgp VRF ID: 1 B 10.10.4.5/32 [20,0] via 10.10.4.1 ipv6 MPLS RT1:\nRT1_config#sho run ipv6 unicast-routing ipv6 vrf CW rd 1:1 route-target import 2:1 route-target export 1:2 interface Loopback5 ipv6 vrf forwarding CW router bgp 65001 address-family vpnv6 neighbor 10.10.5.1 activate neighbor 10.10.5.1 send-community extended exit-address-family address-family ipv6 vrf CW no synchronization network 2001:10:10:4::5/128 exit-address-family 配置结果：\nRT1_config#sho ipv route vrf CW bgp B 2001:10:10:5::5/128[1] [20,0] via ::ffff:10.10.255.30(on GigaEthernet0/0) gate ::ffff:10.10.5.1 (vrf_id: 0) RT2:\nRT2_config#sho run ipv6 unicast-routing ipv6 vrf CW rd 1:1 route-target import 1:2 route-target export 2:1 interface Loopback5 ipv6 vrf forwarding CW router bgp 65002 address-family vpnv6 neighbor 10.10.4.1 activate neighbor 10.10.4.1 send-community extended exit-address-family address-family ipv6 vrf CW no synchronization network 2001:10:10:5::5/128 exit-address-family 配置结果：\nRT2_config#sho ipv route vrf CW bgp B 2001:10:10:4::5/128[1] [20,0] via ::ffff:10.10.255.29(on GigaEthernet0/0) gate ::ffff:10.10.4.1 (vrf_id: 0) 11、PIM-SM 组播 SW1、SW2、RT1、RT2、AC1 运行 PIM-SM，RT1 loopback1 为 c-bsr 和 crp，RT2 运行 IGMPv3；SW1 产品部门（PC1 测试）终端启用组播，用 VLC 工具串 流播放视频文件“1.mp4”，模拟组播源，设置此视频循环播放，组地址232.1.1.1， 端口 1234，实现分公司产品部门（PC2 测试）收看视频。\nSW1:\nSW1(config)#ip pim multicast-routing Interface Ethernet1/0/21 ip dhcp snooping trust ipv6 dhcp snooping trust Interface Ethernet1/0/22 ip dhcp snooping trust ipv6 dhcp snooping trust Interface Ethernet1/0/26 ip dhcp snooping trust ipv6 dhcp snooping trust interface Vlan10 ip pim sparse-mode interface Vlan1026 ip pim sparse-mode SW2:\nSW2(config)#ip pim multicast-routing interface Vlan1021 ip pim sparse-mode interface Vlan1026 ip pim sparse-mode RT1:\nip multicast-routing router pim-sm reg-rate-limit 1 c-bsr l1 c-rp l1 interface Loopback1 ip pim-sm interface GigaEthernet0/0 ip pim-sm interface GigaEthernet0/1 ip pim-sm RT2:\nip multicast-routing router pim-sm reg-rate-limit 1 interface GigaEthernet0/0 ip pim-sm interface GigaEthernet0/1 ip pim-sm ip igmp enable AC1:\nip pim multicast-routing interface Vlan1001 ip pim sparse-mode interface Vlan110 ip pim sparse-mode 三、无线配置 1、AP上线： wireless auto-ip-assign ap authentication mac discovery vlan-list 100 ap database 00-03-0f-8a-f8-b0 AC1(config-wireless)#sho wireless ap status MAC Address Configuration (*) Peer Managed IP Address Profile Status Status Age ------------------ --------------------------------------- ------- ------- ------------- -------------- 00-03-0f-8a-f8-b0 10.17.100.9 1 Managed Success 0d:00:00:01 Total Access Points............................ 1 2、创建ssid AC1 loopback1 ipv4 和 ipv6 地址分别作为 AC1 的 ipv4 和 ipv6 管理地 址。AP 二层自动注册，AP 采用 MAC 地址认证。配置 2 个 ssid，分别为 SKILLS2.4G 和 SKILLS-5G。SKILLS-2.4G 对应 vlan110，用 network 110 和 radio1（模 式为 n-only-g）,用户接入无线网络时需要采用基于 WPA-personal 加密方式， 密码为 Pass-1234。SKILLS-5G 对应 vlan120，用 network 120 和 radio2（模式 为 n-only-a），不需要认证，隐藏 ssid，SKILLS-5G 用倒数第一个可用 VAP 发送 5G 信号。\nnetwork 110 security mode wpa-personal ssid SKILLS-2.4G vlan 110 wpa key Pass-1234 network 120 hide-ssid ssid SKILLS-5G vlan 120 ap profile 1 radio 1 mode n-only-g vap 0 network 110 radio 2 mode n-only-a vap 15 network 120 3、AP自动升级 当 AP 上线，如果 AC 中储存的 Image 版本和 AP 的 Image 版本号不同时， 会触发 AP 自动升级。AP 失败状态超时时间及探测到的客户端状态超时时间都为 2 小时。\nAC1(config-wireless)#ap auto-upgrade AC1(config-wireless)#agetime ap-failure 2 AC1(config-wireless)#agetime detected-clients 4、黑名单MAC认证模式 MAC 认证模式为黑名单，MAC 地址为 80-45-DD-77-CC-48 的无线终端采用 全局配置 MAC 认证。\nmac-authentication-mode black-list known-client 80-45-dd-77-cc-48 action global-action network 110 mac authentication local network 120 mac authentication local 5、防止多 AP 和 AC 相连时过多的安全认证连接而消耗 CPU 资源，检测到 AP 与 AC 10 分钟内建立连接 5 次就不再允许继续连接，2 小时后恢复正常。 wireless ap anti-flood interval 10 wireless ap anti-flood max-conn-count 5 wireless ap anti-flood agetime 120 6、用户访问 Internet https 配置vlan110无线接入用户上班时间（工作日09:00-17:00）访问Internet https 上下行 CIR 为 100Mbps，CBS 为 200Mbps，PBS 为 300Mbps，exceed-action 和 violate-action 均为 drop。时间范围名称、控制列表名称、分类名称、策略 名称均为 SKILLS。\ntime-range SKILLS periodic weekdays 09:00:00 to 17:00:00 ip access-list extended SKILLS exit class-map SKILLS match access-group SKILLS policy-map SKILLS class SKILLS policy 100000 200000 300000 exceed-action drop violate-action drop exit network 110 client-qos enable client-qos diffserv-policy down SKILLS client-qos diffserv-policy up SKILLS 7、AP组播突发限制、AP发射功率 开启 AP 组播广播突发限制功能；AP 收到错误帧时，将不再发送 ACK 帧； AP 发送向无线终端表明 AP 存在的帧时间间隔为 1 秒。AP 发射功率为 80%。\nradio 1 rate-limit beacon-interval 1000 incorrect-frame-no-ack power default 80 radio 2 rate-limit beacon-interval 1000 incorrect-frame-no-ack power default 80 8、配置vlan140无线接入用户上下行最大带宽为8000Mkps，arp上下行最大速率为6packets/s client-qos bandwidth-limit down 800000 client-qos bandwidth-limit up 800000 client-qos bandwidth-limit arp down 6 client-qos bandwidth-limit arp up 6 9、配置vlan140无线接入用户相互隔离，开启ARP抑制功能，限制每天早上0点到4点禁止终端接入 station-isolation arp-suppression time-limit from 00:00 to 04:00 weekday all 10、特权模式下发： AC1#wireless ap profile apply 1 All configurations will be send to the aps associated to this profile and associated clients on these aps will be disconnected. Because of work mode configurations, some aps associated to this profile will reboot. Are you sure you want to apply the profile configuration? [Y/N] y AP Profile apply is in progress. ","permalink":"https://erain.fun/posts/tech/%E7%A5%9E%E5%B7%9E%E6%95%B0%E7%A0%81%E8%AE%BE%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%87%E4%BB%BD/","summary":"仅作为备份文件 备份时间 2023.6.23 一、交换机配置 1、生成树spanning-tree SW1、SW2、SW3启用MSTP，实现网络二层负载均衡和冗余备份","title":"神州数码设备知识点备份"},{"content":" 我平时有访问家中的网络的需求，家里的服务器运行了我常用的Plex和文件存储（顺带提一嘴，CasaOS确实漂亮）\n注：这篇博客是从旧博客迁移过来的，图片已经丢失，不存在教学记录意义，仅是思路\n旧思路 我之前的思路是使用ipv6公网地址给所有主机分配地址，在家中的爱快路由上配置了DDNS解析到我的域名，Cloudflare的代理功能可以将我的ipv6地址代理为ipv4，虽然延迟堪忧，稳定性一般。不过作为没有ipv6环境下的备用访问就没有要求太高。\n利与弊 ipv6的好处显而易见，对比ipv4的公网IP数量可谓是取之不尽，坏处也很明显，外出的时候不是所有网络环境都支持ipv6的，每次都要手机开热点，以便使用移动数据给分配的ipv6确实很麻烦，更不用说在使用Nas或是plex这种服务速率也是个问题。\n更重要的一个问题就是把家中的所有设备暴露在公网下并不安全，公网下的设备方便了我们也方便了一些不怀好意的人。\n新想法 于是我打算更换另一种方案使用VPN打通隧道，来访问家里的服务。好处就是安全，也不用将所有设备都暴露在公网环境下，只需要在防火墙放行特定的端口。\n我之前在连接我朋友的工作室内网时使用过pptp或l2tp(时间太久了，已经忘记了)本来这次的方案打算使用PPTP服务，比较对于这种比较传统的点对点隧道很多系统都会内置，不需要再下载客户端去配置。可当我在爱快软路由中配置好了PPTP后，使用电脑连接时出现了问题，内置的PPTP客户端不支持ipv6协议。我本想用我的vps内网穿透映射ipv4出来用，可想可想还是放弃了，想法回到了ipv6上，毕竟ipv6现在已经很稳定了，以后只会越来越好。\nOpenVPN PPTP用不了了，我把目光放到了爱快自带的openvpn服务端上，经过查询资料，发现openvpn是有udp6的，于是配置了ddns解析和爱快路由上的openvpn的配置。\n最后也是成功的通过路由上的OPENVPN服务打通了和家里的连接\n总的来说，这个方案虽然有一些小麻烦，但从安全性和灵活性上来看，还是值得推荐的。特别是对于有远程访问需求但又不想冒安全风险的人来说，使用OpenVPN来建立安全隧道，是个不错的选择。\n下面贴上我的配置文件\n[已隐藏1375字]\n","permalink":"https://erain.fun/posts/tech/%E7%88%B1%E5%BF%AB%E5%AF%B9openvpn%E7%9A%84%E9%85%8D%E7%BD%AE/","summary":"我平时有访问家中的网络的需求，家里的服务器运行了我常用的Plex和文件存储（顺带提一嘴，CasaOS确实漂亮） 注：这篇博客是从旧博客迁移过来","title":"爱快对OpenVPN的配置"},{"content":"直接说方法 ssh -D \u0026lt;本地端口号\u0026gt; -f -C -q -N \u0026lt;用户名\u0026gt;@\u0026lt;SSH服务器地址\u0026gt; -D \u0026lt;本地端口号\u0026gt;：指定一个端口号，会在本地创建一个Socks5端口用于转发，所有通过这个端口号的连接都将被转发到SSH建立连接后的服务器，并由服务器发送到目标地址\n-C：启用压缩，通过使用压缩，减少数据传输量，提高传输速度\n-q：使用安静模式，禁止SSH客户端在连接过程中输出任何警告或错误消息，只输出关键信息\n-N：告诉SSH客户端不要执行任何远程命令，在此情况下，只会建立SSH连接并启用端口转发\n很多情况下，我们想要借助一台处于内网又能出网的业务服务器来访问到内网部分，又不能直接在服务器上安装服务，可以用服务器自带ssh服务建立一个连接，打通你和内网的互通，很方便，记录一下\n","permalink":"https://erain.fun/posts/tech/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8-%E9%80%9A%E8%BF%87ssh%E8%BF%9E%E6%8E%A5%E4%BD%BF%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%8F%8A%E4%BD%9C%E4%B8%BAsocks5%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/","summary":"直接说方法 ssh -D \u0026lt;本地端口号\u0026gt; -f -C -q -N \u0026lt;用户名\u0026gt;@\u0026lt;SSH服务器地址\u0026gt; -D \u0026lt;本地端口号\u0026gt;：指定一","title":"横向移动 通过SSH连接使目标机及作为Socks5代理服务器"},{"content":" 博客会记录我的学习历程和部分项目成果，同时也会记录一些我的读书笔记，来培养阅读习惯.\n","permalink":"https://erain.fun/about/","summary":"博客会记录我的学习历程和部分项目成果，同时也会记录一些我的读书笔记，来培养阅读习惯.","title":"Just People"},{"content":"包含了友链和我一些很推荐阅读的博客\n阮一峰的网络日志 David Simão \u0026rsquo;s jungle 倾旋的博客 Jan Hod的网络世界 ","permalink":"https://erain.fun/links/","summary":"包含了友链和我一些很推荐阅读的博客 阮一峰的网络日志 David Simão \u0026rsquo;s jungle 倾旋的博客 Jan Hod的网络世界","title":"链接"}]